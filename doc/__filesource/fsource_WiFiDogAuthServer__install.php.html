<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
  <html xmlns="http://www.w3.org/1999/xhtml">
		<head>
			<!-- template designed by Marco Von Ballmoos -->
			<title>File Source for install.php</title>
			<link rel="stylesheet" href="../media/stylesheet.css" />
			<meta http-equiv='Content-Type' content='text/html; charset=iso-8859-1'/>
		</head>
		<body>
						
<h1>Source for file install.php</h1>
<p>Documentation is available at <a href="../WiFiDogAuthServer/_wifidog_install_php.html">install.php</a></p>
<div class="src-code">
<pre><ol><li><a name="a1"></a><span class="src-php">&lt;?php</span></li>
<li><a name="a2"></a>&nbsp;</li>
<li><a name="a4"></a><span class="src-comm">/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */</span></li>
<li><a name="a5"></a><span class="src-comm">// +-------------------------------------------------------------------+</span></li>
<li><a name="a6"></a><span class="src-comm">// | WiFiDog Authentication Server                                     |</span></li>
<li><a name="a7"></a><span class="src-comm">// | =============================                                     |</span></li>
<li><a name="a8"></a><span class="src-comm">// |                                                                   |</span></li>
<li><a name="a9"></a><span class="src-comm">// | The WiFiDog Authentication Server is part of the WiFiDog captive  |</span></li>
<li><a name="a10"></a><span class="src-comm">// | portal suite.                                                     |</span></li>
<li><a name="a11"></a><span class="src-comm">// +-------------------------------------------------------------------+</span></li>
<li><a name="a12"></a><span class="src-comm">// | PHP version 5 required.                                           |</span></li>
<li><a name="a13"></a><span class="src-comm">// +-------------------------------------------------------------------+</span></li>
<li><a name="a14"></a><span class="src-comm">// | Homepage:     http://www.wifidog.org/                             |</span></li>
<li><a name="a15"></a><span class="src-comm">// | Source Forge: http://sourceforge.net/projects/wifidog/            |</span></li>
<li><a name="a16"></a><span class="src-comm">// +-------------------------------------------------------------------+</span></li>
<li><a name="a17"></a><span class="src-comm">// | This program is free software; you can redistribute it and/or     |</span></li>
<li><a name="a18"></a><span class="src-comm">// | modify it under the terms of the GNU General Public License as    |</span></li>
<li><a name="a19"></a><span class="src-comm">// | published by the Free Software Foundation; either version 2 of    |</span></li>
<li><a name="a20"></a><span class="src-comm">// | the License, or (at your option) any later version.               |</span></li>
<li><a name="a21"></a><span class="src-comm">// |                                                                   |</span></li>
<li><a name="a22"></a><span class="src-comm">// | This program is distributed in the hope that it will be useful,   |</span></li>
<li><a name="a23"></a><span class="src-comm">// | but WITHOUT ANY WARRANTY; without even the implied warranty of    |</span></li>
<li><a name="a24"></a><span class="src-comm">// | MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the     |</span></li>
<li><a name="a25"></a><span class="src-comm">// | GNU General Public License for more details.                      |</span></li>
<li><a name="a26"></a><span class="src-comm">// |                                                                   |</span></li>
<li><a name="a27"></a><span class="src-comm">// | You should have received a copy of the GNU General Public License |</span></li>
<li><a name="a28"></a><span class="src-comm">// | along with this program; if not, contact:                         |</span></li>
<li><a name="a29"></a><span class="src-comm">// |                                                                   |</span></li>
<li><a name="a30"></a><span class="src-comm">// | Free Software Foundation           Voice:  +1-617-542-5942        |</span></li>
<li><a name="a31"></a><span class="src-comm">// | 59 Temple Place - Suite 330        Fax:    +1-617-542-2652        |</span></li>
<li><a name="a32"></a><span class="src-comm">// | Boston, MA  02111-1307,  USA       gnu@gnu.org                    |</span></li>
<li><a name="a33"></a><span class="src-comm">// |                                                                   |</span></li>
<li><a name="a34"></a><span class="src-comm">// +-------------------------------------------------------------------+</span></li>
<li><a name="a35"></a>&nbsp;</li>
<li><a name="a36"></a><span class="src-doc">/**</span></li>
<li><a name="a37"></a><span class="src-doc"> * WiFiDog Authentication Server installation and configuration script</span></li>
<li><a name="a38"></a><span class="src-doc"> *</span></li>
<li><a name="a39"></a><span class="src-doc"> * </span><span class="src-doc-coretag">@package</span><span class="src-doc">    WiFiDogAuthServer</span></li>
<li><a name="a40"></a><span class="src-doc"> * </span><span class="src-doc-coretag">@author</span><span class="src-doc">     Pascal Leclerc &lt;isf@plec.ca&gt;</span></li>
<li><a name="a41"></a><span class="src-doc"> * </span><span class="src-doc-coretag">@copyright</span><span class="src-doc">  2005 Pascal Leclerc &lt;isf@plec.ca&gt;</span></li>
<li><a name="a42"></a><span class="src-doc"> * </span><span class="src-doc-coretag">@version</span><span class="src-doc">    CVS: $Id: install.php,v 1.8 2005/12/26 10:34:03 max-horvath Exp $</span></li>
<li><a name="a43"></a><span class="src-doc"> * </span><span class="src-doc-coretag">@link</span><span class="src-doc">       http://sourceforge.net/projects/wifidog/</span></li>
<li><a name="a44"></a><span class="src-doc"> */</span></li>
<li><a name="a45"></a>&nbsp;</li>
<li><a name="a46"></a><span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$_REQUEST</span><span class="src-sym">[</span><span class="src-str">'page'</span><span class="src-sym">]</span><span class="src-sym">)   </span>? <span class="src-var">$page    </span>= <span class="src-str">'Welcome' </span>: <span class="src-var">$page    </span>= <span class="src-var">$_REQUEST</span><span class="src-sym">[</span><span class="src-str">'page'</span><span class="src-sym">]</span><span class="src-sym">;   </span><span class="src-comm"># The page to be loaded</span></li>
<li><a name="a47"></a><span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$_REQUEST</span><span class="src-sym">[</span><span class="src-str">'action'</span><span class="src-sym">]</span><span class="src-sym">) </span>? <span class="src-var">$action  </span>= <span class="src-str">''        </span>: <span class="src-var">$action  </span>= <span class="src-var">$_REQUEST</span><span class="src-sym">[</span><span class="src-str">'action'</span><span class="src-sym">]</span><span class="src-sym">; </span><span class="src-comm"># The action to be done (in page)</span></li>
<li><a name="a48"></a><span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$_REQUEST</span><span class="src-sym">[</span><span class="src-str">'debug'</span><span class="src-sym">]</span><span class="src-sym">)  </span>? <span class="src-var">$debug   </span>= <span class="src-num">0         </span>: <span class="src-var">$debug   </span>= <span class="src-var">$_REQUEST</span><span class="src-sym">[</span><span class="src-str">'debug'</span><span class="src-sym">]</span><span class="src-sym">;  </span><span class="src-comm"># Use for MySQL debugging</span></li>
<li><a name="a49"></a><span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$_REQUEST</span><span class="src-sym">[</span><span class="src-str">'config'</span><span class="src-sym">]</span><span class="src-sym">) </span>? <span class="src-var">$config  </span>= <span class="src-str">''        </span>: <span class="src-var">$config  </span>= <span class="src-var">$_REQUEST</span><span class="src-sym">[</span><span class="src-str">'config'</span><span class="src-sym">]</span><span class="src-sym">; </span><span class="src-comm"># Store data to be saved in config.php</span></li>
<li><a name="a50"></a>&nbsp;</li>
<li><a name="a51"></a><span class="src-var">$exploded_path </span>= <a href="http://www.php.net/explode">explode</a><span class="src-sym">(</span><span class="src-str">&quot;/&quot;</span><span class="src-sym">, </span><span class="src-var">$_SERVER</span><span class="src-sym">[</span><span class="src-str">'SCRIPT_FILENAME'</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">; </span><span class="src-comm"># Split directories in token</span></li>
<li><a name="a52"></a><a href="http://www.php.net/array_pop">array_pop</a><span class="src-sym">(</span><span class="src-var">$exploded_path</span><span class="src-sym">)</span><span class="src-sym">;                                  </span><span class="src-comm"># Remove install.php from the list</span></li>
<li><a name="a53"></a><span class="src-var">$basepath </span>= <a href="http://www.php.net/implode">implode</a><span class="src-sym">(</span><span class="src-str">&quot;/&quot;</span><span class="src-sym">, </span><span class="src-var">$exploded_path</span><span class="src-sym">)</span><span class="src-sym">;                   </span><span class="src-comm"># Build the basepath for this script</span></li>
<li><a name="a54"></a>&nbsp;</li>
<li><a name="a55"></a><span class="src-var">$exploded_path </span>= <a href="http://www.php.net/explode">explode</a><span class="src-sym">(</span><span class="src-str">&quot;/&quot;</span><span class="src-sym">, </span><span class="src-var">$_SERVER</span><span class="src-sym">[</span><span class="src-str">'SCRIPT_NAME'</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;     </span><span class="src-comm"># Split directories in token</span></li>
<li><a name="a56"></a><a href="http://www.php.net/array_pop">array_pop</a><span class="src-sym">(</span><span class="src-var">$exploded_path</span><span class="src-sym">)</span><span class="src-sym">;                                  </span><span class="src-comm"># Remove install.php from the list</span></li>
<li><a name="a57"></a><span class="src-var">$system_path </span>= <a href="http://www.php.net/implode">implode</a><span class="src-sym">(</span><span class="src-str">&quot;/&quot;</span><span class="src-sym">, </span><span class="src-var">$exploded_path</span><span class="src-sym">)</span><span class="src-sym">;                </span><span class="src-comm"># Build the system_path for the auth-server</span></li>
<li><a name="a58"></a>&nbsp;</li>
<li><a name="a59"></a><span class="src-comm"># Security : Minimal access validation is use by asking user to type the wifidog directory field date</span></li>
<li><a name="a60"></a><span class="src-comm"># It's dummy, easy to implement and better than nothing</span></li>
<li><a name="a61"></a><span class="src-var">$password </span>= <a href="http://www.php.net/exec">exec</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-id">ls</span> -<span class="src-id">ld </span><span class="src-var">$basepath</span> | <span class="src-id">awk</span> '<span class="src-sym">{</span><span class="src-id">print </span>\$6\$7\$8<span class="src-sym">}</span>'<span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-var">$output_array</span><span class="src-sym">, </span><span class="src-var">$return</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a62"></a><span class="src-var">$auth </span>= <span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a63"></a>&nbsp;</li>
<li><a name="a64"></a><span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$page </span>!= <span class="src-str">'Welcome'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a65"></a>  <span class="src-key">if </span><span class="src-sym">(</span>isset<span class="src-sym">(</span><span class="src-var">$_SERVER</span><span class="src-sym">[</span><span class="src-str">'PHP_AUTH_PW'</span><span class="src-sym">]</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a66"></a>    <span class="src-comm">#echo &quot;PHP_AUTH_USER=(&quot; . $_SERVER['PHP_AUTH_USER'] . &quot;) PHP_AUTH_PW=(&quot; . $_SERVER['PHP_AUTH_PW'] . &quot;)&quot;; # DEBUG</span></li>
<li><a name="a67"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$password </span>== <span class="src-var">$_SERVER</span><span class="src-sym">[</span><span class="src-str">'PHP_AUTH_PW'</span><span class="src-sym">]</span><span class="src-sym">)</span></li>
<li><a name="a68"></a>      <span class="src-var">$auth </span>= <span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a69"></a>  <span class="src-sym">}</span></li>
<li><a name="a70"></a><span class="src-sym">}</span></li>
<li><a name="a71"></a><span class="src-key">else</span></li>
<li><a name="a72"></a>  <span class="src-var">$auth </span>= <span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a73"></a>&nbsp;</li>
<li><a name="a74"></a><span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-var">$auth</span><span class="src-sym">) </span><span class="src-sym">{ </span><span class="src-comm"># Ask user for the passorwd</span></li>
<li><a name="a75"></a>    <a href="http://www.php.net/header">header</a><span class="src-sym">(</span><span class="src-str">'WWW-Authenticate: Basic realm=&quot;Private&quot;'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a76"></a>  <a href="http://www.php.net/header">header</a><span class="src-sym">(</span><span class="src-str">'HTTP/1.0 401 Unauthorized'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a77"></a>  echo <span class="src-str">&quot;Authorization Required !&quot;</span><span class="src-sym">;</span></li>
<li><a name="a78"></a>  <span class="src-key">exit</span><span class="src-sym">;</span></li>
<li><a name="a79"></a><span class="src-sym">}</span></li>
<li><a name="a80"></a><span class="src-comm"># End of Security validation</span></li>
<li><a name="a81"></a>&nbsp;</li>
<li><a name="a82"></a>print &lt;&lt;&lt;EndHTML</li>
<li><a name="a83"></a>&lt;<span class="src-id">HTML</span>&gt;</li>
<li><a name="a84"></a>&lt;<span class="src-id">HEAD</span>&gt;</li>
<li><a name="a85"></a>  &lt;<span class="src-id">TITLE</span>&gt;<span class="src-var">$page</span> - <span class="src-id">Wifidog Auth</span>-<span class="src-id">server configuration</span>&lt;/<span class="src-id">TITLE</span>&gt;</li>
<li><a name="a86"></a>&nbsp;</li>
<li><a name="a87"></a>  &lt;<span class="src-id">SCRIPT type</span>=&quot;<span class="src-id">text</span>/<span class="src-id">javascript</span>&quot;&gt;</li>
<li><a name="a88"></a>    // <span class="src-id">This function add new configuration value to the </span>&quot;<span class="src-id">config</span>&quot; <span class="src-id">hidden input</span></li>
<li><a name="a89"></a>    // <span class="src-id">On submit</span>, <span class="src-id">config will be parsed and value saved to config</span>.<span class="src-id">php file</span></li>
<li><a name="a90"></a>    <span class="src-id">function newConfig</span>(<span class="src-id">dataAdd</span>) <span class="src-sym">{</span></li>
<li><a name="a91"></a>      // <span class="src-id">TODO</span> : <span class="src-id">Validate input data</span></li>
<li><a name="a92"></a>      <span class="src-id">if</span> (<span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-id">config</span>.<span class="src-id">value</span> == '') <span class="src-sym">{</span></li>
<li><a name="a93"></a>        <span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-id">config</span>.<span class="src-id">value</span> = <span class="src-id">dataAdd</span>;</li>
<li><a name="a94"></a>      <span class="src-sym">}</span></li>
<li><a name="a95"></a>      <span class="src-id">else </span><span class="src-sym">{</span></li>
<li><a name="a96"></a>        <span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-id">config</span>.<span class="src-id">value</span> = <span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-id">config</span>.<span class="src-id">value</span> + '|' + <span class="src-id">dataAdd</span>;</li>
<li><a name="a97"></a>      <span class="src-sym">}</span></li>
<li><a name="a98"></a>      //<span class="src-id">alert</span>(<span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-id">config</span>.<span class="src-id">value</span>);  // <span class="src-id">DEBUG</span></li>
<li><a name="a99"></a>    <span class="src-sym">}</span></li>
<li><a name="a100"></a>  &lt;/<span class="src-id">SCRIPT</span>&gt;</li>
<li><a name="a101"></a>&nbsp;</li>
<li><a name="a102"></a>&lt;/<span class="src-id">HEAD</span>&gt;</li>
<li><a name="a103"></a>&lt;<span class="src-id">BODY text</span>=&quot;<span class="src-id">black</span>&quot; <span class="src-id">bgcolor</span>=&quot;#<span class="src-id">CFCFCF</span>&quot;&gt;</li>
<li><a name="a104"></a>&nbsp;</li>
<li><a name="a105"></a>&lt;<span class="src-id">style type</span>=&quot;<span class="src-id">text</span>/<span class="src-id">css</span>&quot;&gt;</li>
<li><a name="a106"></a>&lt;!--</li>
<li><a name="a107"></a>.<span class="src-id">button</span> /* <span class="src-id">Homemade button</span> */</li>
<li><a name="a108"></a><span class="src-sym">{</span></li>
<li><a name="a109"></a>  <span class="src-id">font</span>-<span class="src-id">size</span>: 12<span class="src-id">pt</span>;</li>
<li><a name="a110"></a>  <span class="src-id">font</span>-<span class="src-id">weight</span>: <span class="src-id">bold</span>;</li>
<li><a name="a111"></a>  <span class="src-id">color</span>: <span class="src-id">black</span>;</li>
<li><a name="a112"></a>  <span class="src-id">background</span>: #<span class="src-id">D4D0C8</span>;</li>
<li><a name="a113"></a>  <span class="src-id">text</span>-<span class="src-id">decoration</span>: <span class="src-id">none</span>;</li>
<li><a name="a114"></a>  <span class="src-id">border</span>-<span class="src-id">top</span>: 1<span class="src-id">px solid white</span>;</li>
<li><a name="a115"></a>  <span class="src-id">border</span>-<span class="src-id">right</span>: 2<span class="src-id">px solid gray</span>;</li>
<li><a name="a116"></a>  <span class="src-id">border</span>-<span class="src-id">bottom</span>: 2<span class="src-id">px solid gray</span>;</li>
<li><a name="a117"></a>  <span class="src-id">border</span>-<span class="src-id">left</span>: 1<span class="src-id">px solid white</span>;</li>
<li><a name="a118"></a>  <span class="src-id">padding</span>: 1<span class="src-id">px </span>4<span class="src-id">px </span>1<span class="src-id">px </span>4<span class="src-id">px</span>;</li>
<li><a name="a119"></a><span class="src-sym">}</span></li>
<li><a name="a120"></a>&nbsp;</li>
<li><a name="a121"></a><span class="src-id">td</span></li>
<li><a name="a122"></a><span class="src-sym">{</span></li>
<li><a name="a123"></a>  <span class="src-id">padding</span>: 1<span class="src-id">px </span>4<span class="src-id">px </span>1<span class="src-id">px </span>4<span class="src-id">px</span>;</li>
<li><a name="a124"></a><span class="src-sym">}</span></li>
<li><a name="a125"></a>//--&gt;</li>
<li><a name="a126"></a>&lt;/<span class="src-id">style</span>&gt;</li>
<li><a name="a127"></a>&nbsp;</li>
<li><a name="a128"></a>&lt;<span class="src-id">FORM NAME</span>=&quot;<span class="src-id">myform</span>&quot; <span class="src-id">METHOD</span>=&quot;<span class="src-id">post</span>&quot;&gt;</li>
<li><a name="a129"></a>&lt;<span class="src-id">INPUT TYPE</span>=&quot;<span class="src-id">HIDDEN</span>&quot; <span class="src-id">NAME</span>=&quot;<span class="src-id">page</span>&quot;&gt;</li>
<li><a name="a130"></a>&lt;<span class="src-id">INPUT TYPE</span>=&quot;<span class="src-id">HIDDEN</span>&quot; <span class="src-id">NAME</span>=&quot;<span class="src-id">action</span>&quot;&gt;</li>
<li><a name="a131"></a>&lt;<span class="src-id">INPUT TYPE</span>=&quot;<span class="src-id">HIDDEN</span>&quot; <span class="src-id">NAME</span>=&quot;<span class="src-id">debug</span>&quot;&gt;</li>
<li><a name="a132"></a>&lt;<span class="src-id">INPUT TYPE</span>=&quot;<span class="src-id">HIDDEN</span>&quot; <span class="src-id">NAME</span>=&quot;<span class="src-id">config</span>&quot;&gt;</li>
<li><a name="a133"></a>&nbsp;</li>
<li><a name="a134"></a>EndHTML<span class="src-sym">;</span></li>
<li><a name="a135"></a><span class="src-comm">#print &quot;&lt;PRE&gt;&quot;;      # DEBUG</span></li>
<li><a name="a136"></a><span class="src-comm">#print_r($_SERVER);  # DEBUG</span></li>
<li><a name="a137"></a><span class="src-comm">#print_r($_REQUEST); # DEBUG</span></li>
<li><a name="a138"></a><span class="src-comm">#print &quot;&lt;/PRE&gt;&quot;;     # DEBUG</span></li>
<li><a name="a139"></a><span class="src-comm">#exit();</span></li>
<li><a name="a140"></a>&nbsp;</li>
<li><a name="a141"></a><span class="src-comm"># Minimal version needed</span></li>
<li><a name="a142"></a><span class="src-var">$requiredPHPVersion       </span>= <span class="src-str">'5.0.0'</span><span class="src-sym">;</span></li>
<li><a name="a143"></a><span class="src-var">$requiredMySQLVersion     </span>= <span class="src-str">'0.0.0'</span><span class="src-sym">; </span><span class="src-comm">// Todo</span></li>
<li><a name="a144"></a><span class="src-var">$requiredPostgeSQLVersion </span>= <span class="src-str">'0.0.0'</span><span class="src-sym">; </span><span class="src-comm">// Todo</span></li>
<li><a name="a145"></a>&nbsp;</li>
<li><a name="a146"></a><span class="src-comm"># Needed files/directories with write access</span></li>
<li><a name="a147"></a><span class="src-var">$dir_array </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'tmp'</span><span class="src-sym">, </span><span class="src-str">'tmp/magpie_cache'</span><span class="src-sym">, </span><span class="src-str">'lib/smarty'</span><span class="src-sym">, </span><span class="src-str">'tmp/smarty/templates_c'</span><span class="src-sym">, </span><span class="src-str">'lib/magpie'</span><span class="src-sym">, </span><span class="src-str">'lib/Phlickr'</span><span class="src-sym">, </span><span class="src-str">'config.php'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a148"></a>&nbsp;</li>
<li><a name="a149"></a><span class="src-var">$smarty_full_url    </span>= <span class="src-str">'http://smarty.php.net/do_download.php?download_file=Smarty-2.6.7.tar.gz'</span><span class="src-sym">;</span></li>
<li><a name="a150"></a><span class="src-var">$magpierss_full_url </span>= <span class="src-str">'http://easynews.dl.sourceforge.net/sourceforge/magpierss/magpierss-0.71.1.tar.gz'</span><span class="src-sym">;</span></li>
<li><a name="a151"></a><span class="src-var">$phlickr_full_url   </span>= <span class="src-str">'http://easynews.dl.sourceforge.net/sourceforge/phlickr/Phlickr-0.2.4.tgz'</span><span class="src-sym">;</span></li>
<li><a name="a152"></a>&nbsp;</li>
<li><a name="a153"></a><span class="src-var">$neededPackages </span>= <span class="src-key">array</span><span class="src-sym">(</span></li>
<li><a name="a154"></a>  <span class="src-str">'smarty'    </span>=&gt; <span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'needed' </span>=&gt; <span class="src-num">1</span><span class="src-sym">, </span><span class="src-str">'available' </span>=&gt; <span class="src-num">0</span><span class="src-sym">, </span><span class="src-str">'message' </span>=&gt; <span class="src-str">''</span><span class="src-sym">, </span><span class="src-str">'file' </span>=&gt; <span class="src-str">'lib/smarty/Smarty.class.php'</span><span class="src-sym">)</span><span class="src-sym">,</span></li>
<li><a name="a155"></a>  <span class="src-str">'magpierss' </span>=&gt; <span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'needed' </span>=&gt; <span class="src-num">0</span><span class="src-sym">, </span><span class="src-str">'available' </span>=&gt; <span class="src-num">0</span><span class="src-sym">, </span><span class="src-str">'message' </span>=&gt; <span class="src-str">''</span><span class="src-sym">, </span><span class="src-str">'file' </span>=&gt; <span class="src-str">'lib/magpie/rss_fetch.inc'</span><span class="src-sym">)</span><span class="src-sym">,</span></li>
<li><a name="a156"></a>  <span class="src-str">'phlickr'   </span>=&gt; <span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'needed' </span>=&gt; <span class="src-num">0</span><span class="src-sym">, </span><span class="src-str">'available' </span>=&gt; <span class="src-num">0</span><span class="src-sym">, </span><span class="src-str">'message' </span>=&gt; <span class="src-str">''</span><span class="src-sym">, </span><span class="src-str">'file' </span>=&gt; <span class="src-str">'lib/Phlickr/Photo.php'</span><span class="src-sym">)</span></li>
<li><a name="a157"></a><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a158"></a>&nbsp;</li>
<li><a name="a159"></a><span class="src-var">$neededExtentions </span>= <span class="src-key">array</span><span class="src-sym">(</span></li>
<li><a name="a160"></a>  <span class="src-str">'xml'      </span>=&gt; <span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'needed'    </span>=&gt; <span class="src-num">0</span><span class="src-sym">,</span></li>
<li><a name="a161"></a>                      <span class="src-str">'available' </span>=&gt; <span class="src-num">0</span><span class="src-sym">,</span></li>
<li><a name="a162"></a>                      <span class="src-str">'message'   </span>=&gt; <span class="src-str">'&lt;B&gt;xml&lt;/B&gt; extention is missing'</span><span class="src-sym">,</span></li>
<li><a name="a163"></a>                      <span class="src-str">'note'      </span>=&gt; <span class="src-str">'Required for RSS support'</span><span class="src-sym">)</span><span class="src-sym">,</span></li>
<li><a name="a164"></a>  <span class="src-str">'pgsql'    </span>=&gt; <span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'needed'    </span>=&gt; <span class="src-num">1</span><span class="src-sym">,</span></li>
<li><a name="a165"></a>                      <span class="src-str">'available' </span>=&gt; <span class="src-num">0</span><span class="src-sym">,</span></li>
<li><a name="a166"></a>                      <span class="src-str">'message'   </span>=&gt; <span class="src-str">'&lt;B&gt;Posgresql&lt;/B&gt; extention is missing'</span><span class="src-sym">,</span></li>
<li><a name="a167"></a>                      <span class="src-str">'note'      </span>=&gt; <span class="src-str">'Required to connect to Postgresql database'</span><span class="src-sym">)</span><span class="src-sym">,</span></li>
<li><a name="a168"></a>  <span class="src-str">'mysql'    </span>=&gt; <span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'needed'    </span>=&gt; <span class="src-num">0</span><span class="src-sym">,</span></li>
<li><a name="a169"></a>                      <span class="src-str">'available' </span>=&gt; <span class="src-num">0</span><span class="src-sym">,</span></li>
<li><a name="a170"></a>                      <span class="src-str">'message'   </span>=&gt; <span class="src-str">'&lt;B&gt;MySQL&lt;/B&gt; extention is missing'</span><span class="src-sym">,</span></li>
<li><a name="a171"></a>                      <span class="src-str">'note'      </span>=&gt; <span class="src-str">'Required to connect to MySQL database (experimental and not working)'</span><span class="src-sym">)</span><span class="src-sym">,</span></li>
<li><a name="a172"></a>  <span class="src-str">'dom'      </span>=&gt; <span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'needed'    </span>=&gt; <span class="src-num">1</span><span class="src-sym">,</span></li>
<li><a name="a173"></a>                      <span class="src-str">'available' </span>=&gt; <span class="src-num">0</span><span class="src-sym">,</span></li>
<li><a name="a174"></a>                      <span class="src-str">'message'   </span>=&gt; <span class="src-str">'&lt;B&gt;DOM&lt;/B&gt; extention is missing'</span><span class="src-sym">,</span></li>
<li><a name="a175"></a>                      <span class="src-str">'note'      </span>=&gt; <span class="src-str">'Required if you want to export the list of HotSpots as a RSS feed'</span><span class="src-sym">)</span><span class="src-sym">,</span></li>
<li><a name="a176"></a>  <span class="src-str">'gettext'  </span>=&gt; <span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'needed'    </span>=&gt; <span class="src-num">0</span><span class="src-sym">,</span></li>
<li><a name="a177"></a>                      <span class="src-str">'available' </span>=&gt; <span class="src-num">0</span><span class="src-sym">,</span></li>
<li><a name="a178"></a>                      <span class="src-str">'message'   </span>=&gt; <span class="src-str">'Gettext is unavailable, the auth-server will work, but you will loose internationalization'</span><span class="src-sym">,</span></li>
<li><a name="a179"></a>                      <span class="src-str">'note'      </span>=&gt; <span class="src-str">'Internationalization support'</span><span class="src-sym">)</span><span class="src-sym">,</span></li>
<li><a name="a180"></a>  <span class="src-str">'mbstring' </span>=&gt; <span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'needed'    </span>=&gt; <span class="src-num">1</span><span class="src-sym">,</span></li>
<li><a name="a181"></a>                      <span class="src-str">'available' </span>=&gt; <span class="src-num">0</span><span class="src-sym">,</span></li>
<li><a name="a182"></a>                      <span class="src-str">'message'   </span>=&gt; <span class="src-str">'&lt;B&gt;mbstring&lt;/B&gt; extention is missing'</span><span class="src-sym">,</span></li>
<li><a name="a183"></a>                      <span class="src-str">'note'      </span>=&gt; <span class="src-str">'Required for core auth-server and RSS support'</span><span class="src-sym">)</span><span class="src-sym">,</span></li>
<li><a name="a184"></a>  <span class="src-str">'mcrypt'   </span>=&gt; <span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'needed'    </span>=&gt; <span class="src-num">0</span><span class="src-sym">,</span></li>
<li><a name="a185"></a>                      <span class="src-str">'available' </span>=&gt; <span class="src-num">0</span><span class="src-sym">,</span></li>
<li><a name="a186"></a>                      <span class="src-str">'message'   </span>=&gt; <span class="src-str">'&lt;B&gt;mcrypt&lt;/B&gt; extention is missing'</span><span class="src-sym">,</span></li>
<li><a name="a187"></a>                      <span class="src-str">'note'      </span>=&gt; <span class="src-str">'Required for RADIUS support'</span><span class="src-sym">)</span><span class="src-sym">,</span></li>
<li><a name="a188"></a>  <span class="src-str">'mhash'    </span>=&gt; <span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'needed'    </span>=&gt; <span class="src-num">0</span><span class="src-sym">,</span></li>
<li><a name="a189"></a>                      <span class="src-str">'available' </span>=&gt; <span class="src-num">0</span><span class="src-sym">,</span></li>
<li><a name="a190"></a>                      <span class="src-str">'message'   </span>=&gt; <span class="src-str">'&lt;B&gt;mhash&lt;/B&gt; extention is missing'</span><span class="src-sym">,</span></li>
<li><a name="a191"></a>                      <span class="src-str">'note'      </span>=&gt; <span class="src-str">'Required for RADIUS support'</span><span class="src-sym">)</span><span class="src-sym">,</span></li>
<li><a name="a192"></a>  <span class="src-str">'xmlrpc'   </span>=&gt; <span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'needed'    </span>=&gt; <span class="src-num">0</span><span class="src-sym">,</span></li>
<li><a name="a193"></a>                      <span class="src-str">'available' </span>=&gt; <span class="src-num">0</span><span class="src-sym">,</span></li>
<li><a name="a194"></a>                      <span class="src-str">'message'   </span>=&gt; <span class="src-str">'&lt;B&gt;xmlrpc&lt;/B&gt; extention is missing'</span><span class="src-sym">,</span></li>
<li><a name="a195"></a>                      <span class="src-str">'note'      </span>=&gt; <span class="src-str">'Required for RADIUS support'</span><span class="src-sym">)</span></li>
<li><a name="a196"></a><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a197"></a>&nbsp;</li>
<li><a name="a198"></a><span class="src-var">$loadedExtensions </span>= <a href="http://www.php.net/array_flip">array_flip</a><span class="src-sym">(</span><a href="http://www.php.net/get_loaded_extensions">get_loaded_extensions</a><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">; </span><span class="src-comm"># Debug : An empty array for $loadedExtensions will show needed dependencies</span></li>
<li><a name="a199"></a>&nbsp;</li>
<li><a name="a200"></a><span class="src-var">$neededPEARPackages </span>= <span class="src-key">array</span><span class="src-sym">(</span></li>
<li><a name="a201"></a>  <span class="src-str">'radius'      </span>=&gt; <span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'needed' </span>=&gt; <span class="src-num">0</span><span class="src-sym">, </span><span class="src-str">'available' </span>=&gt; <span class="src-num">0</span><span class="src-sym">, </span><span class="src-str">'command' </span>=&gt; <span class="src-str">&quot;return dl('radius.so');&quot;</span><span class="src-sym">,                </span><span class="src-str">'message' </span>=&gt; <span class="src-str">'Try in command line : pear install radius'</span><span class="src-sym">)</span><span class="src-sym">,</span></li>
<li><a name="a202"></a>  <span class="src-str">'Auth_RADIUS' </span>=&gt; <span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'needed' </span>=&gt; <span class="src-num">0</span><span class="src-sym">, </span><span class="src-str">'available' </span>=&gt; <span class="src-num">0</span><span class="src-sym">, </span><span class="src-str">'command' </span>=&gt; <span class="src-str">&quot;return include_once 'Auth/RADIUS.php';&quot;</span><span class="src-sym">, </span><span class="src-str">'message' </span>=&gt; <span class="src-str">'Try in command line : pear install Auth_RADIUS'</span><span class="src-sym">)</span><span class="src-sym">,</span></li>
<li><a name="a203"></a>  <span class="src-str">'Crypt_CHAP'  </span>=&gt; <span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'needed' </span>=&gt; <span class="src-num">0</span><span class="src-sym">, </span><span class="src-str">'available' </span>=&gt; <span class="src-num">0</span><span class="src-sym">, </span><span class="src-str">'command' </span>=&gt; <span class="src-str">&quot;return include_once 'Crypt/CHAP.php';&quot;</span><span class="src-sym">,  </span><span class="src-str">'message' </span>=&gt; <span class="src-str">'Try in command line : pear install Crypt_CHAP (mhash and mcrypt extensions are needed)'</span><span class="src-sym">)</span></li>
<li><a name="a204"></a><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a205"></a>&nbsp;</li>
<li><a name="a206"></a><span class="src-var">$optionsInfo </span>= <span class="src-key">array</span><span class="src-sym">(</span></li>
<li><a name="a207"></a>  <span class="src-str">'SSL_AVAILABLE'                </span>=&gt; <span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'title'   </span>=&gt; <span class="src-str">'SSL Support'</span><span class="src-sym">,</span></li>
<li><a name="a208"></a>                                          <span class="src-str">'depend'  </span>=&gt; <span class="src-str">'return 1;'</span><span class="src-sym">,</span></li>
<li><a name="a209"></a>                                          <span class="src-str">'message' </span>=&gt; <span class="src-str">'&amp;nbsp;'</span><span class="src-sym">)</span><span class="src-sym">,</span></li>
<li><a name="a210"></a>  <span class="src-str">'RSS_SUPPORT'                  </span>=&gt; <span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'title'   </span>=&gt; <span class="src-str">'RSS Support'</span><span class="src-sym">,</span></li>
<li><a name="a211"></a>                                          <span class="src-str">'depend'  </span>=&gt; <span class="src-str">'return ($neededExtentions[\'xml\'][\'available\'] &amp;&amp; $neededPackages[\'magpierss\'][\'available\']);'</span><span class="src-sym">,</span></li>
<li><a name="a212"></a>                                          <span class="src-str">'message' </span>=&gt; <span class="src-str">'Missing &lt;B&gt;xml&lt;/B&gt; extentions or &lt;B&gt;MagpieRSS&lt;/B&gt;'</span><span class="src-sym">)</span><span class="src-sym">,</span></li>
<li><a name="a213"></a>  <span class="src-str">'PHLICKR_SUPPORT'              </span>=&gt; <span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'title'   </span>=&gt; <span class="src-str">'Flickr Photostream content support'</span><span class="src-sym">,</span></li>
<li><a name="a214"></a>                                          <span class="src-str">'depend'  </span>=&gt; <span class="src-str">'return $neededPackages[\'phlickr\'][\'available\'];'</span><span class="src-sym">,</span></li>
<li><a name="a215"></a>                                          <span class="src-str">'message' </span>=&gt; <span class="src-str">'&lt;B&gt;Phlickr&lt;/B&gt; library not installed'</span><span class="src-sym">)</span><span class="src-sym">,</span></li>
<li><a name="a216"></a>  <span class="src-str">'CONF_USE_CRON_FOR_DB_CLEANUP' </span>=&gt; <span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'title'   </span>=&gt; <span class="src-str">'Use cron for DB cleanup'</span><span class="src-sym">,</span></li>
<li><a name="a217"></a>                                          <span class="src-str">'depend'  </span>=&gt; <span class="src-str">'return 1;'</span><span class="src-sym">,</span></li>
<li><a name="a218"></a>                                          <span class="src-str">'message' </span>=&gt; <span class="src-str">'&amp;nbsp;'</span><span class="src-sym">)</span><span class="src-sym">,</span></li>
<li><a name="a219"></a>  <span class="src-str">'XSLT_SUPPORT'                 </span>=&gt; <span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'title'   </span>=&gt; <span class="src-str">'XSLT Support'</span><span class="src-sym">,</span></li>
<li><a name="a220"></a>                                          <span class="src-str">'depend'  </span>=&gt; <span class="src-str">'return 1;'</span><span class="src-sym">,</span></li>
<li><a name="a221"></a>                                          <span class="src-str">'message' </span>=&gt; <span class="src-str">'&amp;nbsp;'</span><span class="src-sym">)</span><span class="src-sym">,</span></li>
<li><a name="a222"></a>  <span class="src-str">'GMAPS_HOTSPOTS_MAP_ENABLED'   </span>=&gt; <span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'title'   </span>=&gt; <span class="src-str">'Google Maps Support'</span><span class="src-sym">,</span></li>
<li><a name="a223"></a>                                          <span class="src-str">'depend'  </span>=&gt; <span class="src-str">'return 1;'</span><span class="src-sym">,</span></li>
<li><a name="a224"></a>                                          <span class="src-str">'message' </span>=&gt; <span class="src-str">'&amp;nbsp;'</span><span class="src-sym">)</span></li>
<li><a name="a225"></a><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a226"></a>&nbsp;</li>
<li><a name="a227"></a><span class="src-key">foreach</span><span class="src-sym">(</span><span class="src-var">$neededExtentions </span><span class="src-key">as </span><span class="src-var">$key </span>=&gt; <span class="src-var">$value</span><span class="src-sym">) </span><span class="src-sym">{   </span><span class="src-comm"># Detect availables extentions</span></li>
<li><a name="a228"></a>    <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/array_key_exists">array_key_exists</a><span class="src-sym">(</span><span class="src-var">$key</span><span class="src-sym">, </span><span class="src-var">$loadedExtensions</span><span class="src-sym">))</span></li>
<li><a name="a229"></a>    <span class="src-var">$neededExtentions</span><span class="src-sym">[</span><span class="src-var">$key</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-str">'available'</span><span class="src-sym">] </span>= <span class="src-num">1</span><span class="src-sym">;</span></li>
<li><a name="a230"></a><span class="src-sym">}</span></li>
<li><a name="a231"></a>&nbsp;</li>
<li><a name="a232"></a><span class="src-key">foreach</span><span class="src-sym">(</span><span class="src-var">$neededPEARPackages </span><span class="src-key">as </span><span class="src-var">$key </span>=&gt; <span class="src-var">$value</span><span class="src-sym">) </span><span class="src-sym">{ </span><span class="src-comm"># Detect availables PEAR Packages</span></li>
<li><a name="a233"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">@</span>eval<span class="src-sym">(</span><span class="src-var">$neededPEARPackages</span><span class="src-sym">[</span><span class="src-var">$key</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-str">'command'</span><span class="src-sym">]</span><span class="src-sym">))</span></li>
<li><a name="a234"></a>    <span class="src-var">$neededPEARPackages</span><span class="src-sym">[</span><span class="src-var">$key</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-str">'available'</span><span class="src-sym">] </span>= <span class="src-num">1</span><span class="src-sym">;</span></li>
<li><a name="a235"></a><span class="src-sym">}</span></li>
<li><a name="a236"></a>&nbsp;</li>
<li><a name="a237"></a><span class="src-key">foreach</span><span class="src-sym">(</span><span class="src-var">$neededPackages </span><span class="src-key">as </span><span class="src-var">$key </span>=&gt; <span class="src-var">$value</span><span class="src-sym">) </span><span class="src-sym">{     </span><span class="src-comm"># Detect installed libraries (smarty, ...)</span></li>
<li><a name="a238"></a>    <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/file_exists">file_exists</a><span class="src-sym">(</span><span class="src-var">$basepath </span>. <span class="src-str">'/' </span>. <span class="src-var">$neededPackages</span><span class="src-sym">[</span><span class="src-var">$key</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-str">'file'</span><span class="src-sym">]</span><span class="src-sym">))</span></li>
<li><a name="a239"></a>    <span class="src-var">$neededPackages</span><span class="src-sym">[</span><span class="src-var">$key</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-str">'available'</span><span class="src-sym">] </span>= <span class="src-num">1</span><span class="src-sym">;</span></li>
<li><a name="a240"></a><span class="src-sym">}</span></li>
<li><a name="a241"></a>&nbsp;</li>
<li><a name="a242"></a><span class="src-var">$CONFIG_FILE       </span>= <span class="src-str">'config.php'</span><span class="src-sym">;</span></li>
<li><a name="a243"></a><span class="src-var">$LOCAL_CONFIG_FILE </span>= <span class="src-str">'local.config.php'</span><span class="src-sym">;</span></li>
<li><a name="a244"></a>&nbsp;</li>
<li><a name="a245"></a><span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$config</span><span class="src-sym">))  </span><span class="src-comm"># If not empty, save javascript 'config' variable to config.php file</span></li>
<li><a name="a246"></a>    <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionsaveConfig">saveConfig</a><span class="src-sym">(</span><span class="src-var">$config</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a247"></a>&nbsp;</li>
<li><a name="a248"></a><span class="src-comm">### Read Configuration file. Keys and Values =&gt; define('FOO', 'BRAK');</span></li>
<li><a name="a249"></a><span class="src-comm"># Use config.php if local.config.php does not exist</span></li>
<li><a name="a250"></a><span class="src-comm">//if(!file_exists(&quot;$basepath/$LOCAL_CONFIG_FILE&quot;))</span></li>
<li><a name="a251"></a>    <span class="src-var">$contentArray </span>= <a href="http://www.php.net/file">file</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-var">$basepath</span>/<span class="src-var">$CONFIG_FILE</span><span class="src-str">&quot;</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a252"></a><span class="src-comm">//else</span></li>
<li><a name="a253"></a><span class="src-comm">//  $contentArray = file(&quot;$basepath/$LOCAL_CONFIG_FILE&quot;);</span></li>
<li><a name="a254"></a>&nbsp;</li>
<li><a name="a255"></a><span class="src-var">$configArray </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a256"></a>&nbsp;</li>
<li><a name="a257"></a><span class="src-key">foreach</span><span class="src-sym">(</span><span class="src-var">$contentArray </span><span class="src-key">as </span><span class="src-var">$line</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a258"></a>  <span class="src-comm">#print &quot;$line&lt;BR&gt;&quot;; # Debug</span></li>
<li><a name="a259"></a>    <span class="src-key">if</span><span class="src-sym">(</span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">&quot;/^define\((.+)\);/&quot;</span><span class="src-sym">, </span><span class="src-var">$line</span><span class="src-sym">, </span><span class="src-var">$matchesArray</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a260"></a>    list<span class="src-sym">(</span><span class="src-var">$key</span><span class="src-sym">, </span><span class="src-var">$value</span><span class="src-sym">) </span>= <a href="http://www.php.net/explode">explode</a><span class="src-sym">(</span><span class="src-str">','</span><span class="src-sym">, </span><span class="src-var">$matchesArray</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a261"></a>    <span class="src-var">$pattern </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;/^'/&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;</span>/'$/<span class="src-str">&quot;</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a262"></a>    <span class="src-var">$replacement </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">''</span><span class="src-sym">, </span><span class="src-str">''</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a263"></a>    <span class="src-var">$key </span>= <a href="http://www.php.net/preg_replace">preg_replace</a><span class="src-sym">(</span><span class="src-var">$pattern</span><span class="src-sym">, </span><span class="src-var">$replacement</span><span class="src-sym">, </span><a href="http://www.php.net/trim">trim</a><span class="src-sym">(</span><span class="src-var">$key</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a264"></a>    <span class="src-var">$value </span>= <a href="http://www.php.net/preg_replace">preg_replace</a><span class="src-sym">(</span><span class="src-var">$pattern</span><span class="src-sym">, </span><span class="src-var">$replacement</span><span class="src-sym">, </span><a href="http://www.php.net/trim">trim</a><span class="src-sym">(</span><span class="src-var">$value</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a265"></a>    <span class="src-var">$configArray</span><span class="src-sym">[</span><span class="src-var">$key</span><span class="src-sym">] </span>= <span class="src-var">$value</span><span class="src-sym">;</span></li>
<li><a name="a266"></a>  <span class="src-sym">}</span></li>
<li><a name="a267"></a><span class="src-sym">}</span></li>
<li><a name="a268"></a>&nbsp;</li>
<li><a name="a269"></a><span class="src-comm"># Database connections variables</span></li>
<li><a name="a270"></a><span class="src-var">$CONF_DBMS              </span>= <span class="src-var">$configArray</span><span class="src-sym">[</span><span class="src-str">'CONF_DBMS'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a271"></a><span class="src-var">$CONF_DATABASE_HOST     </span>= <span class="src-var">$configArray</span><span class="src-sym">[</span><span class="src-str">'CONF_DATABASE_HOST'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a272"></a><span class="src-var">$CONF_DATABASE_NAME     </span>= <span class="src-var">$configArray</span><span class="src-sym">[</span><span class="src-str">'CONF_DATABASE_NAME'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a273"></a><span class="src-var">$CONF_DATABASE_USER     </span>= <span class="src-var">$configArray</span><span class="src-sym">[</span><span class="src-str">'CONF_DATABASE_USER'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a274"></a><span class="src-var">$CONF_DATABASE_PASSWORD </span>= <span class="src-var">$configArray</span><span class="src-sym">[</span><span class="src-str">'CONF_DATABASE_PASSWORD'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a275"></a>&nbsp;</li>
<li><a name="a276"></a><span class="src-comm"># Update SYSTEM_PATH if $system_path (value detected be this script) is not the same as the config.php value</span></li>
<li><a name="a277"></a><span class="src-comm"># Don't update SYSTEM_PATH before $page=='permissions' in case of no write access to config.php</span></li>
<li><a name="a278"></a><span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$configArray</span><span class="src-sym">[</span><span class="src-str">'SYSTEM_PATH'</span><span class="src-sym">] </span>!= <span class="src-var">$system_path </span><span class="src-key">and </span><span class="src-var">$page </span>== <span class="src-str">'smarty'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a279"></a>  print &lt;&lt;&lt;EndHTML</li>
<li><a name="a280"></a>&lt;<span class="src-id">script type</span>=&quot;<span class="src-id">text</span>/<span class="src-id">javascript</span>&quot;&gt;</li>
<li><a name="a281"></a>    <span class="src-id">newConfig</span>(&quot;<span class="src-id">SYSTEM_PATH</span>='<span class="src-var">$system_path</span>/'&quot;);</li>
<li><a name="a282"></a>&lt;/<span class="src-id">script</span>&gt;</li>
<li><a name="a283"></a>EndHTML<span class="src-sym">;</span><span class="src-sym">}</span></li>
<li><a name="a284"></a>&nbsp;</li>
<li><a name="a285"></a><span class="src-comm">//foreach($configArray as $key =&gt; $value) { print &quot;K=$key V=$value&lt;BR&gt;&quot;; } exit(); # DEBUG</span></li>
<li><a name="a286"></a>&nbsp;</li>
<li><a name="a287"></a><span class="src-comm">###################################</span></li>
<li><a name="a288"></a><span class="src-comm"># array (array1(name1, page1), array2(name2, page2), ..., arrayN(nameN, pageN));</span></li>
<li><a name="a289"></a><span class="src-comm"># Todo : Supporter HTTP_REFERER (j'me comprends)</span></li>
<li><a name="a290"></a><span class="src-key">function </span><a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-var">$dataArray</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a291"></a>  <span class="src-var">$SERVER </span>= <span class="src-var">$_SERVER</span><span class="src-sym">[</span><span class="src-str">'HTTP_HOST'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a292"></a>  <span class="src-var">$SCRIPT </span>= <span class="src-var">$_SERVER</span><span class="src-sym">[</span><span class="src-str">'SCRIPT_NAME'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a293"></a>  print <span class="src-str">&quot;\n&lt;P&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a294"></a>  <span class="src-key">foreach</span><span class="src-sym">(</span><span class="src-var">$dataArray </span><span class="src-key">as </span><span class="src-var">$num </span>=&gt; <span class="src-var">$navArray</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a295"></a>    <span class="src-var">$title  </span>= <span class="src-var">$navArray</span><span class="src-sym">[</span><span class="src-str">'title'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a296"></a>    <span class="src-var">$page   </span>= <span class="src-var">$navArray</span><span class="src-sym">[</span><span class="src-str">'page'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a297"></a>    <span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$navArray</span><span class="src-sym">[</span><span class="src-str">'action'</span><span class="src-sym">]</span><span class="src-sym">) </span>? <span class="src-var">$action </span>= <span class="src-str">'' </span>: <span class="src-var">$action </span>= <span class="src-var">$navArray</span><span class="src-sym">[</span><span class="src-str">'action'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a298"></a>    print &lt;&lt;&lt;EndHTML</li>
<li><a name="a299"></a>&lt;<span class="src-id">A HREF</span>=&quot;#&quot; <span class="src-id">ONCLICK</span>=&quot;<span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-id">page</span>.<span class="src-id">value</span> = '<span class="src-var">$page</span>'; <span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-id">action</span>.<span class="src-id">value</span> = '<span class="src-var">$action</span>'; <span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-id">submit</span>();&quot; <span class="src-id">CLASS</span>=&quot;<span class="src-id">button</span>&quot;&gt;<span class="src-var">$title</span>&lt;/<span class="src-id">A</span>&gt;</li>
<li><a name="a300"></a>&nbsp;</li>
<li><a name="a301"></a>EndHTML<span class="src-sym">;    </span><span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/array_key_exists">array_key_exists</a><span class="src-sym">(</span><span class="src-var">$num</span>+<span class="src-num">1</span><span class="src-sym">, </span><span class="src-var">$dataArray</span><span class="src-sym">))</span></li>
<li><a name="a302"></a>      print <span class="src-str">&quot;&amp;nbsp;-&amp;nbsp;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a303"></a>  <span class="src-sym">}</span></li>
<li><a name="a304"></a>  print <span class="src-str">&quot;&lt;/P&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a305"></a><span class="src-sym">}</span></li>
<li><a name="a306"></a>&nbsp;</li>
<li><a name="a307"></a><span class="src-comm">###################################</span></li>
<li><a name="a308"></a><span class="src-comm">#</span></li>
<li><a name="a309"></a><span class="src-key">function </span><a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionrefreshButton">refreshButton</a><span class="src-sym">(</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a310"></a>  print &lt;&lt;&lt;EndHTML</li>
<li><a name="a311"></a>&nbsp;</li>
<li><a name="a312"></a>&lt;<span class="src-id">P</span>&gt;&lt;<span class="src-id">A HREF</span>=&quot;#&quot; <span class="src-id">ONCLICK</span>=&quot;<span class="src-id">javascript</span>: <span class="src-id">window</span>.<span class="src-id">location</span>.<span class="src-id">reload</span>(<span class="src-id">true</span>);&quot; <span class="src-id">CLASS</span>=&quot;<span class="src-id">button</span>&quot;&gt;<span class="src-id">Refresh</span>&lt;/<span class="src-id">A</span>&gt;&lt;/<span class="src-id">P</span>&gt;</li>
<li><a name="a313"></a>EndHTML<span class="src-sym">;</span><span class="src-sym">}</span></li>
<li><a name="a314"></a>&nbsp;</li>
<li><a name="a315"></a><span class="src-comm">###################################</span></li>
<li><a name="a316"></a><span class="src-comm">#</span></li>
<li><a name="a317"></a><span class="src-comm">/*function debugButton() {</span></li>
<li><a name="a318"></a><span class="src-comm">  print &lt;&lt;&lt;EndHTML</span></li>
<li><a name="a319"></a><span class="src-comm">&lt;P&gt;&lt;INPUT TYPE=&quot;button&quot; VALUE=&quot;Debug&quot; ONCLICK=&quot;javascript: window.location.reload(true);&quot;&gt;&lt;/P&gt;</span></li>
<li><a name="a320"></a><span class="src-comm">EndHTML;</span></li>
<li><a name="a321"></a><span class="src-comm">} */</span></li>
<li><a name="a322"></a>&nbsp;</li>
<li><a name="a323"></a><span class="src-comm">###################################</span></li>
<li><a name="a324"></a><span class="src-comm"># In development</span></li>
<li><a name="a325"></a><span class="src-comm">/*function installPackage($pkg_name, $full_url, $copy) {</span></li>
<li><a name="a326"></a><span class="src-comm">    print &quot;&lt;H1&gt;$pkg_name installation&lt;/H1&gt;\n&quot;;</span></li>
<li><a name="a327"></a><span class="src-comm">    chdir(&quot;$basepath/tmp&quot;);</span></li>
<li><a name="a328"></a><span class="src-comm">    list($url, $filename) = split (&quot;=&quot;, $full_url);</span></li>
<li><a name="a329"></a>&nbsp;</li>
<li><a name="a330"></a><span class="src-comm">    print &quot;Download source code ($filename) : &quot;;</span></li>
<li><a name="a331"></a><span class="src-comm">    if (!file_exists($filename))</span></li>
<li><a name="a332"></a><span class="src-comm">      exec(&quot;wget \&quot;$url\&quot;&quot;, $output, $return);</span></li>
<li><a name="a333"></a><span class="src-comm">    if (!file_exists($filename)) // wget success if file exists</span></li>
<li><a name="a334"></a><span class="src-comm">      exec(&quot;wget \&quot;$full_url\&quot; 2&gt;&amp;1&quot;, $output_array, $return);</span></li>
<li><a name="a335"></a><span class="src-comm">    if (!file_exists($filename)) {</span></li>
<li><a name="a336"></a><span class="src-comm">      print &quot;&lt;B STYLE=\&quot;color:red\&quot;&gt;Error&lt;/B&gt;&lt;P&gt;Current working directory : &lt;B&gt;$basepath/tmp/smarty&lt;/B&gt;&quot;;</span></li>
<li><a name="a337"></a><span class="src-comm">      $output = implode(&quot;\n&quot;, $output_array);</span></li>
<li><a name="a338"></a><span class="src-comm">      print &quot;&lt;PRE&gt;&lt;B&gt;wget \&quot;$full_url\&quot;&lt;/B&gt;\n$output&lt;/PRE&gt;&quot;;</span></li>
<li><a name="a339"></a><span class="src-comm">      exit();</span></li>
<li><a name="a340"></a><span class="src-comm">    } else {</span></li>
<li><a name="a341"></a><span class="src-comm">      print &quot;OK&lt;BR&gt;&quot;;</span></li>
<li><a name="a342"></a><span class="src-comm">    }</span></li>
<li><a name="a343"></a>&nbsp;</li>
<li><a name="a344"></a><span class="src-comm">    print &quot;Uncompressing : &quot;;</span></li>
<li><a name="a345"></a><span class="src-comm">    $dirname = array_shift(split(&quot;.tar.gz&quot;, $filename));</span></li>
<li><a name="a346"></a>&nbsp;</li>
<li><a name="a347"></a><span class="src-comm">    if (!file_exists($dirname))</span></li>
<li><a name="a348"></a><span class="src-comm">      exec(&quot;tar -xzf $dirname.tar.gz &amp;&gt;/tmp/tar.output&quot;, $output, $return);</span></li>
<li><a name="a349"></a><span class="src-comm">    print &quot;OK&lt;BR&gt;&quot;;</span></li>
<li><a name="a350"></a>&nbsp;</li>
<li><a name="a351"></a><span class="src-comm">    exec(&quot;pwd&quot;, $output, $return);</span></li>
<li><a name="a352"></a><span class="src-comm">    print &quot;Copying : &quot;;</span></li>
<li><a name="a353"></a><span class="src-comm">    if (!file_exists('../../lib/smarty/Smarty.class.php'));</span></li>
<li><a name="a354"></a><span class="src-comm">      exec(&quot;cp -r $dirname/libs/* ../../lib/smarty &amp;&gt;/tmp/cp.output&quot;, $output, $return);</span></li>
<li><a name="a355"></a><span class="src-comm">      exec(&quot;cp -r $dirname/libs/* ../../lib/smarty &amp;&gt;/tmp/cp.output&quot;, $output, $return);</span></li>
<li><a name="a356"></a><span class="src-comm">      $copy</span></li>
<li><a name="a357"></a><span class="src-comm">    print &quot;OK&lt;BR&gt;&quot;;</span></li>
<li><a name="a358"></a><span class="src-comm">}*/</span></li>
<li><a name="a359"></a>&nbsp;</li>
<li><a name="a360"></a><span class="src-comm">###################################</span></li>
<li><a name="a361"></a><span class="src-comm">#</span></li>
<li><a name="a362"></a><span class="src-key">function </span><a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionsaveConfig">saveConfig</a><span class="src-sym">(</span><span class="src-var">$data</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a363"></a>  print <span class="src-str">&quot;</span><span class="src-str">&lt;!-- <span class="src-id">saveConfig</span> <span class="src-id">DATA</span>=(<span class="src-var">$data</span>) --&gt;\n</span><span class="src-str">&quot;</span><span class="src-sym">; </span><span class="src-comm"># DEBUG</span></li>
<li><a name="a364"></a>&nbsp;</li>
<li><a name="a365"></a>  <span class="src-key">global </span><span class="src-var">$basepath</span><span class="src-sym">;</span></li>
<li><a name="a366"></a>  <span class="src-key">global </span><span class="src-var">$CONFIG_FILE</span><span class="src-sym">;</span></li>
<li><a name="a367"></a>&nbsp;</li>
<li><a name="a368"></a>  <span class="src-var">$contentArray </span>= <a href="http://www.php.net/file">file</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-str"><span class="src-var">$basepath</span>/<span class="src-var">$CONFIG_FILE</span></span><span class="src-str">&quot;</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a369"></a>  <span class="src-var">$fd </span>= <a href="http://www.php.net/fopen">fopen</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-str"><span class="src-var">$basepath</span>/<span class="src-var">$CONFIG_FILE</span></span><span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-str">'w'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a370"></a>&nbsp;</li>
<li><a name="a371"></a>  <span class="src-var">$defineArrayToken </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a372"></a>  <span class="src-var">$defineArrayToken </span>= <a href="http://www.php.net/explode">explode</a><span class="src-sym">(</span><span class="src-str">'|'</span><span class="src-sym">, </span><span class="src-var">$data</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a373"></a>&nbsp;</li>
<li><a name="a374"></a>  <span class="src-key">foreach</span><span class="src-sym">(</span><span class="src-var">$defineArrayToken </span><span class="src-key">as </span><span class="src-var">$nameValue</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a375"></a>    list<span class="src-sym">(</span><span class="src-var">$name</span><span class="src-sym">, </span><span class="src-var">$value</span><span class="src-sym">) </span>= <a href="http://www.php.net/explode">explode</a><span class="src-sym">(</span><span class="src-str">'='</span><span class="src-sym">, </span><span class="src-var">$nameValue</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a376"></a>    <span class="src-var">$defineArray</span><span class="src-sym">[</span><span class="src-var">$name</span><span class="src-sym">] </span>= <span class="src-var">$value</span><span class="src-sym">;  </span><span class="src-comm"># New define value ($name and value)</span></li>
<li><a name="a377"></a>    <span class="src-comm">#print &quot;K=$name V=$value&lt;BR&gt;&quot;; # DEBUG</span></li>
<li><a name="a378"></a>  <span class="src-sym">}</span></li>
<li><a name="a379"></a>&nbsp;</li>
<li><a name="a380"></a>  <span class="src-key">foreach</span><span class="src-sym">(</span><span class="src-var">$contentArray </span><span class="src-key">as </span><span class="src-var">$line</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a381"></a>    <span class="src-comm">#print &quot;L=$line&lt;BR&gt;\n&quot;;</span></li>
<li><a name="a382"></a>    <span class="src-key">if</span><span class="src-sym">(</span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">&quot;/^define\((.+)\);/&quot;</span><span class="src-sym">, </span><span class="src-var">$line</span><span class="src-sym">, </span><span class="src-var">$matchesArray</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a383"></a>      list<span class="src-sym">(</span><span class="src-var">$key</span><span class="src-sym">, </span><span class="src-var">$value</span><span class="src-sym">) </span>= <a href="http://www.php.net/explode">explode</a><span class="src-sym">(</span><span class="src-str">','</span><span class="src-sym">, </span><span class="src-var">$matchesArray</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a384"></a>      <span class="src-var">$pattern     </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;/^'/&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;</span><span class="src-str">/'$/</span><span class="src-str">&quot;</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a385"></a>      <span class="src-var">$replacement </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">''</span><span class="src-sym">, </span><span class="src-str">''</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a386"></a>      <span class="src-var">$key   </span>= <a href="http://www.php.net/preg_replace">preg_replace</a><span class="src-sym">(</span><span class="src-var">$pattern</span><span class="src-sym">, </span><span class="src-var">$replacement</span><span class="src-sym">, </span><a href="http://www.php.net/trim">trim</a><span class="src-sym">(</span><span class="src-var">$key</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a387"></a>      <span class="src-comm">//$value = preg_replace($pattern, $replacement, trim($value));</span></li>
<li><a name="a388"></a>&nbsp;</li>
<li><a name="a389"></a>      <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/array_key_exists">array_key_exists</a><span class="src-sym">(</span><span class="src-var">$key</span><span class="src-sym">, </span><span class="src-var">$defineArray</span><span class="src-sym">)) </span><span class="src-sym">{ </span><span class="src-comm">// A new value is defined</span></li>
<li><a name="a390"></a>        <span class="src-comm">#print &quot;$key EXISTS&lt;BR&gt;&quot;;</span></li>
<li><a name="a391"></a>        <span class="src-comm">#print &quot;define =&gt; (&quot; . $defineArray[$key] . &quot;)&lt;BR&gt;&quot;;</span></li>
<li><a name="a392"></a>        <span class="src-var">$pattern     </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;/^\\\'/&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;</span><span class="src-str">/\\\'$/</span><span class="src-str">&quot;</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a393"></a>        <span class="src-var">$replacement </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;'&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;'&quot;</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a394"></a>        <span class="src-var">$value </span>= <a href="http://www.php.net/preg_replace">preg_replace</a><span class="src-sym">(</span><span class="src-var">$pattern</span><span class="src-sym">, </span><span class="src-var">$replacement</span><span class="src-sym">, </span><a href="http://www.php.net/trim">trim</a><span class="src-sym">(</span><span class="src-var">$defineArray</span><span class="src-sym">[</span><span class="src-var">$key</span><span class="src-sym">]</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a395"></a>        <span class="src-comm">#print &quot;(define('$key', $value);)&lt;BR&gt;&quot;;</span></li>
<li><a name="a396"></a>        <a href="http://www.php.net/fwrite">fwrite</a><span class="src-sym">(</span><span class="src-var">$fd</span><span class="src-sym">, </span><span class="src-str">&quot;</span><span class="src-str"><span class="src-id">define</span>('<span class="src-var">$key</span>', <span class="src-var">$value</span>);\n</span><span class="src-str">&quot;</span><span class="src-sym">)</span><span class="src-sym">; </span><span class="src-comm"># Write the new define($name, $value)</span></li>
<li><a name="a397"></a>      <span class="src-sym">}</span></li>
<li><a name="a398"></a>      <span class="src-key">else </span><span class="src-sym">{ </span><span class="src-comm">// The key does not exist (no new value to be saved)</span></li>
<li><a name="a399"></a>        <a href="http://www.php.net/fwrite">fwrite</a><span class="src-sym">(</span><span class="src-var">$fd</span><span class="src-sym">, </span><span class="src-var">$line</span><span class="src-sym">)</span><span class="src-sym">; </span><span class="src-comm"># Write the same line in config.php</span></li>
<li><a name="a400"></a>      <span class="src-sym">}</span></li>
<li><a name="a401"></a>    <span class="src-sym">}</span></li>
<li><a name="a402"></a>    <span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a403"></a>      <a href="http://www.php.net/fwrite">fwrite</a><span class="src-sym">(</span><span class="src-var">$fd</span><span class="src-sym">, </span><span class="src-var">$line</span><span class="src-sym">)</span><span class="src-sym">;   </span><span class="src-comm"># Write the line (not a define line). Ex: Commented text</span></li>
<li><a name="a404"></a>    <span class="src-sym">}</span></li>
<li><a name="a405"></a>  <span class="src-sym">}</span></li>
<li><a name="a406"></a><span class="src-sym">}</span></li>
<li><a name="a407"></a>&nbsp;</li>
<li><a name="a408"></a><span class="src-comm">###################################</span></li>
<li><a name="a409"></a><span class="src-comm"># MAIN</span></li>
<li><a name="a410"></a><span class="src-key">switch </span><span class="src-sym">(</span><span class="src-var">$page</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a411"></a>  <span class="src-key">case </span><span class="src-str">'version'</span>:</li>
<li><a name="a412"></a><span class="src-comm">/*  TODO : Valider qu'au moins une extention de DB est existante (pgsql, mysql, etc)</span></li>
<li><a name="a413"></a><span class="src-comm">           Definir les versions minimales de Posgres et MySQL */</span></li>
<li><a name="a414"></a>&nbsp;</li>
<li><a name="a415"></a>    print <span class="src-str">&quot;&lt;H1&gt;Version validation&lt;/H1&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a416"></a>    print <span class="src-str">&quot;&lt;TABLE BORDER=\&quot;1\&quot;&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a417"></a>&nbsp;</li>
<li><a name="a418"></a>    <span class="src-var">$phpVersion </span>= <a href="http://www.php.net/phpversion">phpversion</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a419"></a>    <span class="src-var">$okMsg      </span>= <span class="src-str">'&lt;TD ALIGN=&quot;CENTER&quot; STYLE=&quot;background:lime;&quot;&gt;OK&lt;/TD&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a420"></a>    <span class="src-var">$errorMsg   </span>= <span class="src-str">'&lt;TD ALIGN=&quot;CENTER&quot; STYLE=&quot;background:red;&quot;&gt;ERROR&lt;/TD&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a421"></a>    <span class="src-var">$warningMsg </span>= <span class="src-str">'&lt;TD ALIGN=&quot;CENTER&quot; STYLE=&quot;background:yellow;&quot;&gt;Warning&lt;/TD&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a422"></a>    <span class="src-var">$error </span>= <span class="src-num">0</span><span class="src-sym">;</span></li>
<li><a name="a423"></a>&nbsp;</li>
<li><a name="a424"></a>    print <span class="src-str">&quot;&lt;TR&gt;&lt;TD&gt;PHP&lt;/TD&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a425"></a>    <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/version_compare">version_compare</a><span class="src-sym">(</span><span class="src-var">$phpVersion</span><span class="src-sym">, </span><span class="src-var">$requiredPHPVersion</span><span class="src-sym">, </span><span class="src-str">&quot;&gt;=&quot;</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a426"></a>      print <span class="src-str">&quot;</span><span class="src-var">$okMsg</span>&lt;<span class="src-id">TD</span>&gt;<span class="src-var">$phpVersion</span>&lt;/<span class="src-id">TD</span>&gt;<span class="src-str">&quot;</span><span class="src-sym">;  </span><span class="src-comm">// Version 5.0.0 or later</span></li>
<li><a name="a427"></a>        <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a428"></a>      print <span class="src-str">&quot;</span><span class="src-var">$errorMsg</span>&lt;<span class="src-id">TD</span>&gt;<span class="src-id">Version </span><span class="src-var">$requiredPHPVersion </span><span class="src-id">needed</span>&lt;/<span class="src-id">TD</span>&gt;<span class="src-str">&quot;</span><span class="src-sym">; </span><span class="src-comm">// Version &lt; 5.0.0</span></li>
<li><a name="a429"></a>            <span class="src-var">$error </span>= <span class="src-num">1</span><span class="src-sym">;</span></li>
<li><a name="a430"></a>    <span class="src-sym">}</span></li>
<li><a name="a431"></a>    print <span class="src-str">&quot;&lt;/TR&gt;&lt;/TABLE&gt;&lt;BR&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a432"></a>&nbsp;</li>
<li><a name="a433"></a>    print <span class="src-str">&quot;&lt;TABLE BORDER=\&quot;1\&quot;&gt;&lt;TR&gt;&lt;TD&gt;&lt;B&gt;Extention&lt;/B&gt;&lt;/TD&gt;&lt;TD&gt;&lt;B&gt;Status&lt;/B&gt;&lt;/TD&gt;&lt;TD&gt;&lt;B&gt;Note&lt;/B&gt;&lt;/TD&gt;&lt;TD&gt;&lt;B&gt;Message&lt;/B&gt;&lt;/TD&gt;&lt;/TR&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a434"></a>    <span class="src-key">foreach</span><span class="src-sym">(</span><span class="src-var">$neededExtentions </span><span class="src-key">as </span><span class="src-var">$key </span>=&gt; <span class="src-var">$value</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a435"></a>      print  <span class="src-str">&quot;</span>&lt;<span class="src-id">TR</span>&gt;&lt;<span class="src-id">TD</span>&gt;&lt;<span class="src-id">A HREF</span>=\&quot;<span class="src-id">http</span>://<span class="src-id">www</span>.<span class="src-id">php</span>.<span class="src-id">net</span>/<span class="src-var">$key</span>\&quot;&gt;<span class="src-var">$key</span>&lt;/<span class="src-id">A</span>&gt;&lt;/<span class="src-id">TD</span>&gt;<span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a436"></a>      <span class="src-var">$note </span>= <span class="src-var">$neededExtentions</span><span class="src-sym">[</span><span class="src-var">$key</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-str">'note'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a437"></a>      <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$neededExtentions</span><span class="src-sym">[</span><span class="src-var">$key</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-str">'available'</span><span class="src-sym">]</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a438"></a>        print  <span class="src-str">&quot;</span><span class="src-var">$okMsg</span>&lt;<span class="src-id">TD</span>&gt;<span class="src-var">$note</span>&lt;/<span class="src-id">TD</span>&gt;&lt;<span class="src-id">TD</span>&gt;&amp;<span class="src-id">nbsp</span>;&lt;/<span class="src-id">TD</span>&gt;&lt;/<span class="src-id">TR</span>&gt;<span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a439"></a>      <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a440"></a>        <span class="src-var">$message </span>= <span class="src-var">$neededExtentions</span><span class="src-sym">[</span><span class="src-var">$key</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-str">'message'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a441"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$neededExtentions</span><span class="src-sym">[</span><span class="src-var">$key</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-str">'needed'</span><span class="src-sym">] </span>== <span class="src-num">1</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a442"></a>          print  <span class="src-str">&quot;</span><span class="src-var">$errorMsg</span>&lt;<span class="src-id">TD</span>&gt;<span class="src-var">$note</span>&lt;/<span class="src-id">TD</span>&gt;&lt;<span class="src-id">TD</span>&gt;<span class="src-var">$message</span>&lt;/<span class="src-id">TD</span>&gt;&lt;/<span class="src-id">TR</span>&gt;<span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a443"></a>          <span class="src-var">$error </span>= <span class="src-num">1</span><span class="src-sym">;</span></li>
<li><a name="a444"></a>        <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a445"></a>          print  <span class="src-str">&quot;</span><span class="src-var">$warningMsg</span>&lt;<span class="src-id">TD</span>&gt;<span class="src-var">$note</span>&lt;/<span class="src-id">TD</span>&gt;&lt;<span class="src-id">TD</span>&gt;<span class="src-var">$message</span>&lt;/<span class="src-id">TD</span>&gt;&lt;/<span class="src-id">TR</span>&gt;<span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a446"></a>        <span class="src-sym">}</span></li>
<li><a name="a447"></a>      <span class="src-sym">}</span></li>
<li><a name="a448"></a>    <span class="src-sym">}</span></li>
<li><a name="a449"></a>    print <span class="src-str">&quot;&lt;/TABLE&gt;&lt;BR&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a450"></a>&nbsp;</li>
<li><a name="a451"></a>    <span class="src-doc">/**********************************</span></li>
<li><a name="a452"></a><span class="src-doc">    * PEAR Components</span></li>
<li><a name="a453"></a><span class="src-doc">    *************************************/</span></li>
<li><a name="a453"></a>&nbsp;</li>
<li><a name="a454"></a>    print <span class="src-str">&quot;&lt;TABLE BORDER=\&quot;1\&quot;&gt;&lt;TR&gt;&lt;TD COLSPAN=\&quot;3\&quot;&gt;&lt;CENTER&gt;&lt;B&gt;PEAR&lt;/B&gt;&lt;/CENTER&gt;&lt;/TD&gt;&lt;/TR&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a455"></a>    print <span class="src-str">&quot;&lt;TR&gt;&lt;TD&gt;&lt;B&gt;Component&lt;/B&gt;&lt;/TD&gt;&lt;TD&gt;&lt;B&gt;Status&lt;/B&gt;&lt;/TD&gt;&lt;TD&gt;&lt;B&gt;Note&lt;/B&gt;&lt;/TD&gt;&lt;/TR&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a456"></a>&nbsp;</li>
<li><a name="a457"></a>    <span class="src-key">foreach</span><span class="src-sym">(</span><span class="src-var">$neededPEARPackages </span><span class="src-key">as </span><span class="src-var">$key </span>=&gt; <span class="src-var">$value</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a458"></a>      <span class="src-var">$return </span>= <span class="src-num">0</span><span class="src-sym">;</span></li>
<li><a name="a459"></a>      print  <span class="src-str">&quot;</span>&lt;<span class="src-id">TR</span>&gt;&lt;<span class="src-id">TD</span>&gt;&lt;<span class="src-id">A HREF</span>=\&quot;<span class="src-id">http</span>://<span class="src-id">pear</span>.<span class="src-id">php</span>.<span class="src-id">net</span>/<span class="src-id">package</span>/<span class="src-var">$key</span>\&quot;&gt;<span class="src-var">$key</span>&lt;/<span class="src-id">A</span>&gt;&lt;/<span class="src-id">TD</span>&gt;<span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a460"></a>      <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$neededPEARPackages</span><span class="src-sym">[</span><span class="src-var">$key</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-str">'available'</span><span class="src-sym">]</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a461"></a>        print  <span class="src-str">&quot;</span><span class="src-var">$okMsg</span>&lt;<span class="src-id">TD</span>&gt;&amp;<span class="src-id">nbsp</span>;&lt;/<span class="src-id">TD</span>&gt;&lt;/<span class="src-id">TR</span>&gt;<span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a462"></a>      <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a463"></a>        <span class="src-var">$message </span>= <span class="src-var">$neededPEARPackages</span><span class="src-sym">[</span><span class="src-var">$key</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-str">'message'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a464"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$neededPEARPackages</span><span class="src-sym">[</span><span class="src-var">$key</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-str">'needed'</span><span class="src-sym">] </span>== <span class="src-num">1</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a465"></a>          print  <span class="src-str">&quot;</span><span class="src-var">$errorMsg</span>&lt;<span class="src-id">TD</span>&gt;<span class="src-var">$message</span>&lt;/<span class="src-id">TD</span>&gt;&lt;/<span class="src-id">TR</span>&gt;<span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a466"></a>          <span class="src-var">$error </span>= <span class="src-num">1</span><span class="src-sym">;</span></li>
<li><a name="a467"></a>        <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a468"></a>          print  <span class="src-str">&quot;</span><span class="src-var">$warningMsg</span>&lt;<span class="src-id">TD</span>&gt;<span class="src-var">$message</span>&lt;/<span class="src-id">TD</span>&gt;&lt;/<span class="src-id">TR</span>&gt;<span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a469"></a>        <span class="src-sym">}</span></li>
<li><a name="a470"></a>      <span class="src-sym">}</span></li>
<li><a name="a471"></a>    <span class="src-sym">}</span></li>
<li><a name="a472"></a>    print <span class="src-str">&quot;&lt;/TABLE&gt;&lt;BR&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a473"></a>&nbsp;</li>
<li><a name="a474"></a>    <span class="src-doc">/**********************************</span></li>
<li><a name="a475"></a><span class="src-doc">    * GD with PNG and JPEG support (will be needed by stats and graphics)</span></li>
<li><a name="a476"></a><span class="src-doc">    *************************************/</span></li>
<li><a name="a476"></a>&nbsp;</li>
<li><a name="a477"></a><span class="src-comm">/*  $gdInfo = @gd_info();</span></li>
<li><a name="a478"></a><span class="src-comm">    print &quot;&lt;TABLE BORDER=\&quot;1\&quot;&gt;&lt;TR&gt;&lt;TD&gt;&lt;PRE&gt;&quot;;</span></li>
<li><a name="a479"></a><span class="src-comm">    print_r($gdInfo);</span></li>
<li><a name="a480"></a><span class="src-comm">    print &quot;&lt;/PRE&gt;&lt;/TD&gt;&lt;/TR&gt;&lt;/TABLE&gt;&quot;;</span></li>
<li><a name="a481"></a><span class="src-comm">*/</span></li>
<li><a name="a482"></a>&nbsp;</li>
<li><a name="a483"></a><span class="src-comm">#    if (!($neededExtentions['pgsql']['available'] &amp;&amp; $neededExtentions['mysql']['available']))</span></li>
<li><a name="a484"></a><span class="src-comm">#      print &quot;At least one DB extentions is nedded&lt;BR&gt;&quot;;</span></li>
<li><a name="a485"></a>&nbsp;</li>
<li><a name="a485"></a>    </li>
<li><a name="a486"></a>    print <span class="src-str">&quot;&lt;B&gt;Todo&lt;/B&gt; : PostgreSLQ and MySQL version are not validated&quot;</span><span class="src-sym">;</span></li>
<li><a name="a487"></a>&nbsp;</li>
<li><a name="a488"></a>    <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionrefreshButton">refreshButton</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a489"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$error </span>!= <span class="src-num">1</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a490"></a>      <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Next&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;permission&quot;</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a491"></a>    <span class="src-sym">}</span></li>
<li><a name="a492"></a>&nbsp;</li>
<li><a name="a493"></a>  <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a494"></a>  <span class="src-comm">###################################</span></li>
<li><a name="a495"></a>    <span class="src-key">case </span><span class="src-str">'permission'</span>:</li>
<li><a name="a496"></a>    print <span class="src-str">&quot;&lt;H1&gt;Permissions&lt;/H1&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a497"></a>&nbsp;</li>
<li><a name="a498"></a>    <span class="src-var">$process_info_user_id  </span>= <a href="http://www.php.net/posix_getpwuid">posix_getpwuid</a><span class="src-sym">(</span><a href="http://www.php.net/posix_getuid">posix_getuid</a><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a499"></a>    <span class="src-var">$process_info_group_id </span>= <a href="http://www.php.net/posix_getgrgid">posix_getgrgid</a><span class="src-sym">(</span><a href="http://www.php.net/posix_getegid">posix_getegid</a><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a500"></a>    <span class="src-var">$process_username      </span>= <span class="src-var">$process_info_user_id</span><span class="src-sym">[</span><span class="src-str">'name'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a501"></a>    <span class="src-var">$process_group         </span>= <span class="src-var">$process_info_group_id</span><span class="src-sym">[</span><span class="src-str">'name'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a502"></a>    <span class="src-var">$cmd_mkdir </span>= <span class="src-str">''</span><span class="src-sym">;</span></li>
<li><a name="a503"></a>    <span class="src-var">$cmd_chown </span>= <span class="src-str">''</span><span class="src-sym">;</span></li>
<li><a name="a504"></a>    <span class="src-var">$error     </span>= <span class="src-num">0</span><span class="src-sym">;</span></li>
<li><a name="a505"></a>&nbsp;</li>
<li><a name="a506"></a>    print <span class="src-str">&quot;</span>&lt;<span class="src-id">P</span>&gt;&lt;<span class="src-id">B</span>&gt;<span class="src-id">Home</span>&lt;/<span class="src-id">B</span>&gt;: <span class="src-var">$basepath</span>&lt;/<span class="src-id">P</span>&gt;<span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a507"></a>    print <span class="src-str">&quot;</span>&lt;<span class="src-id">P</span>&gt;&lt;<span class="src-id">B</span>&gt;<span class="src-id">HTTPD username</span>/<span class="src-id">group</span>&lt;/<span class="src-id">B</span>&gt;: <span class="src-var">$process_username</span>/<span class="src-var">$process_group</span>&lt;/<span class="src-id">P</span>&gt;<span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a508"></a><span class="src-comm">#    print &quot;&lt;P&gt;&lt;B&gt;HTTPD group&lt;/B&gt;: $process_group&lt;BR&lt;/P&gt;&quot;;</span></li>
<li><a name="a509"></a>        print <span class="src-str">&quot;&lt;P&gt;&lt;TABLE BORDER=\&quot;1\&quot;&gt;&lt;TR&gt;&lt;TD&gt;&lt;B&gt;Directory&lt;/B&gt;&lt;/TD&gt;&lt;/TD&gt;&lt;TD&gt;&lt;B&gt;Owner&lt;/B&gt;&lt;/TD&gt;&lt;TD&gt;&lt;B&gt;Writable&lt;/B&gt;&lt;/TD&gt;&lt;/TR&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a510"></a>&nbsp;</li>
<li><a name="a511"></a>    <span class="src-key">foreach</span><span class="src-sym">(</span><span class="src-var">$dir_array </span><span class="src-key">as </span><span class="src-var">$dir</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a512"></a>      print <span class="src-str">&quot;</span>&lt;<span class="src-id">TR</span>&gt;&lt;<span class="src-id">TD</span>&gt;<span class="src-var">$dir</span>&lt;/<span class="src-id">TD</span>&gt;<span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a513"></a>      <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><a href="http://www.php.net/file_exists">file_exists</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-var">$basepath</span>/<span class="src-var">$dir</span><span class="src-str">&quot;</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a514"></a>        print <span class="src-str">&quot;&lt;TD COLSPAN=\&quot;2\&quot; STYLE=\&quot;text-align:center;\&quot;&gt;Missing&lt;/TD&gt;&lt;/TR&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a515"></a>        <span class="src-var">$cmd_mkdir </span>.= <span class="src-str">&quot;</span><span class="src-var">$basepath</span>/<span class="src-var">$dir </span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a516"></a>        <span class="src-var">$cmd_chown </span>.= <span class="src-str">&quot;</span><span class="src-var">$basepath</span>/<span class="src-var">$dir </span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a517"></a>        <span class="src-var">$error </span>= <span class="src-num">1</span><span class="src-sym">;</span></li>
<li><a name="a518"></a>        <span class="src-key">continue</span><span class="src-sym">;</span></li>
<li><a name="a519"></a>      <span class="src-sym">}</span></li>
<li><a name="a520"></a>&nbsp;</li>
<li><a name="a521"></a>      <span class="src-var">$dir_info </span>= <a href="http://www.php.net/posix_getpwuid">posix_getpwuid</a><span class="src-sym">(</span><a href="http://www.php.net/fileowner">fileowner</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-var">$basepath</span>/<span class="src-var">$dir</span><span class="src-str">&quot;</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a522"></a>      <span class="src-var">$dir_owner_username </span>= <span class="src-var">$dir_info</span><span class="src-sym">[</span><span class="src-str">'name'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a523"></a>      print <span class="src-str">&quot;</span>&lt;<span class="src-id">TD</span>&gt;<span class="src-var">$dir_owner_username</span>&lt;/<span class="src-id">TD</span>&gt;<span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a524"></a>&nbsp;</li>
<li><a name="a525"></a>      <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/is_writable">is_writable</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-var">$basepath</span>/<span class="src-var">$dir</span><span class="src-str">&quot;</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a526"></a>        print <span class="src-str">&quot;&lt;TD&gt;YES&lt;/TD&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a527"></a>      <span class="src-sym">}</span></li>
<li><a name="a528"></a>      <span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a529"></a>        print <span class="src-str">&quot;&lt;TD&gt;NO&lt;/TD&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a530"></a>        <span class="src-var">$cmd_chown </span>.= <span class="src-str">&quot;</span><span class="src-var">$basepath</span>/<span class="src-var">$dir </span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a531"></a>        <span class="src-var">$error </span>= <span class="src-num">1</span><span class="src-sym">;</span></li>
<li><a name="a532"></a>      <span class="src-sym">}</span></li>
<li><a name="a533"></a>      print <span class="src-str">&quot;&lt;/TR&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a534"></a>    <span class="src-sym">}</span></li>
<li><a name="a535"></a>    print <span class="src-str">&quot;&lt;/TABLE&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a536"></a>&nbsp;</li>
<li><a name="a537"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$error </span>!= <span class="src-num">1</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a538"></a>      <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Back&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;&quot;</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Next&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;smarty&quot;</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a539"></a>    <span class="src-sym">}</span></li>
<li><a name="a540"></a>    <span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a541"></a>      <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionrefreshButton">refreshButton</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a542"></a>      print <span class="src-str">&quot;</span>&lt;<span class="src-id">P</span>&gt;<span class="src-id">Please allow</span> &lt;<span class="src-id">B</span>&gt;<span class="src-var">$process_username</span>&lt;/<span class="src-id">B</span>&gt; <span class="src-id">to write to these directories</span> (<a href="http://www.php.net/mkdir">mkdir</a>, <a href="http://www.php.net/chown">chown</a> <span class="src-id">or </span><a href="http://www.php.net/chmod">chmod</a>)&lt;/<span class="src-id">P</span>&gt;<span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a543"></a>      <span class="src-key">if</span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$cmd_mkdir</span><span class="src-sym">))</span></li>
<li><a name="a544"></a>        print <span class="src-str">&quot;</span>&lt;<span class="src-id">P</span>&gt;&lt;<span class="src-id">B</span>&gt;<span class="src-id">Tips</span>&lt;/<span class="src-id">B</span>&gt; : <a href="http://www.php.net/mkdir">mkdir</a> <span class="src-var">$cmd_mkdir</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a545"></a>      <span class="src-key">if</span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$cmd_chown</span><span class="src-sym">))</span></li>
<li><a name="a546"></a>        print <span class="src-str">&quot;</span>&lt;<span class="src-id">P</span>&gt;&lt;<span class="src-id">B</span>&gt;<span class="src-id">Tips</span>&lt;/<span class="src-id">B</span>&gt;: <a href="http://www.php.net/chown">chown</a> -<span class="src-id">R </span><span class="src-var">$process_username</span>:<span class="src-var">$process_group $cmd_chown</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a547"></a>    <span class="src-sym">}</span></li>
<li><a name="a548"></a>  <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a549"></a>  <span class="src-comm">###################################</span></li>
<li><a name="a550"></a>    <span class="src-key">case </span><span class="src-str">'smarty'</span>: <span class="src-comm">// Download, uncompress and install Smarty</span></li>
<li><a name="a551"></a>        print &lt;&lt;&lt; EndHTML</li>
<li><a name="a552"></a>    &lt;<span class="src-id">H1</span>&gt;<span class="src-id">Smarty installation</span>&lt;/<span class="src-id">H1</span>&gt;</li>
<li><a name="a553"></a>    &lt;<span class="src-id">P</span>&gt;&lt;<span class="src-id">A HREF</span>=&quot;<span class="src-id">http</span>://<span class="src-id">smarty</span>.<span class="src-id">php</span>.<span class="src-id">net</span>/&quot;&gt;<span class="src-id">Smarty</span>&lt;/<span class="src-id">A</span>&gt; <span class="src-id">is known as a </span>&quot;<span class="src-id">Template Engine</span>&quot;. <span class="src-id">Wifidog s internal fonctionnality needs it</span>.&lt;/<span class="src-id">P</span>&gt;</li>
<li><a name="a554"></a>EndHTML<span class="src-sym">;    </span><span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$neededPackages</span><span class="src-sym">[</span><span class="src-str">'smarty'</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-str">'available'</span><span class="src-sym">]</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a555"></a>      print <span class="src-str">&quot;Already installed !&lt;BR&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a556"></a>    <span class="src-sym">}</span></li>
<li><a name="a557"></a>    <span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a558"></a>      <a href="http://www.php.net/chdir">chdir</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-var">$basepath</span>/<span class="src-id">tmp</span><span class="src-str">&quot;</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a559"></a>      list<span class="src-sym">(</span><span class="src-var">$url</span><span class="src-sym">, </span><span class="src-var">$filename</span><span class="src-sym">) </span>= <a href="http://www.php.net/split">split</a> <span class="src-sym">(</span><span class="src-str">&quot;=&quot;</span><span class="src-sym">, </span><span class="src-var">$smarty_full_url</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a560"></a>&nbsp;</li>
<li><a name="a561"></a>      print <span class="src-str">&quot;</span><span class="src-id">Download source code</span> (<span class="src-var">$filename</span>) : <span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a562"></a>      <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><a href="http://www.php.net/file_exists">file_exists</a><span class="src-sym">(</span><span class="src-var">$filename</span><span class="src-sym">))</span></li>
<li><a name="a563"></a>        <a href="http://www.php.net/exec">exec</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-id">wget </span>\&quot;<span class="src-var">$smarty_full_url</span>\&quot; 2&gt;&amp;1<span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-var">$output</span><span class="src-sym">, </span><span class="src-var">$return</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a564"></a>      <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><a href="http://www.php.net/file_exists">file_exists</a><span class="src-sym">(</span><span class="src-var">$filename</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a565"></a>        print <span class="src-str">&quot;</span>&lt;<span class="src-id">B STYLE</span>=\&quot;<span class="src-id">color</span>:<span class="src-id">red</span>\&quot;&gt;<span class="src-id">Error</span>&lt;/<span class="src-id">B</span>&gt;&lt;<span class="src-id">P</span>&gt;<span class="src-id">Current working directory</span> : &lt;<span class="src-id">B</span>&gt;<span class="src-var">$basepath</span>/<span class="src-id">tmp</span>/<span class="src-id">smarty</span>&lt;/<span class="src-id">B</span>&gt;<span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a566"></a>        <span class="src-var">$output </span>= <a href="http://www.php.net/implode">implode</a><span class="src-sym">(</span><span class="src-str">&quot;\n&quot;</span><span class="src-sym">, </span><span class="src-var">$output</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a567"></a>        print <span class="src-str">&quot;</span>&lt;<span class="src-id">PRE</span>&gt;&lt;<span class="src-id">B</span>&gt;<span class="src-id">wget </span>\&quot;<span class="src-var">$smarty_full_url</span>\&quot;&lt;/<span class="src-id">B</span>&gt;\n<span class="src-var">$output</span>&lt;/<span class="src-id">PRE</span>&gt;<span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a568"></a>        <span class="src-key">exit</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a569"></a>      <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a570"></a>        print <span class="src-str">&quot;OK&lt;BR&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a571"></a>      <span class="src-sym">}</span></li>
<li><a name="a572"></a>&nbsp;</li>
<li><a name="a573"></a>      print <span class="src-str">&quot;Uncompressing : &quot;</span><span class="src-sym">;</span></li>
<li><a name="a574"></a>      <span class="src-var">$dir_array </span>= <a href="http://www.php.net/split">split</a><span class="src-sym">(</span><span class="src-str">&quot;.tar.gz&quot;</span><span class="src-sym">, </span><span class="src-var">$filename</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a575"></a>      <span class="src-var">$dirname </span>= <a href="http://www.php.net/array_shift">array_shift</a><span class="src-sym">(</span><span class="src-var">$dir_array</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a576"></a>&nbsp;</li>
<li><a name="a577"></a>      <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><a href="http://www.php.net/file_exists">file_exists</a><span class="src-sym">(</span><span class="src-var">$dirname</span><span class="src-sym">))</span></li>
<li><a name="a578"></a>        <a href="http://www.php.net/exec">exec</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-id">tar</span> -<span class="src-id">xzf </span><span class="src-var">$dirname</span>.<span class="src-id">tar</span>.<span class="src-id">gz</span> &amp;&gt;/<span class="src-id">tmp</span>/<span class="src-id">tar</span>.<span class="src-id">output</span><span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-var">$output</span><span class="src-sym">, </span><span class="src-var">$return</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a579"></a>      print <span class="src-str">&quot;OK&lt;BR&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a580"></a>&nbsp;</li>
<li><a name="a581"></a>      <a href="http://www.php.net/exec">exec</a><span class="src-sym">(</span><span class="src-str">&quot;pwd&quot;</span><span class="src-sym">, </span><span class="src-var">$output</span><span class="src-sym">, </span><span class="src-var">$return</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a582"></a>      print <span class="src-str">&quot;Copying : &quot;</span><span class="src-sym">;</span></li>
<li><a name="a583"></a>      <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><a href="http://www.php.net/file_exists">file_exists</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-var">$basepath</span>/<span class="src-id">lib</span>/<span class="src-id">smarty</span><span class="src-str">&quot;</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a584"></a>        <a href="http://www.php.net/exec">exec</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-id">cp</span> -<span class="src-id">r </span><span class="src-var">$dirname</span>/<span class="src-id">libs</span>/* <span class="src-var">$basepath</span>/<span class="src-id">lib</span>/<span class="src-id">smarty</span> &amp;&gt;/<span class="src-id">tmp</span>/<span class="src-id">cp</span>.<span class="src-id">output</span><span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-var">$output</span><span class="src-sym">, </span><span class="src-var">$return</span><span class="src-sym">)</span><span class="src-sym">; </span><span class="src-comm"># TODO : Utiliser SMARTY_REL_PATH</span></li>
<li><a name="a585"></a>            print <span class="src-str">&quot;OK&lt;BR&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a586"></a>&nbsp;</li>
<li><a name="a587"></a>      <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionrefreshButton">refreshButton</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a588"></a>    <span class="src-sym">}</span></li>
<li><a name="a589"></a>    <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Back&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;permission&quot;</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Next&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;magpierss&quot;</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a590"></a>  <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a591"></a>  <span class="src-comm">###################################</span></li>
<li><a name="a592"></a>    <span class="src-key">case </span><span class="src-str">'magpierss'</span>: <span class="src-comm">// Download, uncompress and install MagpieRSS</span></li>
<li><a name="a593"></a>        print <span class="src-str">&quot;&lt;H1&gt;MagpieRSS installation&lt;/H1&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a594"></a>&nbsp;</li>
<li><a name="a595"></a>    <span class="src-key">if </span><span class="src-sym">( </span><span class="src-var">$neededPackages</span><span class="src-sym">[</span><span class="src-str">'magpierss'</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-str">'available'</span><span class="src-sym">]</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a596"></a>      print <span class="src-str">&quot;Already installed !&lt;BR&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a597"></a>      <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Back&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;smarty&quot;</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Next&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;phlickr&quot;</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a598"></a>    <span class="src-sym">}</span></li>
<li><a name="a599"></a>    <span class="src-key">elseif </span><span class="src-sym">(</span><span class="src-var">$action </span>== <span class="src-str">'install'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a600"></a>      <a href="http://www.php.net/chdir">chdir</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-var">$basepath</span>/<span class="src-id">tmp</span><span class="src-str">&quot;</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a601"></a>      <span class="src-var">$filename_array </span>= <a href="http://www.php.net/preg_split">preg_split</a><span class="src-sym">(</span><span class="src-str">&quot;/\//&quot;</span><span class="src-sym">, </span><span class="src-var">$magpierss_full_url</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a602"></a>      <span class="src-var">$filename </span>= <a href="http://www.php.net/array_pop">array_pop</a><span class="src-sym">(</span><span class="src-var">$filename_array</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a603"></a>&nbsp;</li>
<li><a name="a604"></a>      print <span class="src-str">&quot;</span><span class="src-id">Download source code</span> (<span class="src-var">$filename</span>) : <span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a605"></a>      <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><a href="http://www.php.net/file_exists">file_exists</a><span class="src-sym">(</span><span class="src-var">$filename</span><span class="src-sym">))</span></li>
<li><a name="a606"></a>        <a href="http://www.php.net/exec">exec</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-id">wget </span>\&quot;<span class="src-var">$magpierss_full_url</span>\&quot; 2&gt;&amp;1<span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-var">$output</span><span class="src-sym">, </span><span class="src-var">$return</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a607"></a>      <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><a href="http://www.php.net/file_exists">file_exists</a><span class="src-sym">(</span><span class="src-var">$filename</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a608"></a>        print <span class="src-str">&quot;</span>&lt;<span class="src-id">B STYLE</span>=\&quot;<span class="src-id">color</span>:<span class="src-id">red</span>\&quot;&gt;<span class="src-id">Error</span>&lt;/<span class="src-id">B</span>&gt;&lt;<span class="src-id">P</span>&gt;<span class="src-id">Current working directory</span> : &lt;<span class="src-id">B</span>&gt;<span class="src-var">$basepath</span>/<span class="src-id">tmp</span>/<span class="src-id">smarty</span>&lt;/<span class="src-id">B</span>&gt;<span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a609"></a>        <span class="src-var">$output </span>= <a href="http://www.php.net/implode">implode</a><span class="src-sym">(</span><span class="src-str">&quot;\n&quot;</span><span class="src-sym">, </span><span class="src-var">$output</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a610"></a>        print <span class="src-str">&quot;</span>&lt;<span class="src-id">PRE</span>&gt;&lt;<span class="src-id">B</span>&gt;<span class="src-id">wget </span>\&quot;<span class="src-var">$magpierss_full_url</span>\&quot;&lt;/<span class="src-id">B</span>&gt;\n<span class="src-var">$output</span>&lt;/<span class="src-id">PRE</span>&gt;<span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a611"></a>        <span class="src-key">exit</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a612"></a>      <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a613"></a>        print <span class="src-str">&quot;OK&lt;BR&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a614"></a>      <span class="src-sym">}</span></li>
<li><a name="a615"></a>&nbsp;</li>
<li><a name="a616"></a>      print <span class="src-str">&quot;Uncompressing : &quot;</span><span class="src-sym">;</span></li>
<li><a name="a617"></a>      <span class="src-var">$dir_array </span>= <a href="http://www.php.net/split">split</a><span class="src-sym">(</span><span class="src-str">&quot;.tar.gz&quot;</span><span class="src-sym">, </span><span class="src-var">$filename</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a618"></a>      <span class="src-var">$dirname </span>= <a href="http://www.php.net/array_shift">array_shift</a><span class="src-sym">(</span><span class="src-var">$dir_array</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a619"></a>      <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><a href="http://www.php.net/file_exists">file_exists</a><span class="src-sym">(</span><span class="src-var">$dirname</span><span class="src-sym">))</span></li>
<li><a name="a620"></a>        <a href="http://www.php.net/exec">exec</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-id">tar</span> -<span class="src-id">xzf </span><span class="src-var">$dirname</span>.<span class="src-id">tar</span>.<span class="src-id">gz</span> &amp;&gt;/<span class="src-id">tmp</span>/<span class="src-id">tar</span>.<span class="src-id">output</span><span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-var">$output</span><span class="src-sym">, </span><span class="src-var">$return</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a621"></a>      print <span class="src-str">&quot;OK&lt;BR&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a622"></a>&nbsp;</li>
<li><a name="a623"></a>      print <span class="src-str">&quot;Copying : &quot;</span><span class="src-sym">;</span></li>
<li><a name="a624"></a>      <a href="http://www.php.net/exec">exec</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-id">cp</span> -<span class="src-id">r </span><span class="src-var">$dirname</span>/* ../<span class="src-id">lib</span>/<span class="src-id">magpie</span> &amp;&gt;/<span class="src-id">tmp</span>/<span class="src-id">cp</span>.<span class="src-id">output</span><span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-var">$output</span><span class="src-sym">, </span><span class="src-var">$return</span><span class="src-sym">)</span><span class="src-sym">; </span><span class="src-comm"># TODO : Utiliser MAGPIE_REL_PATH</span></li>
<li><a name="a625"></a>            print <span class="src-str">&quot;OK&lt;BR&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a626"></a>&nbsp;</li>
<li><a name="a627"></a>      <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionrefreshButton">refreshButton</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a628"></a>      <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Back&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;smarty&quot;</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Next&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;phlickr&quot;</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a629"></a>    <span class="src-sym">}</span></li>
<li><a name="a630"></a>    <span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a631"></a>      print &lt;&lt;&lt; EndHTML</li>
<li><a name="a632"></a>&lt;<span class="src-id">P</span>&gt;&lt;<span class="src-id">A HREF</span>=&quot;<span class="src-id">http</span>://<span class="src-id">magpierss</span>.<span class="src-id">sourceforge</span>.<span class="src-id">net</span>/&quot;&gt;<span class="src-id">MagpieRSS</span>&lt;/<span class="src-id">A</span>&gt; <span class="src-id">provides an XML</span>-<span class="src-id">based</span> (<span class="src-id">expat</span>) <span class="src-id">RSS parser in PHP</span>. <span class="src-id">MagpieRSS is needed by Wifidog for RSS feeds</span>. <span class="src-id">It</span>'<span class="src-id">s is recommended to install MagpieRSS</span>, <span class="src-id">if you don</span>'<span class="src-id">t</span>, <span class="src-id">RSS feeds options will be disable</span>.</li>
<li><a name="a633"></a>&nbsp;</li>
<li><a name="a634"></a>&lt;<span class="src-id">P</span>&gt;<span class="src-id">Do you want to install MagpieRSS</span> ?</li>
<li><a name="a635"></a>EndHTML<span class="src-sym">;      </span><a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Back&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;smarty&quot;</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Install&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;magpierss&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;action&quot; </span>=&gt; <span class="src-str">&quot;install&quot;</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Next&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;phlickr&quot;</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a636"></a>    <span class="src-sym">}</span></li>
<li><a name="a637"></a>  <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a638"></a>  <span class="src-comm">###################################</span></li>
<li><a name="a639"></a>    <span class="src-key">case </span><span class="src-str">'phlickr'</span>: <span class="src-comm">// Download, uncompress and install phlickr library</span></li>
<li><a name="a640"></a>        print <span class="src-str">&quot;&lt;H1&gt;Phlickr installation&lt;/H1&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a641"></a>&nbsp;</li>
<li><a name="a642"></a>    <span class="src-key">if </span><span class="src-sym">( </span><span class="src-var">$neededPackages</span><span class="src-sym">[</span><span class="src-str">'phlickr'</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-str">'available'</span><span class="src-sym">]</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a643"></a>      print <span class="src-str">&quot;Already installed !&lt;BR&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a644"></a>      <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Back&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;magpierss&quot;</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Next&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;database&quot;</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a645"></a>    <span class="src-sym">}</span></li>
<li><a name="a646"></a>    <span class="src-key">elseif </span><span class="src-sym">(</span><span class="src-var">$action </span>== <span class="src-str">'install'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a647"></a>      <a href="http://www.php.net/chdir">chdir</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-var">$basepath</span>/<span class="src-id">tmp</span><span class="src-str">&quot;</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a648"></a>      <span class="src-var">$filename_array </span>= <a href="http://www.php.net/preg_split">preg_split</a><span class="src-sym">(</span><span class="src-str">&quot;/\//&quot;</span><span class="src-sym">, </span><span class="src-var">$phlickr_full_url</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a649"></a>      <span class="src-var">$filename </span>= <a href="http://www.php.net/array_pop">array_pop</a><span class="src-sym">(</span><span class="src-var">$filename_array</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a650"></a>&nbsp;</li>
<li><a name="a651"></a>      print <span class="src-str">&quot;</span><span class="src-id">Download source code</span> (<span class="src-var">$filename</span>) : <span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a652"></a>      <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><a href="http://www.php.net/file_exists">file_exists</a><span class="src-sym">(</span><span class="src-var">$filename</span><span class="src-sym">))</span></li>
<li><a name="a653"></a>        <a href="http://www.php.net/exec">exec</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-id">wget </span>\&quot;<span class="src-var">$phlickr_full_url</span>\&quot; 2&gt;&amp;1<span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-var">$output</span><span class="src-sym">, </span><span class="src-var">$return</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a654"></a>      <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><a href="http://www.php.net/file_exists">file_exists</a><span class="src-sym">(</span><span class="src-var">$filename</span><span class="src-sym">)) </span><span class="src-sym">{ </span><span class="src-comm"># Error occured, print output of wget</span></li>
<li><a name="a655"></a>                print <span class="src-str">&quot;</span>&lt;<span class="src-id">B STYLE</span>=\&quot;<span class="src-id">color</span>:<span class="src-id">red</span>\&quot;&gt;<span class="src-id">Error</span>&lt;/<span class="src-id">B</span>&gt;&lt;<span class="src-id">P</span>&gt;<span class="src-id">Current working directory</span> : &lt;<span class="src-id">B</span>&gt;<span class="src-var">$basepath</span>/<span class="src-id">tmp</span>/<span class="src-id">smarty</span>&lt;/<span class="src-id">B</span>&gt;<span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a656"></a>        <span class="src-var">$output </span>= <a href="http://www.php.net/implode">implode</a><span class="src-sym">(</span><span class="src-str">&quot;\n&quot;</span><span class="src-sym">, </span><span class="src-var">$output</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a657"></a>        print <span class="src-str">&quot;</span>&lt;<span class="src-id">PRE</span>&gt;&lt;<span class="src-id">B</span>&gt;<span class="src-id">wget </span>\&quot;<span class="src-var">$phlickr_full_url</span>\&quot;&lt;/<span class="src-id">B</span>&gt;\n<span class="src-var">$output</span>&lt;/<span class="src-id">PRE</span>&gt;<span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a658"></a>        <span class="src-key">exit</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a659"></a>      <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a660"></a>        print <span class="src-str">&quot;OK&lt;BR&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a661"></a>      <span class="src-sym">}</span></li>
<li><a name="a662"></a>&nbsp;</li>
<li><a name="a663"></a>      print <span class="src-str">&quot;Uncompressing : &quot;</span><span class="src-sym">;</span></li>
<li><a name="a664"></a>      <span class="src-var">$dirname_array </span>= <a href="http://www.php.net/split">split</a><span class="src-sym">(</span><span class="src-str">&quot;.tgz&quot;</span><span class="src-sym">, </span><span class="src-var">$filename</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a665"></a>      <span class="src-var">$dirname </span>= <a href="http://www.php.net/array_shift">array_shift</a><span class="src-sym">(</span><span class="src-var">$dirname_array</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a666"></a>      <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><a href="http://www.php.net/file_exists">file_exists</a><span class="src-sym">(</span><span class="src-var">$dirname</span><span class="src-sym">))</span></li>
<li><a name="a667"></a>        <a href="http://www.php.net/exec">exec</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-id">tar</span> -<span class="src-id">xzf </span><span class="src-var">$dirname</span>.<span class="src-id">tgz</span> &amp;&gt;/<span class="src-id">tmp</span>/<span class="src-id">tar</span>.<span class="src-id">output</span><span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-var">$output</span><span class="src-sym">, </span><span class="src-var">$return</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a668"></a>      print <span class="src-str">&quot;OK&lt;BR&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a669"></a>&nbsp;</li>
<li><a name="a670"></a>      print <span class="src-str">&quot;Copying : &quot;</span><span class="src-sym">;</span></li>
<li><a name="a671"></a>      <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><a href="http://www.php.net/file_exists">file_exists</a><span class="src-sym">(</span><span class="src-str">'../../lib/Phlickr/Photo.php'</span><span class="src-sym">))</span></li>
<li><a name="a672"></a>        <a href="http://www.php.net/exec">exec</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-id">cp</span> -<span class="src-id">r </span><span class="src-var">$dirname</span>/* ../<span class="src-id">lib</span>/<span class="src-id">Phlickr</span> &amp;&gt;/<span class="src-id">tmp</span>/<span class="src-id">cp</span>.<span class="src-id">output</span><span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-var">$output</span><span class="src-sym">, </span><span class="src-var">$return</span><span class="src-sym">)</span><span class="src-sym">; </span><span class="src-comm"># TODO : Utiliser PHLICKR_REL_PATH</span></li>
<li><a name="a673"></a>            print <span class="src-str">&quot;OK&lt;BR&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a674"></a>&nbsp;</li>
<li><a name="a675"></a>      <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionrefreshButton">refreshButton</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a676"></a>      <span class="src-comm">// Skipping jpgraph install</span></li>
<li><a name="a677"></a>            <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Back&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;magpierss&quot;</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Next&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;database&quot;</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a678"></a>    <span class="src-sym">}</span></li>
<li><a name="a679"></a>    <span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a680"></a>      print &lt;&lt;&lt; EndHTML</li>
<li><a name="a681"></a>&lt;<span class="src-id">P</span>&gt;&lt;<span class="src-id">A HREF</span>=&quot;<span class="src-id">http</span>://<span class="src-id">phlickr</span>.<span class="src-id">sourceforge</span>.<span class="src-id">net</span>/&quot;&gt;<span class="src-id">Phlickr</span>&lt;/<span class="src-id">A</span>&gt; <span class="src-id">is an opensource PHP5 based API kit used to access the Flickr API</span>. &lt;<span class="src-id">A HREF</span>=&quot;<span class="src-id">http</span>://<span class="src-id">flickr</span>.<span class="src-id">com</span>/&quot;&gt;<span class="src-id">Phlick</span>&lt;/<span class="src-id">A</span>&gt; <span class="src-id">help people make their photos available to the people who matter to them</span>. <span class="src-id">Phlick allows Wifidog to share common hotspot pictures</span>. <span class="src-id">It</span>'<span class="src-id">s is recommended to install Phlickr</span>, <span class="src-id">if you don</span>'<span class="src-id">t</span>, <span class="src-id">Phlickr options will be disable</span>.</li>
<li><a name="a682"></a>&nbsp;</li>
<li><a name="a683"></a>&lt;<span class="src-id">P</span>&gt;<span class="src-id">Do you want to install Phlickr</span> ?</li>
<li><a name="a684"></a>EndHTML<span class="src-sym">;      </span><a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Back&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;magpierss&quot;</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Install&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;phlickr&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;action&quot; </span>=&gt; <span class="src-str">&quot;install&quot;</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Next&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;database&quot;</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a685"></a>    <span class="src-sym">}</span></li>
<li><a name="a686"></a>  <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a687"></a>  <span class="src-comm">###################################</span></li>
<li><a name="a688"></a>    <span class="src-key">case </span><span class="src-str">'jpgraph'</span>: <span class="src-comm">// Download, uncompress and install phlickr library</span></li>
<li><a name="a689"></a>        print <span class="src-str">&quot;&lt;H1&gt;JpGraph installation&lt;/H1&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a690"></a>&nbsp;</li>
<li><a name="a691"></a>    <span class="src-key">if </span><span class="src-sym">( </span><span class="src-var">$neededPackages</span><span class="src-sym">[</span><span class="src-str">'jpgraph'</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-str">'available'</span><span class="src-sym">]</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a692"></a>      print <span class="src-str">&quot;Already installed !&lt;BR&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a693"></a>      <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Back&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;phlickr&quot;</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Next&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;database&quot;</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a694"></a>    <span class="src-sym">}</span></li>
<li><a name="a695"></a>    <span class="src-key">elseif </span><span class="src-sym">(</span><span class="src-var">$action </span>== <span class="src-str">'install'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a696"></a>      <a href="http://www.php.net/chdir">chdir</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-var">$basepath</span>/<span class="src-id">tmp</span><span class="src-str">&quot;</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a697"></a>      <span class="src-var">$filename </span>= <a href="http://www.php.net/array_pop">array_pop</a><span class="src-sym">(</span><a href="http://www.php.net/preg_split">preg_split</a><span class="src-sym">(</span><span class="src-str">&quot;/\//&quot;</span><span class="src-sym">, </span><span class="src-var">$jpgraph_full_url</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a698"></a>&nbsp;</li>
<li><a name="a699"></a>      print <span class="src-str">&quot;</span><span class="src-id">Download source code</span> (<span class="src-var">$filename</span>) : <span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a700"></a>      <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><a href="http://www.php.net/file_exists">file_exists</a><span class="src-sym">(</span><span class="src-var">$filename</span><span class="src-sym">))</span></li>
<li><a name="a701"></a>        <a href="http://www.php.net/exec">exec</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-id">wget </span>\&quot;<span class="src-var">$jpgraph_full_url</span>\&quot; 2&gt;&amp;1<span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-var">$output</span><span class="src-sym">, </span><span class="src-var">$return</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a702"></a>      <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><a href="http://www.php.net/file_exists">file_exists</a><span class="src-sym">(</span><span class="src-var">$filename</span><span class="src-sym">)) </span><span class="src-sym">{ </span><span class="src-comm"># Error occured, print output of wget</span></li>
<li><a name="a703"></a>                print <span class="src-str">&quot;</span>&lt;<span class="src-id">B STYLE</span>=\&quot;<span class="src-id">color</span>:<span class="src-id">red</span>\&quot;&gt;<span class="src-id">Error</span>&lt;/<span class="src-id">B</span>&gt;&lt;<span class="src-id">P</span>&gt;<span class="src-id">Current working directory</span> : &lt;<span class="src-id">B</span>&gt;<span class="src-var">$basepath</span>/<span class="src-id">tmp</span>&lt;/<span class="src-id">B</span>&gt;<span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a704"></a>        <span class="src-var">$output </span>= <a href="http://www.php.net/implode">implode</a><span class="src-sym">(</span><span class="src-str">&quot;\n&quot;</span><span class="src-sym">, </span><span class="src-var">$output</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a705"></a>        print <span class="src-str">&quot;</span>&lt;<span class="src-id">PRE</span>&gt;&lt;<span class="src-id">B</span>&gt;<span class="src-id">wget </span>\&quot;<span class="src-var">$jpgraph_full_url</span>\&quot;&lt;/<span class="src-id">B</span>&gt;\n<span class="src-var">$output</span>&lt;/<span class="src-id">PRE</span>&gt;<span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a706"></a>        <span class="src-key">exit</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a707"></a>      <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a708"></a>        print <span class="src-str">&quot;OK&lt;BR&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a709"></a>      <span class="src-sym">}</span></li>
<li><a name="a710"></a>&nbsp;</li>
<li><a name="a711"></a>      print <span class="src-str">&quot;Uncompressing : &quot;</span><span class="src-sym">;</span></li>
<li><a name="a712"></a>      <span class="src-var">$dirname </span>= <a href="http://www.php.net/array_shift">array_shift</a><span class="src-sym">(</span><a href="http://www.php.net/split">split</a><span class="src-sym">(</span><span class="src-str">&quot;.tar.gz&quot;</span><span class="src-sym">, </span><span class="src-var">$filename</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a713"></a>      <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><a href="http://www.php.net/file_exists">file_exists</a><span class="src-sym">(</span><span class="src-var">$dirname</span><span class="src-sym">))</span></li>
<li><a name="a714"></a>        <a href="http://www.php.net/exec">exec</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-id">tar</span> -<span class="src-id">xzf </span><span class="src-var">$dirname</span>.<span class="src-id">tar</span>.<span class="src-id">gz</span> &amp;&gt;/<span class="src-id">tmp</span>/<span class="src-id">tar</span>.<span class="src-id">output</span><span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-var">$output</span><span class="src-sym">, </span><span class="src-var">$return</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a715"></a>      print <span class="src-str">&quot;OK&lt;BR&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a716"></a>&nbsp;</li>
<li><a name="a717"></a>      print <span class="src-str">&quot;Copying : &quot;</span><span class="src-sym">;</span></li>
<li><a name="a718"></a>      <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><a href="http://www.php.net/file_exists">file_exists</a><span class="src-sym">(</span><span class="src-str">'../../lib/jpgraph/jpgraph.php'</span><span class="src-sym">))</span></li>
<li><a name="a719"></a>        <a href="http://www.php.net/exec">exec</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-id">cp </span><span class="src-var">$dirname</span>/<span class="src-id">src</span>/* ../<span class="src-id">lib</span>/<span class="src-id">jpgraph</span> &amp;&gt;/<span class="src-id">tmp</span>/<span class="src-id">cp</span>.<span class="src-id">output</span><span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-var">$output</span><span class="src-sym">, </span><span class="src-var">$return</span><span class="src-sym">)</span><span class="src-sym">; </span><span class="src-comm"># TODO : Utiliser JPGRAPH_REL_PATH</span></li>
<li><a name="a720"></a>&nbsp;</li>
<li><a name="a720"></a>      </li>
<li><a name="a721"></a>      print <span class="src-str">&quot;OK&lt;BR&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a722"></a>&nbsp;</li>
<li><a name="a723"></a>      <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionrefreshButton">refreshButton</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a724"></a>      <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Back&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;phlickr&quot;</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Next&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;database&quot;</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a725"></a>    <span class="src-sym">}</span></li>
<li><a name="a726"></a>    <span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a727"></a>      print &lt;&lt;&lt; EndHTML</li>
<li><a name="a728"></a>&lt;<span class="src-id">P</span>&gt;&lt;<span class="src-id">A HREF</span>=&quot;<span class="src-id">http</span>://<span class="src-id">www</span>.<span class="src-id">aditus</span>.<span class="src-id">nu</span>/<span class="src-id">jpgraph</span>/&quot;&gt;<span class="src-id">JpGraph</span>&lt;/<span class="src-id">A</span>&gt; <span class="src-id">is a Object</span>-<span class="src-id">Oriented Graph creating library for PHP</span>.</li>
<li><a name="a729"></a><span class="src-id">JpGraph is not currently use by Wifidog</span> (<span class="src-id">will be use for statistique graph in a later version</span>). <span class="src-id">You can skip this installation if your not a developper</span>.</li>
<li><a name="a730"></a>&nbsp;</li>
<li><a name="a731"></a>&lt;<span class="src-id">P</span>&gt;<span class="src-id">Do you want to install JpGraph</span> ?</li>
<li><a name="a732"></a>EndHTML<span class="src-sym">;      </span><a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Back&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;phlickr&quot;</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Install&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;jpgraph&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;action&quot; </span>=&gt; <span class="src-str">&quot;install&quot;</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Next&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;database&quot;</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a733"></a>    <span class="src-sym">}</span></li>
<li><a name="a734"></a>  <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a735"></a>  <span class="src-comm">###################################</span></li>
<li><a name="a736"></a>    <span class="src-key">case </span><span class="src-str">'database'</span>:</li>
<li><a name="a737"></a>    <span class="src-comm">### TODO : Valider en javascript que les champs soumit ne sont pas vide</span></li>
<li><a name="a738"></a>    <span class="src-comm">#          Pouvoir choisir le port de la DB ???</span></li>
<li><a name="a739"></a>        print &lt;&lt;&lt; EndHTML</li>
<li><a name="a740"></a>&lt;<span class="src-id">H1</span>&gt;<span class="src-id">Database access configuration</span>&lt;/<span class="src-id">H1</span>&gt;</li>
<li><a name="a741"></a>&lt;<span class="src-id">BR</span>&gt;</li>
<li><a name="a742"></a>&lt;<span class="src-id">TABLE border</span>=&quot;1&quot;&gt;</li>
<li><a name="a743"></a>  &lt;<span class="src-id">TR</span>&gt;&lt;<span class="src-id">TD</span>&gt;<span class="src-id">DB</span>&lt;/<span class="src-id">TD</span>&gt;&lt;<span class="src-id">TD</span>&gt;&lt;<span class="src-id">SELECT name</span>=&quot;<span class="src-id">CONF_DBMS</span>&quot;&gt;</li>
<li><a name="a744"></a>&nbsp;</li>
<li><a name="a745"></a>EndHTML<span class="src-sym">;</span></li>
<li><a name="a746"></a>    <span class="src-key">foreach</span><span class="src-sym">(</span><span class="src-var">$configArray </span><span class="src-key">as </span><span class="src-var">$key </span>=&gt; <span class="src-var">$value</span><span class="src-sym">) </span><span class="src-sym">{  </span><span class="src-comm"># In config.php, find all DBMS_* define</span></li>
<li><a name="a747"></a>            <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">&quot;/^(DBMS_)(.*)/&quot;</span><span class="src-sym">, </span><span class="src-var">$key</span><span class="src-sym">, </span><span class="src-var">$matchesArray</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a748"></a>        <span class="src-var">$dbname_lower </span>= <a href="http://www.php.net/strtolower">strtolower</a><span class="src-sym">(</span><span class="src-var">$matchesArray</span><span class="src-sym">[</span><span class="src-num">2</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a749"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$dbname_lower </span>== <span class="src-str">'postgres'</span><span class="src-sym">) </span><span class="src-comm"># config.php use postgres and PHP use pgsql</span></li>
<li><a name="a750"></a>                    <span class="src-var">$dbname_lower </span>= <span class="src-str">'pgsql'</span><span class="src-sym">;</span></li>
<li><a name="a751"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$neededExtentions</span><span class="src-sym">[</span><span class="src-var">$dbname_lower</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-str">'available'</span><span class="src-sym">] </span>== <span class="src-num">0</span><span class="src-sym">) </span><span class="src-comm"># Validate dependencie</span></li>
<li><a name="a752"></a>                    <span class="src-key">continue</span><span class="src-sym">;</span></li>
<li><a name="a753"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$CONF_DBMS </span>== <span class="src-var">$key</span><span class="src-sym">)</span></li>
<li><a name="a754"></a>          print <span class="src-str">&quot;</span>    &lt;<span class="src-id">OPTION value</span>=\&quot;<span class="src-var">$key</span>\&quot; <span class="src-id">SELECTED</span>&gt;<span class="src-str">&quot; </span>. <span class="src-var">$matchesArray</span><span class="src-sym">[</span><span class="src-num">2</span><span class="src-sym">] </span>. <span class="src-str">&quot;&lt;/OPTION&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a755"></a>        <span class="src-key">else</span></li>
<li><a name="a756"></a>          print <span class="src-str">&quot;</span>    &lt;<span class="src-id">OPTION value</span>=\&quot;<span class="src-var">$key</span>\&quot;&gt;<span class="src-str">&quot; </span>. <span class="src-var">$matchesArray</span><span class="src-sym">[</span><span class="src-num">2</span><span class="src-sym">] </span>. <span class="src-str">&quot;&lt;/OPTION&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a757"></a>      <span class="src-sym">}</span></li>
<li><a name="a758"></a>    <span class="src-sym">}</span></li>
<li><a name="a759"></a>&nbsp;</li>
<li><a name="a760"></a>    print &lt;&lt;&lt; EndHTML</li>
<li><a name="a761"></a>  &lt;/<span class="src-id">TD</span>&gt;&lt;/<span class="src-id">TR</span>&gt;</li>
<li><a name="a762"></a>  &lt;<span class="src-id">TR</span>&gt;&lt;<span class="src-id">TD</span>&gt;<span class="src-id">Host</span>&lt;/<span class="src-id">TD</span>&gt;&lt;<span class="src-id">TD</span>&gt;&lt;<span class="src-id">INPUT type</span>=&quot;<span class="src-id">text</span>&quot; <span class="src-id">name</span>=&quot;<span class="src-id">CONF_DATABASE_HOST</span>&quot; <span class="src-id">value</span>=&quot;<span class="src-var">$CONF_DATABASE_HOST</span>&quot;&gt;&lt;/<span class="src-id">TD</span>&gt;&lt;/<span class="src-id">TR</span>&gt;</li>
<li><a name="a763"></a>  &lt;<span class="src-id">TR</span>&gt;&lt;<span class="src-id">TD</span>&gt;<span class="src-id">DB Name</span>&lt;/<span class="src-id">TD</span>&gt;&lt;<span class="src-id">TD</span>&gt;&lt;<span class="src-id">INPUT type</span>=&quot;<span class="src-id">text</span>&quot; <span class="src-id">name</span>=&quot;<span class="src-id">CONF_DATABASE_NAME</span>&quot; <span class="src-id">value</span>=&quot;<span class="src-var">$CONF_DATABASE_NAME</span>&quot;&gt;&lt;/<span class="src-id">TD</span>&gt;&lt;/<span class="src-id">TR</span>&gt;</li>
<li><a name="a764"></a>  &lt;<span class="src-id">TR</span>&gt;&lt;<span class="src-id">TD</span>&gt;<span class="src-id">Username</span>&lt;/<span class="src-id">TD</span>&gt;&lt;<span class="src-id">TD</span>&gt;&lt;<span class="src-id">INPUT type</span>=&quot;<span class="src-id">text</span>&quot; <span class="src-id">name</span>=&quot;<span class="src-id">CONF_DATABASE_USER</span>&quot; <span class="src-id">value</span>=&quot;<span class="src-var">$CONF_DATABASE_USER</span>&quot;&gt;&lt;/<span class="src-id">TD</span>&gt;&lt;/<span class="src-id">TR</span>&gt;</li>
<li><a name="a765"></a>  &lt;<span class="src-id">TR</span>&gt;&lt;<span class="src-id">TD</span>&gt;<span class="src-id">Password</span>&lt;/<span class="src-id">TD</span>&gt;&lt;<span class="src-id">TD</span>&gt;&lt;<span class="src-id">INPUT type</span>=&quot;<span class="src-id">text</span>&quot; <span class="src-id">name</span>=&quot;<span class="src-id">CONF_DATABASE_PASSWORD</span>&quot; <span class="src-id">value</span>=&quot;<span class="src-var">$CONF_DATABASE_PASSWORD</span>&quot;&gt;&lt;/<span class="src-id">TD</span>&gt;&lt;/<span class="src-id">TR</span>&gt;</li>
<li><a name="a766"></a>&lt;/<span class="src-id">TABLE</span>&gt;</li>
<li><a name="a767"></a>&nbsp;</li>
<li><a name="a768"></a>&lt;<span class="src-id">P</span>&gt;<span class="src-id">By clicking Next</span>, <span class="src-id">your configuration will be automaticaly saved</span></li>
<li><a name="a769"></a>&nbsp;</li>
<li><a name="a770"></a>&lt;<span class="src-id">script type</span>=&quot;<span class="src-id">text</span>/<span class="src-id">javascript</span>&quot;&gt;</li>
<li><a name="a771"></a>  <span class="src-id">function submitDatabaseValue</span>() <span class="src-sym">{</span></li>
<li><a name="a772"></a>    <span class="src-id">newConfig</span>(&quot;<span class="src-id">CONF_DBMS</span>=&quot; + <span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-id">CONF_DBMS</span>.<span class="src-id">value</span>);</li>
<li><a name="a773"></a>    <span class="src-id">newConfig</span>(&quot;<span class="src-id">CONF_DATABASE_HOST</span>='&quot; + <span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-id">CONF_DATABASE_HOST</span>.<span class="src-id">value</span> + &quot;'&quot;);</li>
<li><a name="a774"></a>    <span class="src-id">newConfig</span>(&quot;<span class="src-id">CONF_DATABASE_NAME</span>='&quot; + <span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-id">CONF_DATABASE_NAME</span>.<span class="src-id">value</span> + &quot;'&quot;);</li>
<li><a name="a775"></a>    <span class="src-id">newConfig</span>(&quot;<span class="src-id">CONF_DATABASE_USER</span>='&quot; + <span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-id">CONF_DATABASE_USER</span>.<span class="src-id">value</span> + &quot;'&quot;);</li>
<li><a name="a776"></a>    <span class="src-id">newConfig</span>(&quot;<span class="src-id">CONF_DATABASE_PASSWORD</span>='&quot; + <span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-id">CONF_DATABASE_PASSWORD</span>.<span class="src-id">value</span> + &quot;'&quot;);</li>
<li><a name="a777"></a>  <span class="src-sym">}</span></li>
<li><a name="a778"></a>&lt;/<span class="src-id">script</span>&gt;</li>
<li><a name="a779"></a>&nbsp;</li>
<li><a name="a780"></a>&lt;<span class="src-id">P</span>&gt;&lt;<span class="src-id">B</span>&gt;<span class="src-id">Note</span>&lt;/<span class="src-id">B</span>&gt; : <span class="src-id">MySQL support is presently experimental and not working</span>&lt;/<span class="src-id">P</span>&gt;</li>
<li><a name="a781"></a>&nbsp;</li>
<li><a name="a782"></a>EndHTML<span class="src-sym">;</span></li>
<li><a name="a783"></a>    <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Back&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;magpierss&quot;</span><span class="src-sym">)))</span><span class="src-sym">; </span><span class="src-comm">#, array(&quot;title&quot; =&gt; &quot;Next&quot;, &quot;page&quot; =&gt; &quot;testdatabase&quot;)));</span></li>
<li><a name="a784"></a>        print &lt;&lt;&lt; EndHTML</li>
<li><a name="a785"></a>&lt;<span class="src-id">P</span>&gt;&lt;<span class="src-id">A HREF</span>=&quot;#&quot; <span class="src-id">ONCLICK</span>=&quot;<span class="src-id">javascript</span>: <span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-id">page</span>.<span class="src-id">value</span>='<span class="src-id">testdatabase</span>'; <span class="src-id">submitDatabaseValue</span>(); <span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-id">submit</span>();&quot; <span class="src-id">CLASS</span>=&quot;<span class="src-id">button</span>&quot;&gt;<span class="src-id">Next</span>&lt;/<span class="src-id">A</span>&gt;&lt;/<span class="src-id">P</span>&gt;</li>
<li><a name="a786"></a>&nbsp;</li>
<li><a name="a787"></a>EndHTML<span class="src-sym">;</span></li>
<li><a name="a788"></a>  <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a789"></a>  <span class="src-comm">###################################</span></li>
<li><a name="a790"></a>    <span class="src-key">case </span><span class="src-str">'testdatabase'</span>:</li>
<li><a name="a791"></a>    print <span class="src-str">&quot;&lt;H1&gt;Database connection&lt;/H1&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a792"></a>    <span class="src-comm">/* TODO : Tester la version minimale requise de MySQL et Postgresql</span></li>
<li><a name="a793"></a><span class="src-comm">              Tester si MySQL supporte InnoDB                           */</span></li>
<li><a name="a794"></a>&nbsp;</li>
<li><a name="a795"></a>    <span class="src-key">switch </span><span class="src-sym">(</span><span class="src-var">$CONF_DBMS</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a796"></a>      <span class="src-key">case </span><span class="src-str">'DBMS_POSTGRES'</span>:</li>
<li><a name="a797"></a>        print <span class="src-str">&quot;&lt;UL&gt;&lt;LI&gt;Postgresql database connection : &quot;</span><span class="src-sym">;</span></li>
<li><a name="a798"></a>&nbsp;</li>
<li><a name="a799"></a>        <span class="src-var">$conn_string </span>= <span class="src-str">&quot;</span><span class="src-id">host</span>=<span class="src-var">$CONF_DATABASE_HOST </span><span class="src-id">dbname</span>=<span class="src-var">$CONF_DATABASE_NAME </span><span class="src-id">user</span>=<span class="src-var">$CONF_DATABASE_USER </span><span class="src-id">password</span>=<span class="src-var">$CONF_DATABASE_PASSWORD</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a800"></a>        <span class="src-var">$ptr_connexion </span>= <a href="http://www.php.net/pg_connect">pg_connect</a><span class="src-sym">(</span><span class="src-var">$conn_string</span><span class="src-sym">) </span><span class="src-key">or </span><span class="src-key">die</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">; </span><span class="src-comm"># or die(&quot;Couldn't Connect ==&quot;.pg_last_error().&quot;==&lt;BR&gt;&quot;);</span></li>
<li><a name="a801"></a>&nbsp;</li>
<li><a name="a802"></a>        <span class="src-comm">#if ($ptr_connexion == TRUE) {</span></li>
<li><a name="a803"></a>                    print <span class="src-str">&quot;Success&lt;BR&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a804"></a>        <span class="src-comm">#}</span></li>
<li><a name="a805"></a><span class="src-comm">#        } else {</span></li>
<li><a name="a806"></a><span class="src-comm">#          print &quot;Unable to connect to database on $CONF_DATABASE_HOST&lt;BR&gt;The database must be online to continue.&lt;BR&gt;Please go back and retry with correct values&quot;;</span></li>
<li><a name="a807"></a><span class="src-comm">#          navigation(array(array(&quot;title&quot; =&gt; &quot;Back&quot;, &quot;page&quot; =&gt; &quot;database&quot;)));</span></li>
<li><a name="a808"></a><span class="src-comm">#        }</span></li>
<li><a name="a809"></a>&nbsp;</li>
<li><a name="a809"></a>        </li>
<li><a name="a810"></a>        <span class="src-var">$postgresql_info </span>= <a href="http://www.php.net/pg_version">pg_version</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a811"></a><span class="src-comm">#        $postgresql_info['server'];</span></li>
<li><a name="a812"></a><span class="src-comm">#        if ($postgresql_info['server'] &gt; $requiredPostgeSQLVersion) { Todo : Do something }</span></li>
<li><a name="a813"></a>&nbsp;</li>
<li><a name="a813"></a>        </li>
<li><a name="a814"></a>        print <span class="src-str">&quot;&lt;/UL&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a815"></a>        <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionrefreshButton">refreshButton</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a816"></a>        <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Back&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;database&quot;</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Next&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;dbinit&quot;</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a817"></a>      <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a818"></a>      <span class="src-comm">###################################</span></li>
<li><a name="a819"></a>            <span class="src-key">case </span><span class="src-str">'DBMS_MYSQL'</span>:</li>
<li><a name="a820"></a>        <span class="src-var">$ptr_connexion </span>= <span class="src-sym">@</span><a href="http://www.php.net/mysql_connect">mysql_connect</a><span class="src-sym">(</span><span class="src-var">$CONF_DATABASE_HOST</span><span class="src-sym">, </span><span class="src-var">$CONF_DATABASE_USER</span><span class="src-sym">, </span><span class="src-var">$CONF_DATABASE_PASSWORD</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a821"></a>        print <span class="src-str">&quot;&lt;UL&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a822"></a>&nbsp;</li>
<li><a name="a823"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$ptr_connexion </span>== <span class="src-id">TRUE</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a824"></a>          print <span class="src-str">&quot;&lt;LI&gt;MySQL database connection : Success&quot;</span><span class="src-sym">;</span></li>
<li><a name="a825"></a>&nbsp;</li>
<li><a name="a826"></a>          <span class="src-var">$mysql_server_version </span>= <a href="http://www.php.net/mysql_get_server_info">mysql_get_server_info</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a827"></a>            print<span class="src-sym">(</span><span class="src-str">&quot;</span>&lt;<span class="src-id">LI</span>&gt;<span class="src-id">MySQL server version</span>: <span class="src-var">$mysql_server_version</span><span class="src-str">&quot;</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a828"></a>&nbsp;</li>
<li><a name="a829"></a>          <span class="src-comm">#if ($mysql_server_version &gt; $requiredMySQLVersion) { Todo : Do something }</span></li>
<li><a name="a830"></a>&nbsp;</li>
<li><a name="a831"></a>          <span class="src-comm">#printf(&quot;&lt;LI&gt;MySQL host info: %s\n&quot;, mysql_get_host_info());</span></li>
<li><a name="a832"></a>&nbsp;</li>
<li><a name="a832"></a>          </li>
<li><a name="a833"></a>          print <span class="src-str">&quot;</span>&lt;<span class="src-id">LI</span>&gt;<span class="src-id">Select DB </span><span class="src-var">$CONF_DATABASE_NAME</span> : <span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a834"></a>          <span class="src-var">$select_db </span>= <a href="http://www.php.net/mysql_select_db">mysql_select_db</a><span class="src-sym">(</span><span class="src-var">$CONF_DATABASE_NAME</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a835"></a>&nbsp;</li>
<li><a name="a836"></a>          <span class="src-key">if</span><span class="src-sym">(</span><span class="src-var">$select_db </span>== <span class="src-id">TRUE</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a837"></a>            print <span class="src-str">&quot;Success&lt;/UL&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a838"></a>              <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Back&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;database&quot;</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Next&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;dbinit&quot;</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a839"></a>          <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a840"></a>            print <span class="src-str">&quot;&lt;/UL&gt;ERROR (Unable to select the database)&lt;BR&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a841"></a>            <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionrefreshButton">refreshButton</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a842"></a>            <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Back&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;database&quot;</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a843"></a>          <span class="src-sym">}</span></li>
<li><a name="a844"></a>        <span class="src-sym">} </span><span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a845"></a>          print <span class="src-str">&quot;</span><span class="src-id">Unable to connect to database on</span> &lt;<span class="src-id">B</span>&gt;<span class="src-var">$CONF_DATABASE_HOST</span>&lt;/<span class="src-id">B</span>&gt;&lt;<span class="src-id">BR</span>&gt;<span class="src-id">The database must be online to continue</span>.&lt;<span class="src-id">P</span>&gt;<span class="src-id">Please go back and retry with correct values</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a846"></a>          <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionrefreshButton">refreshButton</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a847"></a>          <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Back&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;database&quot;</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a848"></a>        <span class="src-sym">}</span></li>
<li><a name="a849"></a>      <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a850"></a>      <span class="src-key">default</span>:</li>
<li><a name="a851"></a>        print &lt;&lt;&lt;EndHTML</li>
<li><a name="a852"></a>          <span class="src-id">The CONF_DBMS value</span> &lt;<span class="src-id">B</span>&gt;<span class="src-var">$CONF_DBMS</span>&lt;/<span class="src-id">B</span>&gt; <span class="src-id">is not currently suported by this install script</span>.</li>
<li><a name="a853"></a>EndHTML<span class="src-sym">;        </span><a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Back&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;database&quot;</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a854"></a>    <span class="src-sym">}</span></li>
<li><a name="a855"></a>  <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a856"></a>  <span class="src-comm">###################################</span></li>
<li><a name="a857"></a>    <span class="src-key">case </span><span class="src-str">'dbinit'</span>:</li>
<li><a name="a858"></a>    print <span class="src-str">&quot;&lt;H1&gt;Database initialisation&lt;/H1&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a859"></a>&nbsp;</li>
<li><a name="a860"></a>    <span class="src-comm"># SQL are executed with PHP, some lignes need to be commented</span></li>
<li><a name="a861"></a>        <span class="src-var">$file_db_version </span>= <span class="src-str">'UNKNOW'</span><span class="src-sym">;</span></li>
<li><a name="a862"></a>    <span class="src-var">$patterns</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]     </span>= <span class="src-str">'/CREATE DATABASE wifidog/'</span><span class="src-sym">;</span></li>
<li><a name="a863"></a>    <span class="src-var">$patterns</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">]     </span>= <span class="src-str">'/\\\connect/'</span><span class="src-sym">;</span></li>
<li><a name="a864"></a>    <span class="src-var">$patterns</span><span class="src-sym">[</span><span class="src-num">2</span><span class="src-sym">]     </span>= <span class="src-str">'/COMMENT/'</span><span class="src-sym">;</span></li>
<li><a name="a865"></a>    <span class="src-var">$patterns</span><span class="src-sym">[</span><span class="src-num">3</span><span class="src-sym">]     </span>= <span class="src-str">'/SET default_tablespace/'</span><span class="src-sym">;</span></li>
<li><a name="a866"></a>    <span class="src-var">$patterns</span><span class="src-sym">[</span><span class="src-num">4</span><span class="src-sym">]     </span>= <span class="src-str">'/SET default_with_oids/'</span><span class="src-sym">;</span></li>
<li><a name="a867"></a>    <span class="src-var">$replacements</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">] </span>= <span class="src-str">'-- '</span><span class="src-sym">;</span></li>
<li><a name="a868"></a>    <span class="src-var">$replacements</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">] </span>= <span class="src-str">'-- '</span><span class="src-sym">;</span></li>
<li><a name="a869"></a>    <span class="src-var">$replacements</span><span class="src-sym">[</span><span class="src-num">2</span><span class="src-sym">] </span>= <span class="src-str">'-- '</span><span class="src-sym">;</span></li>
<li><a name="a870"></a>    <span class="src-var">$replacements</span><span class="src-sym">[</span><span class="src-num">3</span><span class="src-sym">] </span>= <span class="src-str">'-- '</span><span class="src-sym">;</span></li>
<li><a name="a871"></a>    <span class="src-var">$replacements</span><span class="src-sym">[</span><span class="src-num">4</span><span class="src-sym">] </span>= <span class="src-str">'-- '</span><span class="src-sym">;</span></li>
<li><a name="a872"></a>&nbsp;</li>
<li><a name="a873"></a>    <span class="src-var">$content_schema_array </span>= <a href="http://www.php.net/file">file</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-var">$basepath</span>/../<span class="src-id">sql</span>/<span class="src-id">wifidog</span>-<span class="src-id">postgres</span>-<span class="src-id">schema</span>.<span class="src-id">sql</span><span class="src-str">&quot;</span><span class="src-sym">)</span><span class="src-sym">;       </span><span class="src-comm"># Read SQL schema file</span></li>
<li><a name="a874"></a>        <span class="src-var">$content_schema       </span>= <a href="http://www.php.net/implode">implode</a><span class="src-sym">(</span><span class="src-str">&quot;&quot;</span><span class="src-sym">, </span><span class="src-var">$content_schema_array</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a875"></a>    <span class="src-var">$content_data_array   </span>= <a href="http://www.php.net/file">file</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-var">$basepath</span>/../<span class="src-id">sql</span>/<span class="src-id">wifidog</span>-<span class="src-id">postgres</span>-<span class="src-id">initial</span>-<span class="src-id">data</span>.<span class="src-id">sql</span><span class="src-str">&quot;</span><span class="src-sym">)</span><span class="src-sym">; </span><span class="src-comm"># Read SQL initial data file</span></li>
<li><a name="a876"></a>        <span class="src-var">$content_data         </span>= <a href="http://www.php.net/implode">implode</a><span class="src-sym">(</span><span class="src-str">&quot;&quot;</span><span class="src-sym">, </span><span class="src-var">$content_data_array</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a877"></a>&nbsp;</li>
<li><a name="a878"></a>    <span class="src-var">$db_schema_version   </span>= <span class="src-str">''</span><span class="src-sym">; </span><span class="src-comm"># Schema version query from database</span></li>
<li><a name="a879"></a>        <span class="src-var">$file_schema_version </span>= <span class="src-str">''</span><span class="src-sym">; </span><span class="src-comm"># Schema version from define(REQUIRED_SCHEMA_VERSION) in schema_validate.php</span></li>
<li><a name="a880"></a>&nbsp;</li>
<li><a name="a880"></a>    </li>
<li><a name="a881"></a>    <span class="src-key">switch </span><span class="src-sym">(</span><span class="src-var">$CONF_DBMS</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a882"></a>      <span class="src-key">case </span><span class="src-str">'DBMS_POSTGRES'</span>:</li>
<li><a name="a883"></a>        <span class="src-var">$conn_string </span>= <span class="src-str">&quot;</span><span class="src-id">host</span>=<span class="src-var">$CONF_DATABASE_HOST </span><span class="src-id">dbname</span>=<span class="src-var">$CONF_DATABASE_NAME </span><span class="src-id">user</span>=<span class="src-var">$CONF_DATABASE_USER </span><span class="src-id">password</span>=<span class="src-var">$CONF_DATABASE_PASSWORD</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a884"></a>        <span class="src-var">$connection </span>= <a href="http://www.php.net/pg_connect">pg_connect</a><span class="src-sym">(</span><span class="src-var">$conn_string</span><span class="src-sym">) </span><span class="src-key">or </span><span class="src-key">die</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">; </span><span class="src-comm"># or die(&quot;Couldn't Connect ==&quot;.pg_last_error().&quot;==&lt;BR&gt;&quot;);</span></li>
<li><a name="a885"></a>&nbsp;</li>
<li><a name="a885"></a>        </li>
<li><a name="a886"></a>        <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">&quot;/\('schema_version', '(\d+)'\);/&quot;</span><span class="src-sym">, </span><span class="src-var">$content_data</span><span class="src-sym">, </span><span class="src-var">$matchesArray</span><span class="src-sym">)) </span><span class="src-comm"># Get schema_version from initial data file</span></li>
<li><a name="a887"></a>                    <span class="src-var">$file_db_version </span>= <span class="src-var">$matchesArray</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a888"></a>&nbsp;</li>
<li><a name="a889"></a>        <span class="src-var">$contentArray </span>= <a href="http://www.php.net/file">file</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-var">$basepath</span>/<span class="src-id">include</span>/<span class="src-id">schema_validate</span>.<span class="src-id">php</span><span class="src-str">&quot;</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a890"></a>        <span class="src-key">foreach</span><span class="src-sym">(</span><span class="src-var">$contentArray </span><span class="src-key">as </span><span class="src-var">$line</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a891"></a>          <span class="src-comm">#print &quot;$line&lt;BR&gt;&quot;; # Debug</span></li>
<li><a name="a892"></a>                    <span class="src-key">if</span><span class="src-sym">(</span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">&quot;/^define\('REQUIRED_SCHEMA_VERSION', (\d+)\);/&quot;</span><span class="src-sym">, </span><span class="src-var">$line</span><span class="src-sym">, </span><span class="src-var">$matchesArray</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a893"></a>            <span class="src-comm">#print &quot;REQUIRED_SCHEMA_VERSION = &quot; . $matchesArray[1] . &quot;&lt;BR&gt;&quot;;</span></li>
<li><a name="a894"></a>                        <span class="src-var">$file_schema_version </span>= <span class="src-var">$matchesArray</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a895"></a>          <span class="src-sym">}</span></li>
<li><a name="a896"></a>        <span class="src-sym">}</span></li>
<li><a name="a897"></a>&nbsp;</li>
<li><a name="a898"></a>        <span class="src-comm"># Get current database schema version (if defined)</span></li>
<li><a name="a899"></a>                <span class="src-var">$sql </span>= <span class="src-str">&quot;SELECT * FROM schema_info WHERE tag='schema_version'&quot;</span><span class="src-sym">;</span></li>
<li><a name="a900"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$result </span>= <span class="src-sym">@</span><a href="http://www.php.net/pg_query">pg_query</a><span class="src-sym">(</span><span class="src-var">$connection</span><span class="src-sym">, </span><span class="src-var">$sql</span><span class="src-sym">)) </span><span class="src-sym">{ </span><span class="src-comm"># The @ remove warning display</span></li>
<li><a name="a901"></a>                    <span class="src-var">$result_array </span>= <a href="http://www.php.net/pg_fetch_all">pg_fetch_all</a><span class="src-sym">(</span><span class="src-var">$result</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a902"></a>          <span class="src-var">$db_shema_version </span>= <span class="src-var">$result_array</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-str">'value'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a903"></a>&nbsp;</li>
<li><a name="a904"></a>          print <span class="src-str">&quot;</span>&lt;<span class="src-id">P</span>&gt;<span class="src-id">On</span> &lt;<span class="src-id">B</span>&gt;<span class="src-var">$CONF_DATABASE_HOST</span>&lt;/<span class="src-id">B</span>&gt;, <span class="src-id">Database</span> &lt;<span class="src-id">B</span>&gt;<span class="src-var">$CONF_DATABASE_NAME</span>&lt;/<span class="src-id">B</span>&gt; <span class="src-id">exists and is </span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a905"></a>          <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$db_shema_version </span>== <span class="src-var">$file_schema_version</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a906"></a>            print <span class="src-str">&quot;</span><span class="src-id">up to </span><a href="http://www.php.net/date">date</a> (<span class="src-id">shema version</span> &lt;<span class="src-id">B</span>&gt;<span class="src-var">$db_shema_version</span>&lt;/<span class="src-id">B</span>&gt;).<span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a907"></a>            <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Back&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;database&quot;</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Next&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;options&quot;</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a908"></a>          <span class="src-sym">} </span><span class="src-key">elseif </span><span class="src-sym">(</span><span class="src-var">$db_shema_version </span>&lt; <span class="src-var">$file_schema_version</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a909"></a>            print <span class="src-str">&quot;</span><span class="src-id">at schema version</span> &lt;<span class="src-id">B</span>&gt;<span class="src-var">$db_shema_version</span>&lt;/<span class="src-id">B</span>&gt;. <span class="src-id">The required schema version is</span> &lt;<span class="src-id">B</span>&gt;<span class="src-var">$file_schema_version</span>&lt;/<span class="src-id">B</span>&gt;&lt;<span class="src-id">P</span>&gt;<span class="src-id">Please upgrade the database</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a910"></a>            <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Back&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;database&quot;</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Upgrade&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;schema_validate&quot;</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Next&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;options&quot;</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a911"></a>          <span class="src-sym">}</span></li>
<li><a name="a912"></a>          <span class="src-key">else </span><span class="src-sym">{ </span>print <span class="src-str">&quot;Error : Unexpected result&quot;</span><span class="src-sym">; </span><span class="src-sym">}</span></li>
<li><a name="a913"></a>          <span class="src-key">exit</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a914"></a>        <span class="src-sym">}</span></li>
<li><a name="a915"></a>&nbsp;</li>
<li><a name="a916"></a>        print <span class="src-str">&quot;&lt;UL&gt;&lt;LI&gt;Creating wifidog database schema : &quot;</span><span class="src-sym">;</span></li>
<li><a name="a917"></a>        <span class="src-var">$content_schema </span>= <a href="http://www.php.net/preg_replace">preg_replace</a><span class="src-sym">(</span><span class="src-var">$patterns</span><span class="src-sym">, </span><span class="src-var">$replacements</span><span class="src-sym">, </span><span class="src-var">$content_schema</span><span class="src-sym">)</span><span class="src-sym">; </span><span class="src-comm"># Comment bad SQL lines</span></li>
<li><a name="a918"></a>&nbsp;</li>
<li><a name="a918"></a>        </li>
<li><a name="a919"></a>        <span class="src-var">$result </span>= <a href="http://www.php.net/pg_query">pg_query</a><span class="src-sym">(</span><span class="src-var">$connection</span><span class="src-sym">, </span><span class="src-var">$content_schema</span><span class="src-sym">) </span><span class="src-key">or </span><span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">&quot;&lt;B&gt;&quot;</span>.<a href="http://www.php.net/pg_last_error">pg_last_error</a><span class="src-sym">(</span><span class="src-sym">)</span>.<span class="src-str">&quot;&lt;/B&gt; &lt;=&lt;BR&gt;&quot;</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a920"></a>        print <span class="src-str">&quot;OK&quot;</span><span class="src-sym">;</span></li>
<li><a name="a921"></a>&nbsp;</li>
<li><a name="a922"></a>        print <span class="src-str">&quot;&lt;LI&gt;Creating wifidog database initial data : &quot;</span><span class="src-sym">;</span></li>
<li><a name="a923"></a>        <span class="src-var">$content_data </span>= <a href="http://www.php.net/preg_replace">preg_replace</a><span class="src-sym">(</span><span class="src-var">$patterns</span><span class="src-sym">, </span><span class="src-var">$replacements</span><span class="src-sym">, </span><span class="src-var">$content_data</span><span class="src-sym">)</span><span class="src-sym">; </span><span class="src-comm"># Comment bad SQL lines</span></li>
<li><a name="a924"></a>&nbsp;</li>
<li><a name="a924"></a>        </li>
<li><a name="a925"></a>        <span class="src-var">$result </span>= <a href="http://www.php.net/pg_query">pg_query</a><span class="src-sym">(</span><span class="src-var">$connection</span><span class="src-sym">, </span><span class="src-var">$content_data</span><span class="src-sym">) </span><span class="src-key">or </span><span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">&quot;&lt;B&gt;&quot;</span>.<a href="http://www.php.net/pg_last_error">pg_last_error</a><span class="src-sym">(</span><span class="src-sym">)</span>.<span class="src-str">&quot;&lt;/B&gt; &lt;=&lt;BR&gt;&quot;</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a926"></a>        print <span class="src-str">&quot;OK&lt;/UL&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a927"></a>&nbsp;</li>
<li><a name="a928"></a>        <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Back&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;database&quot;</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Next&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;options&quot;</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a929"></a>      <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a930"></a>      <span class="src-comm">###################################</span></li>
<li><a name="a931"></a>            <span class="src-key">case </span><span class="src-str">'DBMS_MYSQL'</span>:</li>
<li><a name="a932"></a>        print <span class="src-str">&quot;MYSQL ... (Not working)&lt;BR&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a933"></a>        <span class="src-var">$ptr_connexion </span>= <span class="src-sym">@</span><a href="http://www.php.net/mysql_connect">mysql_connect</a><span class="src-sym">(</span><span class="src-var">$CONF_DATABASE_HOST</span><span class="src-sym">, </span><span class="src-var">$CONF_DATABASE_USER</span><span class="src-sym">, </span><span class="src-var">$CONF_DATABASE_PASSWORD</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a934"></a>        <span class="src-var">$select_db </span>= <a href="http://www.php.net/mysql_select_db">mysql_select_db</a><span class="src-sym">(</span><span class="src-var">$CONF_DATABASE_NAME</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a935"></a>&nbsp;</li>
<li><a name="a936"></a>        <span class="src-var">$previous_line </span>= <span class="src-str">''</span><span class="src-sym">; </span><span class="src-comm"># Used to remove &quot;,&quot; on the line before CONSTRAINT removed line.</span></li>
<li><a name="a937"></a>&nbsp;</li>
<li><a name="a937"></a>        </li>
<li><a name="a938"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$debug</span><span class="src-sym">) </span>print <span class="src-str">&quot;&lt;PRE&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a939"></a>&nbsp;</li>
<li><a name="a940"></a>        <span class="src-var">$inTable </span>= <span class="src-num">0</span><span class="src-sym">;</span></li>
<li><a name="a941"></a>        <span class="src-key">foreach </span><span class="src-sym">(</span><span class="src-var">$content_schema_array </span><span class="src-key">as </span><span class="src-var">$lineNum </span>=&gt; <span class="src-var">$line</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a942"></a><span class="src-comm">#          if (preg_match(&quot;/^--/&quot;, $line)) continue; # Remove commented lines</span></li>
<li><a name="a943"></a><span class="src-comm">#          if (preg_match(&quot;/^$/&quot;, $line))  continue; # Remove empty lines</span></li>
<li><a name="a944"></a>                    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$debug</span><span class="src-sym">) </span>print <span class="src-str">&quot;</span>&lt;<span class="src-id">B</span>&gt;<span class="src-id">ORI</span>&lt;/<span class="src-id">B</span>&gt; <span class="src-var">$line</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a945"></a>          <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">&quot;/^CREATE TABLE/&quot;</span><span class="src-sym">, </span><span class="src-var">$line</span><span class="src-sym">, </span><span class="src-var">$matchesArray</span><span class="src-sym">))</span></li>
<li><a name="a946"></a>            <span class="src-var">$inTable </span>= <span class="src-num">1</span><span class="src-sym">;</span></li>
<li><a name="a947"></a>          <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$inTable</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a948"></a>            <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$inTable </span>&amp;&amp; <a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">&quot;</span>/^\);$/<span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-var">$line</span><span class="src-sym">, </span><span class="src-var">$matchesArray</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a949"></a>              <span class="src-comm">#print &quot;&lt;B STYLE=\&quot;color:#FF0000;\&quot;&gt;OUT&lt;/B&gt;\n&quot;;</span></li>
<li><a name="a950"></a>&nbsp;</li>
<li><a name="a951"></a>              <span class="src-comm"># PG    =&gt; );</span></li>
<li><a name="a952"></a>              <span class="src-comm"># MySQL =&gt; ) TYPE=InnoDB;</span></li>
<li><a name="a953"></a>                            <span class="src-var">$line </span>= <a href="http://www.php.net/preg_replace">preg_replace</a><span class="src-sym">(</span><span class="src-str">&quot;</span>/^\);$/<span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;) TYPE=InnoDB;&quot;</span><span class="src-sym">, </span><span class="src-var">$line</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a954"></a>              <span class="src-var">$inTable </span>= <span class="src-num">0</span><span class="src-sym">;</span></li>
<li><a name="a955"></a>            <span class="src-sym">}</span></li>
<li><a name="a956"></a>            <span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a957"></a>              <span class="src-comm">#print &quot;&lt;B&gt;IN  \n&lt;/B&gt;&quot;; # The line is in CREATE TABLE</span></li>
<li><a name="a958"></a>&nbsp;</li>
<li><a name="a958"></a>              </li>
<li><a name="a959"></a>              <span class="src-key">if</span><span class="src-sym">(</span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">&quot;</span>/\s*<span class="src-id">CONSTRAINT</span>.*\n$/<span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-var">$line</span><span class="src-sym">)) </span><span class="src-sym">{ </span><span class="src-comm"># Remove CONSTRAINT. TODO : support constraint</span></li>
<li><a name="a960"></a>                                <span class="src-var">$line </span>= <a href="http://www.php.net/preg_replace">preg_replace</a><span class="src-sym">(</span><span class="src-str">&quot;</span>/\s*<span class="src-id">CONSTRAINT</span>.*\n$/<span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;&quot;</span><span class="src-sym">, </span><span class="src-var">$line</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a961"></a>                <span class="src-var">$previous_line </span>= <a href="http://www.php.net/preg_replace">preg_replace</a><span class="src-sym">(</span><span class="src-str">&quot;</span>/,$/<span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;&quot;</span><span class="src-sym">, </span><span class="src-var">$previous_line</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a962"></a>                <span class="src-comm">#print &quot;&lt;B STYLE=\&quot;color:#FF0000;\&quot;&gt;ICI : L=$line PL=$previous_line&lt;/B&gt;&quot;;</span></li>
<li><a name="a963"></a>                            <span class="src-sym">}</span></li>
<li><a name="a964"></a>              <span class="src-comm"># Mettre TYPE=InnoDB uniquement pour table avec CONSTRAINT ???</span></li>
<li><a name="a965"></a>&nbsp;</li>
<li><a name="a966"></a>              <span class="src-comm"># PG    =&gt;  token_status character varying(10) NOT NULL</span></li>
<li><a name="a967"></a>              <span class="src-comm"># MySQL =&gt; `token_status` character varying(10) NOT NULL</span></li>
<li><a name="a968"></a>                            <span class="src-var">$line </span>= <a href="http://www.php.net/preg_replace">preg_replace</a><span class="src-sym">(</span><span class="src-str">&quot;/^(\s+)(\w+)/&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;\${1}`\${2}`&quot;</span><span class="src-sym">, </span><span class="src-var">$line</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a969"></a>&nbsp;</li>
<li><a name="a970"></a>              <span class="src-var">$line </span>= <a href="http://www.php.net/preg_replace">preg_replace</a><span class="src-sym">(</span><span class="src-str">&quot;/DEFAULT ('.*')::character varying NOT NULL/&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;NOT NULL default \${1}&quot;</span><span class="src-sym">, </span><span class="src-var">$line</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a971"></a>&nbsp;</li>
<li><a name="a972"></a>              <span class="src-var">$line </span>= <a href="http://www.php.net/preg_replace">preg_replace</a><span class="src-sym">(</span><span class="src-str">&quot;/text DEFAULT [\w':]+/&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;text DEFAULT ''&quot;</span><span class="src-sym">, </span><span class="src-var">$line</span><span class="src-sym">)</span><span class="src-sym">; </span><span class="src-comm"># MySQL does not support &quot;text&quot; default value</span></li>
<li><a name="a973"></a>              <span class="src-comm">#??? Erreur : 1101 - BLOB/TEXT column 'venue_type' can't have a default value. Solution : Changer 'text' pour varchar ???</span></li>
<li><a name="a974"></a>&nbsp;</li>
<li><a name="a975"></a>              <span class="src-comm"># PG    =&gt;  token_status character varying(10) NOT NULL</span></li>
<li><a name="a976"></a>              <span class="src-comm"># MySQL =&gt;  token_status VARCHAR(10) NOT NULL</span></li>
<li><a name="a977"></a>                            <span class="src-var">$line </span>= <a href="http://www.php.net/preg_replace">preg_replace</a><span class="src-sym">(</span><span class="src-str">&quot;/character varying\(/&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;VARCHAR(&quot;</span><span class="src-sym">, </span><span class="src-var">$line</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a978"></a>&nbsp;</li>
<li><a name="a979"></a>              <span class="src-var">$line </span>= <a href="http://www.php.net/preg_replace">preg_replace</a><span class="src-sym">(</span><span class="src-str">&quot;/::character varying/&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;&quot;</span><span class="src-sym">, </span><span class="src-var">$line</span><span class="src-sym">)</span><span class="src-sym">; </span><span class="src-comm"># Remove string &quot;::character varying&quot;</span></li>
<li><a name="a980"></a>&nbsp;</li>
<li><a name="a981"></a>              <span class="src-comm"># PG    =&gt; account_status integer,</span></li>
<li><a name="a982"></a>              <span class="src-comm"># MySQL =&gt; account_status int,</span></li>
<li><a name="a983"></a>                            <span class="src-var">$line </span>= <a href="http://www.php.net/preg_replace">preg_replace</a><span class="src-sym">(</span><span class="src-str">&quot;/integer/&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;int&quot;</span><span class="src-sym">, </span><span class="src-var">$line</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a984"></a>&nbsp;</li>
<li><a name="a985"></a>              <span class="src-comm"># TODO : Comprendre : Le timestamp de postgres est sous le format '2005-04-07 16:33:49.917127'</span></li>
<li><a name="a986"></a>              <span class="src-comm">#                     datetime de MySQL est '0000-00-00 00:00:00'</span></li>
<li><a name="a987"></a>                            <span class="src-var">$line </span>= <a href="http://www.php.net/preg_replace">preg_replace</a><span class="src-sym">(</span><span class="src-str">&quot;/timestamp without time zone/&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;datetime&quot;</span><span class="src-sym">, </span><span class="src-var">$line</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a988"></a>&nbsp;</li>
<li><a name="a989"></a>              <span class="src-var">$line </span>= <a href="http://www.php.net/preg_replace">preg_replace</a><span class="src-sym">(</span><span class="src-str">&quot;/now\(\)/&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;'NOW()'&quot;</span><span class="src-sym">, </span><span class="src-var">$line</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a990"></a>&nbsp;</li>
<li><a name="a991"></a>              <span class="src-comm">#$line = preg_replace(&quot;/::text/&quot;, &quot;&quot;, $line);</span></li>
<li><a name="a992"></a>&nbsp;</li>
<li><a name="a992"></a>              </li>
<li><a name="a993"></a>              <span class="src-var">$line </span>= <a href="http://www.php.net/preg_replace">preg_replace</a><span class="src-sym">(</span><span class="src-str">&quot;/false/&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;0&quot;</span><span class="src-sym">, </span><span class="src-var">$line</span><span class="src-sym">)</span><span class="src-sym">; </span><span class="src-comm"># Change &quot;false&quot; strings for 0 (zero)</span></li>
<li><a name="a994"></a>                            <span class="src-var">$line </span>= <a href="http://www.php.net/preg_replace">preg_replace</a><span class="src-sym">(</span><span class="src-str">&quot;/true/&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;1&quot;</span><span class="src-sym">, </span><span class="src-var">$line</span><span class="src-sym">)</span><span class="src-sym">;  </span><span class="src-comm"># Change &quot;true&quot; strings for 1 (one)</span></li>
<li><a name="a995"></a>                            <span class="src-var">$line </span>= <a href="http://www.php.net/preg_replace">preg_replace</a><span class="src-sym">(</span><span class="src-str">&quot;/WITHOUT OIDS/&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;&quot;</span><span class="src-sym">, </span><span class="src-var">$line</span><span class="src-sym">)</span><span class="src-sym">; </span><span class="src-comm"># Remove &quot;WITHOUT OIDS&quot;</span></li>
<li><a name="a996"></a>&nbsp;</li>
<li><a name="a997"></a>              <span class="src-comm"># PG    =&gt; binary_data bytea,</span></li>
<li><a name="a998"></a>              <span class="src-comm"># MySQL =&gt; binary_data MEDIUMBLOB</span></li>
<li><a name="a999"></a>              <span class="src-comm"># Uploading, Saving and Downloading Binary Data in a MySQL Database http://www.onlamp.com/lpt/a/370</span></li>
<li><a name="a1000"></a>                            <span class="src-var">$line </span>= <a href="http://www.php.net/preg_replace">preg_replace</a><span class="src-sym">(</span><span class="src-str">&quot;/bytea/&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;MEDIUMBLOB&quot;</span><span class="src-sym">, </span><span class="src-var">$line</span><span class="src-sym">)</span><span class="src-sym">; </span><span class="src-comm"># maximum 16777215 (2^24 - 1) bytes</span></li>
<li><a name="a1001"></a>                        <span class="src-sym">} </span><span class="src-comm">### End of else. Regex in CREATE TABLE {};</span></li>
<li><a name="a1002"></a>                    <span class="src-sym">} </span><span class="src-comm">### End of if ($inTable).</span></li>
<li><a name="a1003"></a>&nbsp;</li>
<li><a name="a1004"></a>          <span class="src-comm"># PG    =&gt; CREATE INDEX idx_token ON connections USING btree (token);</span></li>
<li><a name="a1005"></a>          <span class="src-comm"># MySQL =&gt; CREATE INDEX idx_token USING btree ON connections (token);</span></li>
<li><a name="a1006"></a>                    <span class="src-var">$line </span>= <a href="http://www.php.net/preg_replace">preg_replace</a><span class="src-sym">(</span><span class="src-str">&quot;/(ON \w+) USING btree/&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;USING btree \${1}&quot;</span><span class="src-sym">, </span><span class="src-var">$line</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1007"></a>&nbsp;</li>
<li><a name="a1008"></a>          <span class="src-comm"># SQL-query : CREATE UNIQUE INDEX idx_unique_username_and_account_origin USING btree ON users(username,account_origin)</span></li>
<li><a name="a1009"></a>          <span class="src-comm"># MySQL said: #1170 - BLOB/TEXT column 'username' used in key specification without a key length</span></li>
<li><a name="a1010"></a>          <span class="src-comm"># Solution : http://www.dbforums.com/t1100992.html</span></li>
<li><a name="a1011"></a>                    <span class="src-var">$line </span>= <a href="http://www.php.net/preg_replace">preg_replace</a><span class="src-sym">(</span><span class="src-str">&quot;/CREATE UNIQUE INDEX idx_unique_username_and_account_origin USING btree ON users \(username, account_origin\);/&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;CREATE UNIQUE INDEX idx_unique_username_and_account_origin USING btree ON users (username(100), account_origin(100));&quot;</span><span class="src-sym">, </span><span class="src-var">$line</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1012"></a>&nbsp;</li>
<li><a name="a1013"></a>          <span class="src-var">$line </span>= <a href="http://www.php.net/preg_replace">preg_replace</a><span class="src-sym">(</span><span class="src-str">&quot;/CREATE INDEX idx_content_group_element_content_group_id USING btree ON content_group_element \(content_group_id\);/&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;CREATE INDEX idx_content_group_element_content_group_id USING btree ON content_group_element (content_group_id(100));&quot;</span><span class="src-sym">, </span><span class="src-var">$line</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1014"></a>&nbsp;</li>
<li><a name="a1015"></a>          <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$debug</span><span class="src-sym">) </span>print <span class="src-str">&quot;</span><span class="src-id">NEW </span><span class="src-var">$line</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1016"></a>            <span class="src-var">$content_mysql </span>.= <span class="src-var">$previous_line</span><span class="src-sym">;</span></li>
<li><a name="a1017"></a>          <span class="src-var">$previous_line </span>= <span class="src-var">$line</span><span class="src-sym">;</span></li>
<li><a name="a1018"></a>        <span class="src-sym">} </span><span class="src-comm">### End of foreach ($content_schema_array as $lineNum =&gt; $line)</span></li>
<li><a name="a1019"></a>&nbsp;</li>
<li><a name="a1019"></a>        </li>
<li><a name="a1020"></a>        <span class="src-var">$content_mysql </span>.= <span class="src-var">$previous_line</span><span class="src-sym">; </span><span class="src-comm"># TODO: verif save the last line ?</span></li>
<li><a name="a1021"></a>                <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$debug</span><span class="src-sym">) </span>print <span class="src-str">&quot;</span>&lt;<span class="src-id">B STYLE</span>=\&quot;<span class="src-id">color</span>:#<span class="src-id">FF0000</span>;\&quot;&gt;####################################################################&lt;/<span class="src-id">B</span>&gt;\n\n<span class="src-var">$content_mysql</span><span class="src-str">&quot;</span><span class="src-sym">; </span><span class="src-comm"># Debug</span></li>
<li><a name="a1022"></a>                <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$debug</span><span class="src-sym">) </span>print <span class="src-str">&quot;&lt;/PRE&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1023"></a>&nbsp;</li>
<li><a name="a1024"></a><span class="src-comm">#        $content_data = implode(&quot;&quot;, $content_mysql);</span></li>
<li><a name="a1025"></a>&nbsp;</li>
<li><a name="a1025"></a>        </li>
<li><a name="a1026"></a>        <span class="src-var">$patterns</span><span class="src-sym">[</span><span class="src-num">3</span><span class="src-sym">]     </span>= <span class="src-str">'/SET client_encoding/'</span><span class="src-sym">;</span></li>
<li><a name="a1027"></a>        <span class="src-var">$patterns</span><span class="src-sym">[</span><span class="src-num">4</span><span class="src-sym">]     </span>= <span class="src-str">'/SET check_function_bodies/'</span><span class="src-sym">;</span></li>
<li><a name="a1028"></a>        <span class="src-var">$patterns</span><span class="src-sym">[</span><span class="src-num">5</span><span class="src-sym">]     </span>= <span class="src-str">'/SET search_path/'</span><span class="src-sym">;</span></li>
<li><a name="a1029"></a>        <span class="src-var">$replacements</span><span class="src-sym">[</span><span class="src-num">3</span><span class="src-sym">] </span>= <span class="src-str">'-- '</span><span class="src-sym">;</span></li>
<li><a name="a1030"></a>        <span class="src-var">$replacements</span><span class="src-sym">[</span><span class="src-num">4</span><span class="src-sym">] </span>= <span class="src-str">'-- '</span><span class="src-sym">;</span></li>
<li><a name="a1031"></a>        <span class="src-var">$replacements</span><span class="src-sym">[</span><span class="src-num">5</span><span class="src-sym">] </span>= <span class="src-str">'-- '</span><span class="src-sym">;</span></li>
<li><a name="a1032"></a>&nbsp;</li>
<li><a name="a1033"></a>        <span class="src-var">$content_mysql </span>= <a href="http://www.php.net/preg_replace">preg_replace</a><span class="src-sym">(</span><span class="src-var">$patterns</span><span class="src-sym">, </span><span class="src-var">$replacements</span><span class="src-sym">, </span><span class="src-var">$content_mysql</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1034"></a>&nbsp;</li>
<li><a name="a1035"></a>        print <span class="src-str">&quot;</span>&lt;<span class="src-id">PRE</span>&gt;<span class="src-var">$content_mysql</span>&lt;/<span class="src-id">PRE</span>&gt;<span class="src-str">&quot;</span><span class="src-sym">; </span><span class="src-comm"># Debug</span></li>
<li><a name="a1036"></a>&nbsp;</li>
<li><a name="a1036"></a>        </li>
<li><a name="a1037"></a>        <span class="src-key">exit</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1038"></a>&nbsp;</li>
<li><a name="a1039"></a>        <span class="src-var">$result </span>= <a href="http://www.php.net/mysql_query">mysql_query</a><span class="src-sym">(</span><span class="src-var">$content_mysql</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1040"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-var">$result</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1041"></a>          <span class="src-key">die</span><span class="src-sym">(</span><span class="src-str">'Invalid query: ' </span>. <a href="http://www.php.net/mysql_error">mysql_error</a><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a1042"></a>        <span class="src-sym">}</span></li>
<li><a name="a1043"></a>&nbsp;</li>
<li><a name="a1044"></a>        <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Back&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;database&quot;</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Next&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;dbinit&quot;</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a1045"></a>      <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1046"></a>      <span class="src-key">default</span>:</li>
<li><a name="a1047"></a>        print &lt;&lt;&lt;EndHTML</li>
<li><a name="a1048"></a>          <span class="src-id">The CONF_DBMS value</span> &lt;<span class="src-id">B</span>&gt;<span class="src-var">$CONF_DBMS</span>&lt;/<span class="src-id">B</span>&gt; <span class="src-id">is not currently suported by this install script</span>.</li>
<li><a name="a1049"></a>EndHTML<span class="src-sym">;        </span><a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Back&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;database&quot;</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a1050"></a>    <span class="src-sym">}</span></li>
<li><a name="a1051"></a>  <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1052"></a>&nbsp;</li>
<li><a name="a1053"></a>  <span class="src-comm">###################################</span></li>
<li><a name="a1054"></a>    <span class="src-key">case </span><span class="src-str">'schema_validate'</span>:</li>
<li><a name="a1055"></a>    print <span class="src-str">&quot;&lt;H1&gt;Database schema upgrade&lt;/H1&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1056"></a>&nbsp;</li>
<li><a name="a1057"></a>    <span class="src-doc">/**</span></li>
<li><a name="a1058"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@ignore</span></li>
<li><a name="a1059"></a><span class="src-doc">     */</span></li>
<li><a name="a1060"></a>    <a href="http://www.php.net/define">define</a><span class="src-sym">(</span><span class="src-str">'BASEPATH'</span><span class="src-sym">, </span><span class="src-str">'./'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1061"></a>&nbsp;</li>
<li><a name="a1062"></a>    <span class="src-inc">require_once </span><span class="src-id">BASEPATH</span>.<span class="src-str">'include/common.php'</span><span class="src-sym">;</span></li>
<li><a name="a1063"></a>    <span class="src-inc">require_once </span><span class="src-id">BASEPATH</span>.<span class="src-str">'config.php'</span><span class="src-sym">;</span></li>
<li><a name="a1064"></a>    <span class="src-inc">require_once </span><span class="src-id">BASEPATH</span>.<span class="src-str">'classes/AbstractDb.php'</span><span class="src-sym">;</span></li>
<li><a name="a1065"></a>    <span class="src-inc">require_once </span><span class="src-id">BASEPATH</span>.<span class="src-str">'classes/Session.php'</span><span class="src-sym">;</span></li>
<li><a name="a1066"></a>    <span class="src-inc">require_once </span><span class="src-id">BASEPATH</span>.<span class="src-str">'include/schema_validate.php'</span><span class="src-sym">;</span></li>
<li><a name="a1067"></a>    <a href="../WiFiDogAuthServer/_wifidog_include_schema_validate_php.html#functionvalidate_schema">validate_schema</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1068"></a>&nbsp;</li>
<li><a name="a1069"></a>    <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Back&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;dbinit&quot;</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Next&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;options&quot;</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a1070"></a>&nbsp;</li>
<li><a name="a1071"></a>    <span class="src-comm">//navigation(array(array(&quot;title&quot; =&gt; &quot;Back&quot;, &quot;page&quot; =&gt; &quot;dbinit&quot;)));</span></li>
<li><a name="a1072"></a>    <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1073"></a>&nbsp;</li>
<li><a name="a1074"></a>  <span class="src-comm">###################################</span></li>
<li><a name="a1075"></a>    <span class="src-key">case </span><span class="src-str">'options'</span>:</li>
<li><a name="a1076"></a>    <span class="src-comm"># TODO : Tester que la connection SSL est fonctionnelle</span></li>
<li><a name="a1077"></a>    <span class="src-comm">#        Options avancees : Supporter les define de [SMARTY|MAGPIE|PHLICKR|JPGRAPH]_REL_PATH</span></li>
<li><a name="a1078"></a>        print &lt;&lt;&lt; EndHTML</li>
<li><a name="a1079"></a>&lt;<span class="src-id">H1</span>&gt;<span class="src-id">Options</span>&lt;/<span class="src-id">H1</span>&gt;</li>
<li><a name="a1080"></a>&lt;<span class="src-id">P</span>&gt;<span class="src-id">Not yet finished</span> ... (<span class="src-id">dependencies autodetection and few other options</span>)&lt;/<span class="src-id">P</span>&gt;</li>
<li><a name="a1081"></a>  &lt;<span class="src-id">TABLE border</span>=&quot;1&quot;&gt;</li>
<li><a name="a1082"></a>&nbsp;</li>
<li><a name="a1083"></a>EndHTML<span class="src-sym">;</span></li>
<li><a name="a1084"></a>    <span class="src-comm">#$neededPackages['phlickr']['available'] = 0;</span></li>
<li><a name="a1085"></a>    <span class="src-comm">#$neededExtentions['xml']['available'] = 0;</span></li>
<li><a name="a1086"></a>        <span class="src-key">foreach </span><span class="src-sym">(</span><span class="src-var">$optionsInfo </span><span class="src-key">as </span><span class="src-var">$name </span>=&gt; <span class="src-var">$foo</span><span class="src-sym">) </span><span class="src-sym">{         </span><span class="src-comm"># Foreach generate all &lt;TABLE&gt; fields</span></li>
<li><a name="a1087"></a>            <span class="src-var">$value  </span>= <span class="src-var">$configArray</span><span class="src-sym">[</span><span class="src-var">$name</span><span class="src-sym">]</span><span class="src-sym">;                  </span><span class="src-comm"># Value of option in config.php</span></li>
<li><a name="a1088"></a>            <span class="src-var">$title  </span>= <span class="src-var">$optionsInfo</span><span class="src-sym">[</span><span class="src-var">$name</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-str">'title'</span><span class="src-sym">]</span><span class="src-sym">;         </span><span class="src-comm"># Field Title</span></li>
<li><a name="a1089"></a>            <span class="src-var">$message </span>= <span class="src-var">$optionsInfo</span><span class="src-sym">[</span><span class="src-var">$name</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-str">'message'</span><span class="src-sym">]</span><span class="src-sym">;      </span><span class="src-comm"># Message why option is disable</span></li>
<li><a name="a1090"></a>            <span class="src-var">$depend </span>= <span class="src-sym">@</span>eval<span class="src-sym">(</span><span class="src-var">$optionsInfo</span><span class="src-sym">[</span><span class="src-var">$name</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-str">'depend'</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">; </span><span class="src-comm"># Evaluate the dependencie</span></li>
<li><a name="a1091"></a>            <span class="src-var">$selectedTrue </span>= <span class="src-str">''</span><span class="src-sym">; </span><span class="src-var">$selectedFalse </span>= <span class="src-str">''</span><span class="src-sym">;        </span><span class="src-comm"># Initialize value</span></li>
<li><a name="a1092"></a>            <span class="src-var">$value  </span>== <span class="src-str">'true' </span>? <span class="src-var">$selectedTrue </span>= <span class="src-str">'SELECTED' </span>: <span class="src-var">$selectedFalse </span>= <span class="src-str">'SELECTED'</span><span class="src-sym">;           </span><span class="src-comm"># Use to select the previous saved option</span></li>
<li><a name="a1093"></a>            <span class="src-var">$depend </span>== <span class="src-num">1      </span>? <span class="src-var">$disabled     </span>= <span class="src-str">''         </span>: <span class="src-var">$disabled </span>= <span class="src-str">'DISABLED'</span><span class="src-sym">;                </span><span class="src-comm"># Disable &lt;SELECT&gt; if dependencie is not satisfied</span></li>
<li><a name="a1094"></a>            <span class="src-var">$jscript </span>= <span class="src-str">&quot;</span>&lt;<span class="src-id">script type</span>=\&quot;<span class="src-id">text</span>/<span class="src-id">javascript</span>\&quot;&gt; <span class="src-id">newConfig</span>(\&quot;<span class="src-var">$name</span>=<span class="src-id">false</span>\&quot;); &lt;/<span class="src-id">script</span>&gt;\n<span class="src-str">&quot;</span><span class="src-sym">; </span><span class="src-comm"># Use to save a failed dependencie (option=false)</span></li>
<li><a name="a1095"></a>            <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$disabled </span>== <span class="src-str">''</span><span class="src-sym">) </span><span class="src-comm"># Dependencie ok, erase $jscript value</span></li>
<li><a name="a1096"></a>                <span class="src-var">$jscript </span>= <span class="src-str">''</span><span class="src-sym">;</span></li>
<li><a name="a1097"></a>&nbsp;</li>
<li><a name="a1098"></a>      print &lt;&lt;&lt; EndHTML</li>
<li><a name="a1099"></a>  &lt;<span class="src-id">TR</span>&gt;</li>
<li><a name="a1100"></a>    &lt;<span class="src-id">TD</span>&gt;<span class="src-var">$title</span>&lt;/<span class="src-id">TD</span>&gt;</li>
<li><a name="a1101"></a>    &lt;<span class="src-id">TD</span>&gt;&lt;<span class="src-id">SELECT name</span>=&quot;<span class="src-var">$name</span>&quot; <span class="src-var">$disabled</span>&gt;</li>
<li><a name="a1102"></a>          &lt;<span class="src-id">OPTION value</span>=&quot;<span class="src-id">true</span>&quot; <span class="src-var">$selectedTrue</span>&gt;<span class="src-id">true</span>&lt;/<span class="src-id">OPTION</span>&gt;</li>
<li><a name="a1103"></a>          &lt;<span class="src-id">OPTION value</span>=&quot;<span class="src-id">false</span>&quot; <span class="src-var">$selectedFalse</span>&gt;<span class="src-id">false</span>&lt;/<span class="src-id">OPTION</span>&gt;</li>
<li><a name="a1104"></a>        &lt;/<span class="src-id">SELECT</span>&gt;</li>
<li><a name="a1105"></a>    &lt;/<span class="src-id">TD</span>&gt;</li>
<li><a name="a1106"></a>    &lt;<span class="src-id">TD</span>&gt;<span class="src-var">$message</span>&lt;/<span class="src-id">TD</span>&gt;</li>
<li><a name="a1107"></a>  &lt;/<span class="src-id">TR</span>&gt;</li>
<li><a name="a1108"></a>  <span class="src-var">$jscript</span></li>
<li><a name="a1109"></a>EndHTML<span class="src-sym">;    </span><span class="src-sym">} </span><span class="src-comm"># End or foreach</span></li>
<li><a name="a1110"></a>        print &lt;&lt;&lt; EndHTML</li>
<li><a name="a1111"></a>    &lt;/<span class="src-id">TABLE</span>&gt;</li>
<li><a name="a1112"></a>&nbsp;</li>
<li><a name="a1113"></a>&lt;<span class="src-id">script type</span>=&quot;<span class="src-id">text</span>/<span class="src-id">javascript</span>&quot;&gt;</li>
<li><a name="a1114"></a>  <span class="src-id">function submitOptionsValue</span>() <span class="src-sym">{</span></li>
<li><a name="a1115"></a>&nbsp;</li>
<li><a name="a1116"></a>EndHTML<span class="src-sym">;</span></li>
<li><a name="a1117"></a>    <span class="src-key">foreach </span><span class="src-sym">(</span><span class="src-var">$optionsInfo </span><span class="src-key">as </span><span class="src-var">$name </span>=&gt; <span class="src-var">$foo</span><span class="src-sym">) </span><span class="src-sym">{ </span><span class="src-comm"># Generate the javascript to save value on submit</span></li>
<li><a name="a1118"></a>        print &lt;&lt;&lt; EndHTML</li>
<li><a name="a1119"></a>    <span class="src-id">if</span> (!<span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-var">$name</span>.<span class="src-id">disabled</span>)</li>
<li><a name="a1120"></a>      <span class="src-id">newConfig</span>(&quot;<span class="src-var">$name</span>=&quot; + <span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-var">$name</span>.<span class="src-id">value</span>);</li>
<li><a name="a1121"></a>&nbsp;</li>
<li><a name="a1122"></a>EndHTML<span class="src-sym">;    </span><span class="src-sym">} </span><span class="src-comm"># End Foreach</span></li>
<li><a name="a1123"></a>&nbsp;</li>
<li><a name="a1123"></a>    </li>
<li><a name="a1124"></a>    print &lt;&lt;&lt; EndHTML</li>
<li><a name="a1125"></a>  <span class="src-sym">}</span></li>
<li><a name="a1126"></a>&lt;/<span class="src-id">script</span>&gt;</li>
<li><a name="a1127"></a>&nbsp;</li>
<li><a name="a1128"></a>EndHTML<span class="src-sym">;    </span><a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Back&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;dbinit&quot;</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a1129"></a>&nbsp;</li>
<li><a name="a1130"></a>    print &lt;&lt;&lt; EndHTML</li>
<li><a name="a1131"></a>&lt;<span class="src-id">P</span>&gt;&lt;<span class="src-id">A HREF</span>=&quot;#&quot; <span class="src-id">ONCLICK</span>=&quot;<span class="src-id">javascript</span>: <span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-id">page</span>.<span class="src-id">value</span>='<span class="src-id">languages</span>'; <span class="src-id">submitOptionsValue</span>(); <span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-id">submit</span>();&quot; <span class="src-id">CLASS</span>=&quot;<span class="src-id">button</span>&quot;&gt;<span class="src-id">Next</span>&lt;/<span class="src-id">A</span>&gt;&lt;/<span class="src-id">P</span>&gt;</li>
<li><a name="a1132"></a>EndHTML<span class="src-sym">;</span></li>
<li><a name="a1133"></a>  <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1134"></a>&nbsp;</li>
<li><a name="a1135"></a>  <span class="src-comm">###################################</span></li>
<li><a name="a1136"></a>    <span class="src-key">case </span><span class="src-str">'languages'</span>:</li>
<li><a name="a1137"></a>    print <span class="src-str">&quot;&lt;H1&gt;Languages configuration&lt;/H1&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1138"></a>    print &lt;&lt;&lt; EndHTML</li>
<li><a name="a1139"></a>      &lt;<span class="src-id">P</span>&gt;<span class="src-id">Not yet implemented</span> ...&lt;/<span class="src-id">P</span>&gt;</li>
<li><a name="a1140"></a>      &lt;<span class="src-id">P</span>&gt;<span class="src-id">Will allow wich language can be use and correct error from unknown locale information</span>&lt;/<span class="src-id">P</span>&gt;</li>
<li><a name="a1141"></a>&lt;<span class="src-id">B</span>&gt;<span class="src-id">Errror message example</span>&lt;/<span class="src-id">B</span>&gt; : &lt;<span class="src-id">BR</span>&gt;</li>
<li><a name="a1142"></a>&lt;<span class="src-id">DIV style</span>=&quot;<span class="src-id">border</span>:<span class="src-id">solid black</span>;&quot;&gt;<span class="src-id">Warning</span>: <span class="src-id">language</span>.<span class="src-id">php</span>: <span class="src-id">Unable to setlocale</span>() <span class="src-id">to fr</span>, <span class="src-id">return value</span>: , <span class="src-id">current locale</span>: <span class="src-id">LC_CTYPE</span>=<span class="src-id">en_US</span>.<span class="src-id">UTF</span>-8;<span class="src-id">LC_NUMERIC</span>=<span class="src-id">C</span>; <span class="src-sym">[</span>...<span class="src-sym">]</span>&lt;/<span class="src-id">DIV</span>&gt;</li>
<li><a name="a1143"></a>EndHTML<span class="src-sym">;</span><span class="src-comm">//    exec(&quot;locale -a 2&gt;&amp;1&quot;, $output, $return);</span></li>
<li><a name="a1144"></a>&nbsp;</li>
<li><a name="a1144"></a>    </li>
<li><a name="a1145"></a>    <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Back&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;options&quot;</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Next&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;radius&quot;</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a1146"></a>  <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1147"></a>&nbsp;</li>
<li><a name="a1148"></a>  <span class="src-comm">###################################</span></li>
<li><a name="a1149"></a>    <span class="src-key">case </span><span class="src-str">'radius'</span>:</li>
<li><a name="a1150"></a>    print <span class="src-str">&quot;&lt;H1&gt;Radius configuration&lt;/H1&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1151"></a>    print <span class="src-str">&quot;&lt;P&gt;Not yet implemented ...&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1152"></a>&nbsp;</li>
<li><a name="a1153"></a>    <span class="src-comm"># Dependencies</span></li>
<li><a name="a1154"></a>    <span class="src-comm">#$neededExtentions['mcrypt']['available'];</span></li>
<li><a name="a1155"></a>    <span class="src-comm">#$neededExtentions['mhash']['available'];</span></li>
<li><a name="a1156"></a>    <span class="src-comm">#$neededExtentions['xmlrpc']['available'];</span></li>
<li><a name="a1157"></a>    <span class="src-comm">#$neededPEARPackages['radius']['available'];</span></li>
<li><a name="a1158"></a>    <span class="src-comm">#$neededPEARPackages['Auth_RADIUS']['available'];</span></li>
<li><a name="a1159"></a>    <span class="src-comm">#$neededPEARPackages['Crypt_CHAP']['available'];</span></li>
<li><a name="a1160"></a>&nbsp;</li>
<li><a name="a1160"></a>    </li>
<li><a name="a1161"></a>    <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Back&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;languages&quot;</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Next&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;admin&quot;</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a1162"></a>  <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1163"></a>&nbsp;</li>
<li><a name="a1164"></a>  <span class="src-comm">###################################</span></li>
<li><a name="a1165"></a>    <span class="src-key">case </span><span class="src-str">'admin'</span>:</li>
<li><a name="a1166"></a>    print <span class="src-str">&quot;&lt;H1&gt;Administration account&lt;/H1&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1167"></a>    <span class="src-comm"># TODO : Allow to create more than one admin account and list the current admin users</span></li>
<li><a name="a1168"></a>    <span class="src-comm">#        Allow admin to choose to show or not is username</span></li>
<li><a name="a1169"></a>        <span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$_REQUEST</span><span class="src-sym">[</span><span class="src-str">'username'</span><span class="src-sym">]</span><span class="src-sym">)  </span>? <span class="src-var">$username   </span>= <span class="src-str">'admin'                  </span>: <span class="src-var">$username   </span>= <span class="src-var">$_REQUEST</span><span class="src-sym">[</span><span class="src-str">'username'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1170"></a>    <span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$_REQUEST</span><span class="src-sym">[</span><span class="src-str">'password'</span><span class="src-sym">]</span><span class="src-sym">)  </span>? <span class="src-var">$password   </span>= <span class="src-str">''                       </span>: <span class="src-var">$password   </span>= <span class="src-var">$_REQUEST</span><span class="src-sym">[</span><span class="src-str">'password'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1171"></a>    <span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$_REQUEST</span><span class="src-sym">[</span><span class="src-str">'password2'</span><span class="src-sym">]</span><span class="src-sym">) </span>? <span class="src-var">$password2  </span>= <span class="src-str">''                       </span>: <span class="src-var">$password2  </span>= <span class="src-var">$_REQUEST</span><span class="src-sym">[</span><span class="src-str">'password2'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1172"></a>    <span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$_REQUEST</span><span class="src-sym">[</span><span class="src-str">'email'</span><span class="src-sym">]</span><span class="src-sym">)     </span>? <span class="src-var">$email      </span>= <span class="src-var">$_SERVER</span><span class="src-sym">[</span><span class="src-str">'SERVER_ADMIN'</span><span class="src-sym">] </span>: <span class="src-var">$email      </span>= <span class="src-var">$_REQUEST</span><span class="src-sym">[</span><span class="src-str">'email'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1173"></a>&nbsp;</li>
<li><a name="a1174"></a>    <span class="src-var">$conn_string </span>= <span class="src-str">&quot;</span><span class="src-id">host</span>=<span class="src-var">$CONF_DATABASE_HOST </span><span class="src-id">dbname</span>=<span class="src-var">$CONF_DATABASE_NAME </span><span class="src-id">user</span>=<span class="src-var">$CONF_DATABASE_USER </span><span class="src-id">password</span>=<span class="src-var">$CONF_DATABASE_PASSWORD</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1175"></a>    <span class="src-var">$connection </span>= <a href="http://www.php.net/pg_connect">pg_connect</a><span class="src-sym">(</span><span class="src-var">$conn_string</span><span class="src-sym">) </span><span class="src-key">or </span><span class="src-key">die</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1176"></a>&nbsp;</li>
<li><a name="a1177"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$action </span>== <span class="src-str">'create'</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1178"></a>      <a href="http://www.php.net/define">define</a><span class="src-sym">(</span><span class="src-str">'BASEPATH'</span><span class="src-sym">, </span><span class="src-str">'./'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1179"></a>      <span class="src-inc">require_once </span><span class="src-id">BASEPATH</span>.<span class="src-str">'classes/User.php'</span><span class="src-sym">;</span></li>
<li><a name="a1180"></a>&nbsp;</li>
<li><a name="a1181"></a>      <span class="src-var">$created_user </span>= <span class="src-id"><a href="../WiFiDogAuthServer/User.html">User</a> </span><span class="src-sym">:: </span><a href="../WiFiDogAuthServer/User.html#methodcreateUser">createUser</a><span class="src-sym">(</span><a href="../WiFiDogAuthServer/_wifidog_include_common_php.html#functionget_guid">get_guid</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-var">$username</span><span class="src-sym">, </span><span class="src-id"><a href="../WiFiDogAuthServer/Network.html">Network</a></span><span class="src-sym">::</span><a href="../WiFiDogAuthServer/Network.html#methodgetDefaultNetwork">getDefaultNetwork</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-var">$email</span><span class="src-sym">, </span><span class="src-var">$password</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1182"></a>      <span class="src-var">$user_id </span>= <span class="src-var">$created_user</span><span class="src-sym">-&gt;</span><span class="src-id">getId</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1183"></a>&nbsp;</li>
<li><a name="a1184"></a>      <span class="src-comm"># Add user to admin table, hide his username and set his account status to 1 (allowed)</span></li>
<li><a name="a1185"></a>            <span class="src-var">$sql </span>= <span class="src-str">&quot;INSERT INTO administrators (user_id) VALUES ('&quot; </span>. <span class="src-var">$created_user</span><span class="src-sym">-&gt;</span><span class="src-id">getId</span><span class="src-sym">(</span><span class="src-sym">) </span>. <span class="src-str">&quot;</span>'); <span class="src-id">UPDATE users SET    account_status</span>='1', <span class="src-id">never_show_username</span>=<span class="src-id">true WHERE user_id</span>='<span class="src-var">$user_id</span>'<span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1186"></a>      <span class="src-var">$result </span>= <a href="http://www.php.net/pg_query">pg_query</a><span class="src-sym">(</span><span class="src-var">$connection</span><span class="src-sym">, </span><span class="src-var">$sql</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1187"></a>    <span class="src-sym">}</span></li>
<li><a name="a1188"></a>&nbsp;</li>
<li><a name="a1189"></a>    <span class="src-var">$sql </span>= <span class="src-str">&quot;SELECT * FROM users NATURAL JOIN administrators WHERE account_origin = 'LOCAL_USER'&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1190"></a>    <span class="src-var">$result </span>= <a href="http://www.php.net/pg_query">pg_query</a><span class="src-sym">(</span><span class="src-var">$connection</span><span class="src-sym">, </span><span class="src-var">$sql</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1191"></a>    <span class="src-var">$result_array </span>= <a href="http://www.php.net/pg_fetch_all">pg_fetch_all</a><span class="src-sym">(</span><span class="src-var">$result</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a1192"></a>    <span class="src-var">$username_db </span>= <span class="src-var">$result_array</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-str">'username'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1193"></a>&nbsp;</li>
<li><a name="a1194"></a>    <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$username_db</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a1195"></a>      print <span class="src-str">&quot;</span>&lt;<span class="src-id">P</span>&gt;<span class="src-id">Your administrator user account is</span> &lt;<span class="src-id">B</span>&gt;<span class="src-var">$username_db</span>&lt;/<span class="src-id">B</span>&gt;<span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1196"></a>      <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Back&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;radius&quot;</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Next&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;network&quot;</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a1197"></a>    <span class="src-sym">}</span></li>
<li><a name="a1198"></a>    <span class="src-key">else </span><span class="src-sym">{</span></li>
<li><a name="a1199"></a>      print&lt;&lt;&lt;EndHTML</li>
<li><a name="a1200"></a>        &lt;<span class="src-id">P</span>&gt;</li>
<li><a name="a1201"></a>        &lt;<span class="src-id">TABLE BORDER</span>=&quot;1&quot;&gt;</li>
<li><a name="a1202"></a>        &lt;<span class="src-id">TR</span>&gt;</li>
<li><a name="a1203"></a>          &lt;<span class="src-id">TD</span>&gt;<span class="src-id">Username</span>&lt;/<span class="src-id">TD</span>&gt;&lt;<span class="src-id">TD</span>&gt;&lt;<span class="src-id">INPUT type</span>=&quot;<span class="src-id">text</span>&quot; <span class="src-id">name</span>=&quot;<span class="src-id">username</span>&quot; <span class="src-id">value</span>=&quot;<span class="src-var">$username</span>&quot;&gt;&lt;/<span class="src-id">TD</span>&gt;</li>
<li><a name="a1204"></a>        &lt;/<span class="src-id">TR</span>&gt;</li>
<li><a name="a1205"></a>        &lt;<span class="src-id">TR</span>&gt;</li>
<li><a name="a1206"></a>          &lt;<span class="src-id">TD</span>&gt;<span class="src-id">Password</span>&lt;/<span class="src-id">TD</span>&gt;&lt;<span class="src-id">TD</span>&gt;&lt;<span class="src-id">INPUT type</span>=&quot;<span class="src-id">password</span>&quot; <span class="src-id">name</span>=&quot;<span class="src-id">password</span>&quot;&gt;&lt;/<span class="src-id">TD</span>&gt;</li>
<li><a name="a1207"></a>        &lt;/<span class="src-id">TR</span>&gt;</li>
<li><a name="a1208"></a>        &lt;<span class="src-id">TR</span>&gt;</li>
<li><a name="a1209"></a>          &lt;<span class="src-id">TD</span>&gt;<span class="src-id">Password again</span>&lt;/<span class="src-id">TD</span>&gt;&lt;<span class="src-id">TD</span>&gt;&lt;<span class="src-id">INPUT type</span>=&quot;<span class="src-id">password</span>&quot; <span class="src-id">name</span>=&quot;<span class="src-id">password2</span>&quot;&gt;&lt;/<span class="src-id">TD</span>&gt;</li>
<li><a name="a1210"></a>        &lt;/<span class="src-id">TR</span>&gt;</li>
<li><a name="a1211"></a>        &lt;<span class="src-id">TR</span>&gt;</li>
<li><a name="a1212"></a>          &lt;<span class="src-id">TD</span>&gt;<span class="src-id">Email</span>&lt;/<span class="src-id">TD</span>&gt;&lt;<span class="src-id">TD</span>&gt;&lt;<span class="src-id">INPUT type</span>=&quot;<span class="src-id">text</span>&quot; <span class="src-id">name</span>=&quot;<span class="src-id">email</span>&quot; <span class="src-id">value</span>=&quot;<span class="src-var">$email</span>&quot;&gt;&lt;/<span class="src-id">TD</span>&gt;</li>
<li><a name="a1213"></a>        &lt;/<span class="src-id">TR</span>&gt;</li>
<li><a name="a1214"></a>        &lt;/<span class="src-id">TABLE</span>&gt;</li>
<li><a name="a1215"></a>&nbsp;</li>
<li><a name="a1216"></a>        &lt;<span class="src-id">script type</span>=&quot;<span class="src-id">text</span>/<span class="src-id">javascript</span>&quot;&gt;</li>
<li><a name="a1217"></a>          <span class="src-id">function submitValue</span>() <span class="src-sym">{</span></li>
<li><a name="a1218"></a>            <span class="src-id">if</span> (<span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-id">password</span>.<span class="src-id">value</span> != <span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-id">password2</span>.<span class="src-id">value</span>) <span class="src-sym">{</span></li>
<li><a name="a1219"></a>              <span class="src-id">alert</span>('<span class="src-id">Password mismatch</span>, <span class="src-id">Please retry</span>');</li>
<li><a name="a1220"></a>              <span class="src-id">exit</span>();</li>
<li><a name="a1221"></a>            <span class="src-sym">}</span></li>
<li><a name="a1222"></a>            <span class="src-id">if</span> (<span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-id">password</span>.<span class="src-id">value</span> == '') <span class="src-sym">{</span></li>
<li><a name="a1223"></a>              <span class="src-id">alert</span>('<span class="src-id">You need to type a password</span>');</li>
<li><a name="a1224"></a>              <span class="src-id">exit</span>();</li>
<li><a name="a1225"></a>            <span class="src-sym">}</span></li>
<li><a name="a1226"></a>            <span class="src-id">if</span> (<span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-id">email</span>.<span class="src-id">value</span> == '') <span class="src-sym">{</span></li>
<li><a name="a1227"></a>              <span class="src-id">alert</span>('<span class="src-id">You need to type a email</span>');</li>
<li><a name="a1228"></a>              <span class="src-id">exit</span>();</li>
<li><a name="a1229"></a>            <span class="src-sym">}</span></li>
<li><a name="a1230"></a>            <span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-id">page</span>.<span class="src-id">value</span>='<span class="src-id">admin</span>';</li>
<li><a name="a1231"></a>            <span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-id">action</span>.<span class="src-id">value</span>='<span class="src-id">create</span>';</li>
<li><a name="a1232"></a>            <span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-id">submit</span>();</li>
<li><a name="a1233"></a>          <span class="src-sym">}</span></li>
<li><a name="a1234"></a>        &lt;/<span class="src-id">script</span>&gt;</li>
<li><a name="a1235"></a>&nbsp;</li>
<li><a name="a1236"></a>EndHTML<span class="src-sym">;    </span><a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Back&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;radius&quot;</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a1237"></a>    print <span class="src-str">&quot;&lt;P&gt;&lt;A HREF=\&quot;#\&quot; ONCLICK=\&quot;javascript: submitValue();\&quot; CLASS=\&quot;button\&quot;&gt;Next&lt;/A&gt;&lt;/P&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1238"></a>    <span class="src-sym">}</span></li>
<li><a name="a1239"></a>  <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1240"></a>&nbsp;</li>
<li><a name="a1241"></a>  <span class="src-comm">###################################</span></li>
<li><a name="a1242"></a>    <span class="src-key">case </span><span class="src-str">'network'</span>:</li>
<li><a name="a1243"></a>    print <span class="src-str">&quot;&lt;H1&gt;Network&lt;/H1&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1244"></a>&nbsp;</li>
<li><a name="a1245"></a>    <span class="src-comm">//$HOTSPOT_NETWORK_NAME          = $configArray['HOTSPOT_NETWORK_NAME'];</span></li>
<li><a name="a1246"></a>    <span class="src-comm">//$HOTSPOT_NETWORK_URL           = $configArray['HOTSPOT_NETWORK_URL'];</span></li>
<li><a name="a1247"></a>    <span class="src-comm">//$TECH_SUPPORT_EMAIL            = $configArray['TECH_SUPPORT_EMAIL'];</span></li>
<li><a name="a1248"></a>    <span class="src-comm">//$VALIDATION_GRACE_TIME         = $configArray['VALIDATION_GRACE_TIME'];</span></li>
<li><a name="a1249"></a>    <span class="src-comm">//$VALIDATION_EMAIL_FROM_ADDRESS = $configArray['VALIDATION_EMAIL_FROM_ADDRESS'];</span></li>
<li><a name="a1250"></a>&nbsp;</li>
<li><a name="a1250"></a>    </li>
<li><a name="a1251"></a>    print &lt;&lt;&lt; EndHTML</li>
<li><a name="a1252"></a>  &lt;<span class="src-id">P</span>&gt;</li>
<li><a name="a1253"></a>  &lt;<span class="src-id">TABLE border</span>=&quot;1&quot;&gt;</li>
<li><a name="a1254"></a>  &lt;<span class="src-id">TR</span>&gt;</li>
<li><a name="a1255"></a>    &lt;<span class="src-id">TD</span>&gt;<span class="src-id">Network Name</span>&lt;/<span class="src-id">TD</span>&gt;&lt;<span class="src-id">TD</span>&gt;&lt;<span class="src-id">INPUT type</span>=&quot;<span class="src-id">text</span>&quot; <span class="src-id">name</span>=&quot;<span class="src-id">HOTSPOT_NETWORK_NAME</span>&quot; <span class="src-id">value</span>=&quot;<span class="src-var">$HOTSPOT_NETWORK_NAME</span>&quot; <span class="src-id">size</span>=&quot;30&quot;&gt;&lt;/<span class="src-id">TD</span>&gt;</li>
<li><a name="a1256"></a>  &lt;/<span class="src-id">TR</span>&gt;</li>
<li><a name="a1257"></a>  &lt;<span class="src-id">TR</span>&gt;</li>
<li><a name="a1258"></a>    &lt;<span class="src-id">TD</span>&gt;<span class="src-id">Network URL</span>&lt;/<span class="src-id">TD</span>&gt;&lt;<span class="src-id">TD</span>&gt;&lt;<span class="src-id">INPUT type</span>=&quot;<span class="src-id">text</span>&quot; <span class="src-id">name</span>=&quot;<span class="src-id">HOTSPOT_NETWORK_URL</span>&quot; <span class="src-id">value</span>=&quot;<span class="src-var">$HOTSPOT_NETWORK_URL</span>&quot; <span class="src-id">size</span>=&quot;30&quot;&gt;&lt;/<span class="src-id">TD</span>&gt;</li>
<li><a name="a1259"></a>  &lt;/<span class="src-id">TR</span>&gt;</li>
<li><a name="a1260"></a>  &lt;<span class="src-id">TR</span>&gt;</li>
<li><a name="a1261"></a>    &lt;<span class="src-id">TD</span>&gt;<span class="src-id">Tech Support Email</span>&lt;/<span class="src-id">TD</span>&gt;&lt;<span class="src-id">TD</span>&gt;&lt;<span class="src-id">INPUT type</span>=&quot;<span class="src-id">text</span>&quot; <span class="src-id">name</span>=&quot;<span class="src-id">TECH_SUPPORT_EMAIL</span>&quot; <span class="src-id">value</span>=&quot;<span class="src-var">$TECH_SUPPORT_EMAIL</span>&quot; <span class="src-id">size</span>=&quot;30&quot;&gt;&lt;/<span class="src-id">TD</span>&gt;</li>
<li><a name="a1262"></a>  &lt;/<span class="src-id">TR</span>&gt;</li>
<li><a name="a1263"></a>  &lt;<span class="src-id">TR</span>&gt;</li>
<li><a name="a1264"></a>    &lt;<span class="src-id">TD</span>&gt;<span class="src-id">Validation Grace Time</span> (<span class="src-id">min</span>)&lt;/<span class="src-id">TD</span>&gt;&lt;<span class="src-id">TD</span>&gt;&lt;<span class="src-id">INPUT type</span>=&quot;<span class="src-id">text</span>&quot; <span class="src-id">name</span>=&quot;<span class="src-id">VALIDATION_GRACE_TIME</span>&quot; <span class="src-id">value</span>=&quot;<span class="src-var">$VALIDATION_GRACE_TIME</span>&quot; <span class="src-id">size</span>=&quot;30&quot;&gt;&lt;/<span class="src-id">TD</span>&gt;</li>
<li><a name="a1265"></a>  &lt;/<span class="src-id">TR</span>&gt;</li>
<li><a name="a1266"></a>  &lt;<span class="src-id">TR</span>&gt;</li>
<li><a name="a1267"></a>    &lt;<span class="src-id">TD</span>&gt;<span class="src-id">Validation Email</span> (<span class="src-id">send from</span>)&lt;/<span class="src-id">TD</span>&gt;&lt;<span class="src-id">TD</span>&gt;&lt;<span class="src-id">INPUT type</span>=&quot;<span class="src-id">text</span>&quot; <span class="src-id">name</span>=&quot;<span class="src-id">VALIDATION_EMAIL_FROM_ADDRESS</span>&quot; <span class="src-id">value</span>=&quot;<span class="src-var">$VALIDATION_EMAIL_FROM_ADDRESS</span>&quot; <span class="src-id">size</span>=&quot;30&quot;&gt;&lt;/<span class="src-id">TD</span>&gt;</li>
<li><a name="a1268"></a>  &lt;/<span class="src-id">TR</span>&gt;</li>
<li><a name="a1269"></a>  &lt;/<span class="src-id">TABLE</span>&gt;</li>
<li><a name="a1270"></a>&nbsp;</li>
<li><a name="a1271"></a>&lt;<span class="src-id">script type</span>=&quot;<span class="src-id">text</span>/<span class="src-id">javascript</span>&quot;&gt;</li>
<li><a name="a1272"></a>  <span class="src-id">function submitOptionsValue</span>() <span class="src-sym">{</span></li>
<li><a name="a1273"></a>    //<span class="src-id">newConfig</span>(&quot;<span class="src-id">HOTSPOT_NETWORK_NAME</span>='&quot; + <span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-id">HOTSPOT_NETWORK_NAME</span>.<span class="src-id">value</span> + &quot;'&quot;);</li>
<li><a name="a1274"></a>    //<span class="src-id">newConfig</span>(&quot;<span class="src-id">HOTSPOT_NETWORK_URL</span>='&quot; + <span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-id">HOTSPOT_NETWORK_URL</span>.<span class="src-id">value</span> + &quot;'&quot;);</li>
<li><a name="a1275"></a>    //<span class="src-id">newConfig</span>(&quot;<span class="src-id">TECH_SUPPORT_EMAIL</span>='&quot; + <span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-id">TECH_SUPPORT_EMAIL</span>.<span class="src-id">value</span> + &quot;'&quot;);</li>
<li><a name="a1276"></a>    //<span class="src-id">newConfig</span>(&quot;<span class="src-id">VALIDATION_GRACE_TIME</span>=&quot; + <span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-id">VALIDATION_GRACE_TIME</span>.<span class="src-id">value</span>);</li>
<li><a name="a1277"></a>    //<span class="src-id">newConfig</span>(&quot;<span class="src-id">VALIDATION_EMAIL_FROM_ADDRESS</span>='&quot; + <span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-id">VALIDATION_EMAIL_FROM_ADDRESS</span>.<span class="src-id">value</span> + &quot;'&quot;);</li>
<li><a name="a1278"></a>  <span class="src-sym">}</span></li>
<li><a name="a1279"></a>&lt;/<span class="src-id">script</span>&gt;</li>
<li><a name="a1280"></a>&nbsp;</li>
<li><a name="a1281"></a>    &lt;<span class="src-id">P</span>&gt;&lt;<span class="src-id">B</span>&gt;<span class="src-id">Note</span>&lt;/<span class="src-id">B</span>&gt;: <span class="src-id">One Wifidog Authentification Server instance will support many network soon</span>. <span class="src-id">Waiting for new Network implementation</span>/<span class="src-id">abstraction to become more sophisticated</span>.</li>
<li><a name="a1282"></a>&nbsp;</li>
<li><a name="a1283"></a>EndHTML<span class="src-sym">;    </span><a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Back&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;admin&quot;</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a1284"></a>&nbsp;</li>
<li><a name="a1285"></a>    print &lt;&lt;&lt; EndHTML</li>
<li><a name="a1286"></a>&lt;<span class="src-id">P</span>&gt;&lt;<span class="src-id">A HREF</span>=&quot;#&quot; <span class="src-id">ONCLICK</span>=&quot;<span class="src-id">javascript</span>: <span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-id">page</span>.<span class="src-id">value</span>='<span class="src-id">hotspot</span>'; <span class="src-id">submitOptionsValue</span>(); <span class="src-id">document</span>.<span class="src-id">myform</span>.<span class="src-id">submit</span>();&quot; <span class="src-id">CLASS</span>=&quot;<span class="src-id">button</span>&quot;&gt;<span class="src-id">Next</span>&lt;/<span class="src-id">A</span>&gt;&lt;/<span class="src-id">P</span>&gt;</li>
<li><a name="a1287"></a>EndHTML<span class="src-sym">;    </span><span class="src-comm">#navigation(array(array(&quot;title&quot; =&gt; &quot;Back&quot;, &quot;page&quot; =&gt; &quot;admin&quot;), array(&quot;title&quot; =&gt; &quot;Next&quot;, &quot;page&quot; =&gt; &quot;hotspot&quot;)));</span></li>
<li><a name="a1288"></a>    <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1289"></a>&nbsp;</li>
<li><a name="a1290"></a>  <span class="src-comm">###################################</span></li>
<li><a name="a1291"></a>    <span class="src-key">case </span><span class="src-str">'hotspot'</span>:</li>
<li><a name="a1292"></a>    print <span class="src-str">&quot;&lt;H1&gt;Hotspot&lt;/H1&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1293"></a>    print <span class="src-str">&quot;&lt;P&gt;Not yet implemented and maybe not needed&lt;P&gt;Default hotstop already created&lt;P&gt;Use administration interface to add new one&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1294"></a>    <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Back&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;network&quot;</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Next&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;end&quot;</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a1295"></a>  <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1296"></a>&nbsp;</li>
<li><a name="a1297"></a>  <span class="src-comm">###################################</span></li>
<li><a name="a1298"></a>    <span class="src-key">case </span><span class="src-str">'delete'</span>:</li>
<li><a name="a1299"></a>    print&lt;&lt;&lt;EndHTML</li>
<li><a name="a1300"></a>  &lt;<span class="src-id">H1</span>&gt;<span class="src-id">Delete temporary files</span>&lt;/<span class="src-id">H1</span>&gt;</li>
<li><a name="a1301"></a>  ...</li>
<li><a name="a1302"></a>EndHTML<span class="src-sym">;    </span><span class="src-comm">#navigation(array(array(&quot;title&quot; =&gt; &quot;Back&quot;, &quot;page&quot; =&gt; &quot;hotspot&quot;)));</span></li>
<li><a name="a1303"></a>    <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1304"></a>&nbsp;</li>
<li><a name="a1305"></a>  <span class="src-comm">###################################</span></li>
<li><a name="a1306"></a>    <span class="src-key">case </span><span class="src-str">'end'</span>:</li>
<li><a name="a1307"></a>    <span class="src-var">$url </span>= <span class="src-str">'http://' </span>. <span class="src-var">$_SERVER</span><span class="src-sym">[</span><span class="src-str">'HTTP_HOST'</span><span class="src-sym">] </span>. <span class="src-var">$system_path</span><span class="src-sym">;</span></li>
<li><a name="a1308"></a>    print&lt;&lt;&lt;EndHTML</li>
<li><a name="a1309"></a>  &lt;<span class="src-id">H1</span>&gt;<span class="src-id">Thanks for using Wifidog</span>&lt;/<span class="src-id">H1</span>&gt;</li>
<li><a name="a1310"></a>  <span class="src-id">Redirection to your new Wifidog Authentification Server in few secondes</span></li>
<li><a name="a1311"></a>  &lt;<span class="src-id">meta http</span>-<span class="src-id">equiv</span>=&quot;<span class="src-id">REFRESH</span>&quot; <span class="src-id">content</span>=&quot;3;<span class="src-id">url</span>=<span class="src-var">$url</span>&quot;&gt;</li>
<li><a name="a1312"></a>  &lt;<span class="src-id">PRE</span>&gt;</li>
<li><a name="a1313"></a>&nbsp;</li>
<li><a name="a1314"></a>               |\   /|              <span class="src-id">_</span></li>
<li><a name="a1315"></a>               |<span class="src-id">A</span>\_/<span class="src-id">A</span>|            <span class="src-id">z   z</span></li>
<li><a name="a1316"></a>            <span class="src-id">___</span>|     |           ( (<span class="src-id">o</span>) )</li>
<li><a name="a1317"></a>           <span class="src-id">o    </span>6     \           <span class="src-id">z _ z</span></li>
<li><a name="a1318"></a>           |<span class="src-id">___        </span>\           /|</li>
<li><a name="a1319"></a>               |        \         / |</li>
<li><a name="a1320"></a>                \        \_<span class="src-id">______</span>/  |</li>
<li><a name="a1321"></a>                |                   |</li>
<li><a name="a1322"></a>                |      <span class="src-id">WIFIDOG</span>      |</li>
<li><a name="a1323"></a>                |   <span class="src-id">Captive Portal</span>  |</li>
<li><a name="a1324"></a>                |   <span class="src-id">_____________</span>   |</li>
<li><a name="a1325"></a>                |  /             \  |</li>
<li><a name="a1326"></a>                |  |             |  |</li>
<li><a name="a1327"></a>                |  |             |  |</li>
<li><a name="a1328"></a>              <span class="src-id">_</span>/   |           <span class="src-id">_</span>/   |</li>
<li><a name="a1329"></a>             ?<span class="src-id">_____</span>|          ?<span class="src-id">_____</span>|</li>
<li><a name="a1330"></a>&lt;/<span class="src-id">PRE</span>&gt;</li>
<li><a name="a1331"></a>EndHTML<span class="src-sym">;    </span><span class="src-comm">#navigation(array(array(&quot;title&quot; =&gt; &quot;Back&quot;, &quot;page&quot; =&gt; &quot;hotspot&quot;)));</span></li>
<li><a name="a1332"></a>    <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1333"></a>&nbsp;</li>
<li><a name="a1334"></a>  <span class="src-comm">###################################</span></li>
<li><a name="a1335"></a>    <span class="src-key">case </span><span class="src-str">'toc'</span>:</li>
<li><a name="a1336"></a>    print <span class="src-str">&quot;&lt;H1&gt;Table of content&lt;/H1&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1337"></a>    <span class="src-var">$contentArray </span>= <a href="http://www.php.net/file">file</a><span class="src-sym">(</span>__file__<span class="src-sym">)</span><span class="src-sym">; </span><span class="src-comm"># Read myself</span></li>
<li><a name="a1338"></a>        print <span class="src-str">&quot;&lt;UL&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1339"></a>    <span class="src-key">foreach</span><span class="src-sym">(</span><span class="src-var">$contentArray </span><span class="src-key">as </span><span class="src-var">$line</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a1340"></a>      <span class="src-key">if</span><span class="src-sym">(</span><a href="http://www.php.net/preg_match">preg_match</a><span class="src-sym">(</span><span class="src-str">&quot;/^  case '(\w+)':/&quot;</span><span class="src-sym">, </span><span class="src-var">$line</span><span class="src-sym">, </span><span class="src-var">$matchesArray</span><span class="src-sym">)) </span><span class="src-sym">{ </span><span class="src-comm"># Parse for &quot;case&quot; regex</span></li>
<li><a name="a1341"></a>                <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$matchesArray</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">] </span>== <span class="src-str">'toc'</span><span class="src-sym">)</span></li>
<li><a name="a1342"></a>          <span class="src-key">continue</span><span class="src-sym">;</span></li>
<li><a name="a1343"></a>        print <span class="src-str">&quot;&lt;LI&gt;&lt;A HREF=\&quot;&quot; </span>. <span class="src-var">$_SERVER</span><span class="src-sym">[</span><span class="src-str">'SCRIPT_NAME'</span><span class="src-sym">] </span>. <span class="src-str">&quot;?page=&quot; </span>. <span class="src-var">$matchesArray</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">] </span>. <span class="src-str">&quot;\&quot;&gt;&quot; </span>. <span class="src-var">$matchesArray</span><span class="src-sym">[</span><span class="src-num">1</span><span class="src-sym">] </span>. <span class="src-str">&quot;&lt;/A&gt;\n&quot;</span><span class="src-sym">;  </span><span class="src-comm"># Display a Table of Content</span></li>
<li><a name="a1344"></a>            <span class="src-sym">}</span></li>
<li><a name="a1345"></a>    <span class="src-sym">}</span></li>
<li><a name="a1346"></a>    print <span class="src-str">&quot;&lt;/UL&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a1347"></a>  <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1348"></a>  <span class="src-comm">###################################</span></li>
<li><a name="a1349"></a>    <span class="src-key">case </span><span class="src-str">'notes'</span>:</li>
<li><a name="a1350"></a>    print &lt;&lt;&lt;EndHTML</li>
<li><a name="a1351"></a>&lt;!-- /* <span class="src-id">Editor highlighting trick</span> --&gt;</li>
<li><a name="a1352"></a>&lt;<span class="src-id">PRE</span>&gt;</li>
<li><a name="a1353"></a>&lt;<span class="src-id">B</span>&gt;<span class="src-id">TODO</span>&lt;/<span class="src-id">B</span>&gt;</li>
<li><a name="a1354"></a>  -<span class="src-id">Support des define de Google Maps dans config</span>.<span class="src-id">php</span></li>
<li><a name="a1355"></a>  -<span class="src-id">Faire une fonction d</span>'<span class="src-id">execution avec gestion de retour d</span>'<span class="src-id">erreur et d</span>'<span class="src-id">affichage de l</span>'<span class="src-id">exection pour chaque </span>&quot;<span class="src-id">exec</span>&quot;</li>
<li><a name="a1356"></a>  -<span class="src-id">Ajouter une veritable validation</span> (<span class="src-id">user</span>/<span class="src-id">password admin provenant de la DB</span>)</li>
<li><a name="a1357"></a>     <span class="src-id">Pour une meilleur securite du script d</span>'<span class="src-id">installation</span>.</li>
<li><a name="a1358"></a>       <span class="src-id">Au chargement</span>, <span class="src-id">valider que la connection DB est fonctionnel</span>, <span class="src-id">que la DB existe et que l</span>'<span class="src-id">usager admin existe</span></li>
<li><a name="a1359"></a>         <span class="src-id">Si oui</span>, <span class="src-id">on demande l</span>'<span class="src-id">authentification</span></li>
<li><a name="a1360"></a>         <span class="src-id">Si non</span>, <span class="src-id">on creer l</span>'<span class="src-id">usager admin</span></li>
<li><a name="a1361"></a>  -<span class="src-id">Faire un vrai menu pour acceder directement aux pages desirees</span> (<span class="src-id">pas une TOC poche</span>)</li>
<li><a name="a1362"></a>  -<span class="src-id">Ameliorer le javascript et arreter de faire des document</span>.<span class="src-id">myform</span>.<span class="src-id">submit</span>();</li>
<li><a name="a1363"></a>  -<span class="src-id">Generate valid HTML code</span></li>
<li><a name="a1364"></a>  -<span class="src-id">Integrate this script with the portal skin</span></li>
<li><a name="a1365"></a>  -<span class="src-id">Tester que les donnees de AVAIL_LOCALE_ARRAY dans config</span>.<span class="src-id">php sont valides</span> (<span class="src-id">fonctionnelles</span>)</li>
<li><a name="a1366"></a>     <span class="src-id">Regarder le code dans include</span>/<span class="src-id">language</span>.<span class="src-id">php</span></li>
<li><a name="a1367"></a>  -<span class="src-id">Support pour l</span>'<span class="src-id">option CUSTOM_SIGNUP_URL</span></li>
<li><a name="a1368"></a>  -<span class="src-id">Effacer repertoires</span>/<span class="src-id">fichiers temporaires des installations</span></li>
<li><a name="a1369"></a>&nbsp;</li>
<li><a name="a1370"></a>  -<span class="src-id">Nice2Have</span> : <span class="src-id">Si test d</span>'<span class="src-id">integrite et de fonctionnement existent</span>, <span class="src-id">les integrer pour assurer le bon fonctionnement</span></li>
<li><a name="a1371"></a>  -<span class="src-id">Nice2Have</span> : <span class="src-id">Si donnees de tests exitent</span> (<span class="src-id">pour les developpeurs</span>) <span class="src-id">Permettre d</span>'<span class="src-id">en ajouter a la DB</span></li>
<li><a name="a1372"></a>  -<span class="src-id">Nice2Have</span> : <span class="src-id">Creer un wifidog</span>.<span class="src-id">conf</span> (<span class="src-id">client</span>) <span class="src-id">selon config</span> + <span class="src-id">questions si necessaires</span></li>
<li><a name="a1373"></a>&nbsp;</li>
<li><a name="a1374"></a>&lt;<span class="src-id">B</span>&gt;<span class="src-id">Change Log</span>&lt;/<span class="src-id">B</span>&gt;</li>
<li><a name="a1375"></a>  15-08-2005 : <span class="src-id">Bugs correction</span> + <span class="src-id">comments added</span></li>
<li><a name="a1376"></a>  11-08-2005 : <span class="src-id">Options rewrite with foreach and dependencies</span></li>
<li><a name="a1377"></a>  09-08-2005 : <span class="src-id">Admin user creation</span> + <span class="src-id">network configuration</span></li>
<li><a name="a1378"></a>  27-07-2005 : <span class="src-id">Added jpgraph install</span></li>
<li><a name="a1379"></a>  26-07-2005 : <span class="src-id">Added minimal security password validation</span></li>
<li><a name="a1380"></a>  14-07-2005 : <span class="src-id">saveConfig and all javascript code</span></li>
<li><a name="a1381"></a>  09-07-2005 : <span class="src-id">Added Phlickr installation</span></li>
<li><a name="a1382"></a>  05-07-2005 : <span class="src-id">Better PHP extention validation process</span></li>
<li><a name="a1383"></a>  17-06-2005 : <span class="src-id">MySQL schema and data submission</span></li>
<li><a name="a1384"></a>  17-06-2005 : <span class="src-id">Postgresql schema and data submission</span></li>
<li><a name="a1385"></a>  24-04-2005 : <span class="src-id">CSS button</span></li>
<li><a name="a1386"></a>&nbsp;</li>
<li><a name="a1387"></a>&lt;/<span class="src-id">PRE</span>&gt;</li>
<li><a name="a1388"></a>&lt;!-- <span class="src-id">Editor highlighting trick</span> */ --&gt;</li>
<li><a name="a1389"></a>EndHTML<span class="src-sym">;  </span><span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a1390"></a>  <span class="src-comm">###################################</span></li>
<li><a name="a1391"></a><span class="src-comm">/*  case 'phpinfo': // Use for debugging, to be removed</span></li>
<li><a name="a1392"></a><span class="src-comm">    print &quot;&lt;PRE&gt;&quot;;</span></li>
<li><a name="a1393"></a><span class="src-comm">    print_r(get_loaded_extensions());</span></li>
<li><a name="a1394"></a><span class="src-comm">    print &quot;&lt;/PRE&gt;&lt;BR&gt;&lt;BR&gt;&quot;;</span></li>
<li><a name="a1395"></a><span class="src-comm">    phpinfo();</span></li>
<li><a name="a1396"></a><span class="src-comm">  break;*/</span></li>
<li><a name="a1397"></a>&nbsp;</li>
<li><a name="a1398"></a>  <span class="src-key">default</span>:</li>
<li><a name="a1399"></a>    <span class="src-var">$WIFIDOG_VERSION </span>= <span class="src-var">$configArray</span><span class="src-sym">[</span><span class="src-str">'WIFIDOG_VERSION'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a1400"></a>    <span class="src-comm"># TODO : Add links to auth-server web documents</span></li>
<li><a name="a1401"></a>        print &lt;&lt;&lt;EndHTML</li>
<li><a name="a1402"></a>&lt;<span class="src-id">P</span>&gt;<span class="src-id">Welcome to Wifidog Auth</span>-<span class="src-id">Server installation and configuration script</span>.&lt;/<span class="src-id">P</span>&gt;</li>
<li><a name="a1403"></a>&lt;<span class="src-id">P</span>&gt;<span class="src-id">This is a work in progress</span>, <span class="src-id">so please report bugs to the mailing list for better support</span>.</li>
<li><a name="a1404"></a><span class="src-id">Many work needed to be done</span> : <span class="src-id">validation</span>, <span class="src-id">error handling</span>, <span class="src-id">integration</span>, <span class="src-id">security</span>, <span class="src-id">etc</span>.</li>
<li><a name="a1405"></a><span class="src-id">The current auth</span>-<span class="src-id">server version is</span> &lt;<span class="src-id">B</span>&gt;<span class="src-var">$WIFIDOG_VERSION</span>&lt;/<span class="src-id">B</span>&gt;. <span class="src-id">The installation is only available in english</span>.&lt;/<span class="src-id">P</span>&gt;</li>
<li><a name="a1406"></a>&nbsp;</li>
<li><a name="a1407"></a>&lt;<span class="src-id">P</span>&gt;<span class="src-id">Before going further with this installation you need to have</span>/<span class="src-id">create a valid user and database</span>.</li>
<li><a name="a1408"></a>&lt;<span class="src-id">P</span>&gt;<span class="src-id">Here is a command line example for PostgreSQL</span> (<span class="src-id">or use the way you like</span>) :&lt;/<span class="src-id">P</span>&gt;</li>
<li><a name="a1409"></a>&nbsp;</li>
<li><a name="a1410"></a>&lt;<span class="src-id">B</span>&gt;<span class="src-id">Create the wifidog DB user</span>&lt;/<span class="src-id">B</span>&gt; (<span class="src-id">createuser and createdb need to be in you PATH</span>) :</li>
<li><a name="a1411"></a>&lt;<span class="src-id">PRE</span>&gt;  &lt;<span class="src-id">I</span>&gt;<span class="src-id">postgres</span>@<span class="src-id">yourserver </span>$&gt;&lt;/<span class="src-id">I</span>&gt; <span class="src-id">createuser wifidog</span> --<span class="src-id">pwprompt</span></li>
<li><a name="a1412"></a>  <span class="src-id">Enter password for new user</span>:</li>
<li><a name="a1413"></a>  <span class="src-id">Enter it again</span>:</li>
<li><a name="a1414"></a>  <span class="src-id">Shall the new user be allowed to create databases</span>? (<span class="src-id">y</span>/<span class="src-id">n</span>) <span class="src-id">n</span></li>
<li><a name="a1415"></a>  <span class="src-id">Shall the new user be allowed to create more new users</span>? (<span class="src-id">y</span>/<span class="src-id">n</span>) <span class="src-id">n</span></li>
<li><a name="a1416"></a>  <span class="src-id">CREATE USER</span></li>
<li><a name="a1417"></a>&lt;/<span class="src-id">PRE</span>&gt;</li>
<li><a name="a1418"></a>&nbsp;</li>
<li><a name="a1419"></a>&lt;<span class="src-id">B</span>&gt;<span class="src-id">Create the wifidog database</span>&lt;/<span class="src-id">B</span>&gt;</li>
<li><a name="a1420"></a>&lt;<span class="src-id">PRE</span>&gt;  &lt;<span class="src-id">I</span>&gt;<span class="src-id">postgres</span>@<span class="src-id">yourserver </span>$&gt;&lt;/<span class="src-id">I</span>&gt; <span class="src-id">createdb wifidog</span> --<span class="src-id">encoding</span>=<span class="src-id">UTF</span>-8 --<span class="src-id">owner</span>=<span class="src-id">wifidog</span></li>
<li><a name="a1421"></a>  <span class="src-id">CREATE DATABASE</span></li>
<li><a name="a1422"></a>&lt;/<span class="src-id">PRE</span>&gt;</li>
<li><a name="a1423"></a>&nbsp;</li>
<li><a name="a1424"></a>&lt;<span class="src-id">B</span>&gt;<span class="src-id">Security</span>&lt;/<span class="src-id">B</span>&gt; : <span class="src-id">For now</span>, <span class="src-id">a really simple password protection is in place</span>. <span class="src-id">To find the password type this in command line</span> :&lt;<span class="src-id">PRE</span>&gt;  &lt;<span class="src-id">B</span>&gt;<span class="src-id">ls</span> -<span class="src-id">ld </span><span class="src-var">$basepath</span> | <span class="src-id">awk</span> '<span class="src-sym">{</span><span class="src-id">print </span>\$6\$7\$8<span class="src-sym">}</span>'&lt;/<span class="src-id">B</span>&gt;</li>
<li><a name="a1425"></a>&nbsp;</li>
<li><a name="a1426"></a>  (<span class="src-id">No username needed</span>)</li>
<li><a name="a1427"></a>&lt;/<span class="src-id">PRE</span>&gt;</li>
<li><a name="a1428"></a>&nbsp;</li>
<li><a name="a1429"></a>&lt;<span class="src-id">P</span>&gt;<span class="src-id">When you are ready click next</span>&lt;/<span class="src-id">P</span>&gt;</li>
<li><a name="a1430"></a>&nbsp;</li>
<li><a name="a1431"></a>EndHTML<span class="src-sym">;</span></li>
<li><a name="a1432"></a>    <a href="../WiFiDogAuthServer/_wifidog_install_php.html#functionnavigation">navigation</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">&quot;title&quot; </span>=&gt; <span class="src-str">&quot;Next&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;page&quot; </span>=&gt; <span class="src-str">&quot;version&quot;</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a1433"></a><span class="src-sym">}</span></li>
<li><a name="a1434"></a>&nbsp;</li>
<li><a name="a1435"></a>&nbsp;</li>
<li><a name="a1436"></a><span class="src-php">?&gt;</span></li>
<li><a name="a1437"></a>&nbsp;</li>
<li><a name="a1438"></a>&lt;/form&gt;</li>
<li><a name="a1439"></a>&lt;/body&gt;</li>
<li><a name="a1440"></a>&lt;/html&gt;</li>
</ol></pre>
</div>
	<p class="notes" id="credit">
		Documentation generated on Mon, 26 Dec 2005 19:16:56 +0100 by <a href="http://www.phpdoc.org" target="_blank">phpDocumentor 1.3.0RC5</a>
	</p>
	</body>
</html>
