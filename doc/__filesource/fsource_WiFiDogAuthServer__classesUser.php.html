<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
  <html xmlns="http://www.w3.org/1999/xhtml">
		<head>
			<!-- template designed by Marco Von Ballmoos -->
			<title>File Source for User.php</title>
			<link rel="stylesheet" href="../media/stylesheet.css" />
			<meta http-equiv='Content-Type' content='text/html; charset=iso-8859-1'/>
		</head>
		<body>
						
<h1>Source for file User.php</h1>
<p>Documentation is available at <a href="../WiFiDogAuthServer/_wifidog_classes_User_php.html">User.php</a></p>
<div class="src-code">
<pre><ol><li><a name="a1"></a><span class="src-php">&lt;?php</span></li>
<li><a name="a2"></a>&nbsp;</li>
<li><a name="a4"></a><span class="src-comm">/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */</span></li>
<li><a name="a5"></a><span class="src-comm">// +-------------------------------------------------------------------+</span></li>
<li><a name="a6"></a><span class="src-comm">// | WiFiDog Authentication Server                                     |</span></li>
<li><a name="a7"></a><span class="src-comm">// | =============================                                     |</span></li>
<li><a name="a8"></a><span class="src-comm">// |                                                                   |</span></li>
<li><a name="a9"></a><span class="src-comm">// | The WiFiDog Authentication Server is part of the WiFiDog captive  |</span></li>
<li><a name="a10"></a><span class="src-comm">// | portal suite.                                                     |</span></li>
<li><a name="a11"></a><span class="src-comm">// +-------------------------------------------------------------------+</span></li>
<li><a name="a12"></a><span class="src-comm">// | PHP version 5 required.                                           |</span></li>
<li><a name="a13"></a><span class="src-comm">// +-------------------------------------------------------------------+</span></li>
<li><a name="a14"></a><span class="src-comm">// | Homepage:     http://www.wifidog.org/                             |</span></li>
<li><a name="a15"></a><span class="src-comm">// | Source Forge: http://sourceforge.net/projects/wifidog/            |</span></li>
<li><a name="a16"></a><span class="src-comm">// +-------------------------------------------------------------------+</span></li>
<li><a name="a17"></a><span class="src-comm">// | This program is free software; you can redistribute it and/or     |</span></li>
<li><a name="a18"></a><span class="src-comm">// | modify it under the terms of the GNU General Public License as    |</span></li>
<li><a name="a19"></a><span class="src-comm">// | published by the Free Software Foundation; either version 2 of    |</span></li>
<li><a name="a20"></a><span class="src-comm">// | the License, or (at your option) any later version.               |</span></li>
<li><a name="a21"></a><span class="src-comm">// |                                                                   |</span></li>
<li><a name="a22"></a><span class="src-comm">// | This program is distributed in the hope that it will be useful,   |</span></li>
<li><a name="a23"></a><span class="src-comm">// | but WITHOUT ANY WARRANTY; without even the implied warranty of    |</span></li>
<li><a name="a24"></a><span class="src-comm">// | MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the     |</span></li>
<li><a name="a25"></a><span class="src-comm">// | GNU General Public License for more details.                      |</span></li>
<li><a name="a26"></a><span class="src-comm">// |                                                                   |</span></li>
<li><a name="a27"></a><span class="src-comm">// | You should have received a copy of the GNU General Public License |</span></li>
<li><a name="a28"></a><span class="src-comm">// | along with this program; if not, contact:                         |</span></li>
<li><a name="a29"></a><span class="src-comm">// |                                                                   |</span></li>
<li><a name="a30"></a><span class="src-comm">// | Free Software Foundation           Voice:  +1-617-542-5942        |</span></li>
<li><a name="a31"></a><span class="src-comm">// | 59 Temple Place - Suite 330        Fax:    +1-617-542-2652        |</span></li>
<li><a name="a32"></a><span class="src-comm">// | Boston, MA  02111-1307,  USA       gnu@gnu.org                    |</span></li>
<li><a name="a33"></a><span class="src-comm">// |                                                                   |</span></li>
<li><a name="a34"></a><span class="src-comm">// +-------------------------------------------------------------------+</span></li>
<li><a name="a35"></a>&nbsp;</li>
<li><a name="a36"></a><span class="src-doc">/**</span></li>
<li><a name="a37"></a><span class="src-doc"> * </span><span class="src-doc-coretag">@package</span><span class="src-doc">    WiFiDogAuthServer</span></li>
<li><a name="a38"></a><span class="src-doc"> * </span><span class="src-doc-coretag">@author</span><span class="src-doc">     Benoit Gregoire &lt;bock@step.polymtl.ca&gt;</span></li>
<li><a name="a39"></a><span class="src-doc"> * </span><span class="src-doc-coretag">@copyright</span><span class="src-doc">  2005 Benoit Gregoire &lt;bock@step.polymtl.ca&gt; - Technologies Coeus</span></li>
<li><a name="a40"></a><span class="src-doc"> *  inc.</span></li>
<li><a name="a41"></a><span class="src-doc"> * </span><span class="src-doc-coretag">@version</span><span class="src-doc">    CVS: $Id: User.php,v 1.39 2005/12/26 10:41:29 max-horvath Exp $</span></li>
<li><a name="a42"></a><span class="src-doc"> * </span><span class="src-doc-coretag">@link</span><span class="src-doc">       http://sourceforge.net/projects/wifidog/</span></li>
<li><a name="a43"></a><span class="src-doc"> */</span></li>
<li><a name="a44"></a>&nbsp;</li>
<li><a name="a45"></a><span class="src-inc">require_once </span><span class="src-id">BASEPATH</span>.<span class="src-str">'include/common.php'</span><span class="src-sym">;</span></li>
<li><a name="a46"></a><span class="src-inc">require_once </span><span class="src-id">BASEPATH</span>.<span class="src-str">'classes/Network.php'</span><span class="src-sym">;</span></li>
<li><a name="a47"></a><span class="src-inc">require_once </span><span class="src-id">BASEPATH</span>.<span class="src-str">'classes/Mail.php'</span><span class="src-sym">;</span></li>
<li><a name="a48"></a>&nbsp;</li>
<li><a name="a49"></a><span class="src-doc">/** Abstract a User. */</span></li>
<li><a name="a49"></a>&nbsp;</li>
<li><a name="a50"></a><span class="src-key">class </span><a href="../WiFiDogAuthServer/User.html">User</a> <span class="src-key">implements </span><span class="src-id">GenericObject</span></li>
<li><a name="a51"></a><span class="src-sym">{</span></li>
<li><a name="a52"></a>    <span class="src-key">private </span><a href="../WiFiDogAuthServer/User.html#var$mRow">$mRow</a><span class="src-sym">;</span></li>
<li><a name="a53"></a>    <span class="src-key">private </span><a href="../WiFiDogAuthServer/User.html#var$id">$id</a><span class="src-sym">;</span></li>
<li><a name="a54"></a>&nbsp;</li>
<li><a name="a55"></a>    <span class="src-doc">/** Instantiate a user object</span></li>
<li><a name="a56"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">$id </span><span class="src-doc">The user id of the requested user</span></li>
<li><a name="a57"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">a </span><span class="src-doc">User object, or null if there was an error</span></li>
<li><a name="a58"></a><span class="src-doc">     */</span></li>
<li><a name="a59"></a>    <span class="src-key">public </span><span class="src-key">static </span><span class="src-key">function </span><a href="../WiFiDogAuthServer/User.html#methodgetObject">getObject</a><span class="src-sym">(</span><span class="src-var">$id</span><span class="src-sym">)</span></li>
<li><a name="a60"></a>    <span class="src-sym">{</span></li>
<li><a name="a61"></a>        <span class="src-var">$object </span>= <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a62"></a>        <span class="src-var">$object </span>= <span class="src-key">new </span><span class="src-id">self</span><span class="src-sym">(</span><span class="src-var">$id</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a63"></a>        <span class="src-key">return </span><span class="src-var">$object</span><span class="src-sym">;</span></li>
<li><a name="a64"></a>    <span class="src-sym">}</span></li>
<li><a name="a65"></a>&nbsp;</li>
<li><a name="a66"></a>    <span class="src-key">static </span><span class="src-key">function </span><a href="../WiFiDogAuthServer/User.html#methodcreateNewObject">createNewObject</a><span class="src-sym">(</span><span class="src-sym">)</span></li>
<li><a name="a67"></a>    <span class="src-sym">{</span></li>
<li><a name="a68"></a>        echo <span class="src-str">&quot;&lt;h1&gt;Use User::createUser() instead&lt;/h1&gt;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a69"></a>    <span class="src-sym">}</span></li>
<li><a name="a70"></a>    <span class="src-doc">/** Get an interface to create a new object.</span></li>
<li><a name="a71"></a><span class="src-doc">    * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">html </span><span class="src-doc">markup</span></li>
<li><a name="a72"></a><span class="src-doc">    */</span></li>
<li><a name="a73"></a>    <span class="src-key">public </span><span class="src-key">static </span><span class="src-key">function </span><a href="../WiFiDogAuthServer/User.html#methodgetCreateNewObjectUI">getCreateNewObjectUI</a><span class="src-sym">(</span><span class="src-sym">)</span></li>
<li><a name="a74"></a>    <span class="src-sym">{</span></li>
<li><a name="a75"></a>        <span class="src-key">return </span><span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a76"></a>    <span class="src-sym">}</span></li>
<li><a name="a77"></a>&nbsp;</li>
<li><a name="a78"></a>    <span class="src-doc">/** Process the new object interface.</span></li>
<li><a name="a79"></a><span class="src-doc">     *  Will       return the new object if the user has the credentials</span></li>
<li><a name="a80"></a><span class="src-doc">     * necessary (Else an exception is thrown) and and the form was fully</span></li>
<li><a name="a81"></a><span class="src-doc">     * filled (Else the object returns null).</span></li>
<li><a name="a82"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">the </span><span class="src-doc">node object or null if no new node was created.</span></li>
<li><a name="a83"></a><span class="src-doc">     */</span></li>
<li><a name="a84"></a>    <span class="src-key">static </span><span class="src-key">function </span><a href="../WiFiDogAuthServer/User.html#methodprocessCreateNewObjectUI">processCreateNewObjectUI</a><span class="src-sym">(</span><span class="src-sym">)</span></li>
<li><a name="a85"></a>    <span class="src-sym">{</span></li>
<li><a name="a86"></a>        <span class="src-key">return </span><span class="src-id">self </span><span class="src-sym">:: </span><span class="src-id">createNewObject</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a87"></a>    <span class="src-sym">}</span></li>
<li><a name="a88"></a>    <span class="src-doc">/** Instantiate the current user</span></li>
<li><a name="a89"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">a </span><span class="src-doc">User object, or null if there was an error</span></li>
<li><a name="a90"></a><span class="src-doc">     */</span></li>
<li><a name="a91"></a>    <span class="src-key">public </span><span class="src-key">static </span><span class="src-key">function </span><a href="../WiFiDogAuthServer/User.html#methodgetCurrentUser">getCurrentUser</a><span class="src-sym">(</span><span class="src-sym">)</span></li>
<li><a name="a92"></a>    <span class="src-sym">{</span></li>
<li><a name="a93"></a>        <span class="src-inc">require_once </span><span class="src-id"><a href="../WiFiDogAuthServer/_wifidog_install_php.html#defineBASEPATH">BASEPATH</a></span>.<span class="src-str">'classes/Session.php'</span><span class="src-sym">;</span></li>
<li><a name="a94"></a>        <span class="src-var">$session </span>= <span class="src-key">new </span><span class="src-id"><a href="../WiFiDogAuthServer/Session.html">Session</a></span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a95"></a>        <span class="src-var">$user </span>= <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a96"></a>        try</li>
<li><a name="a97"></a>        <span class="src-sym">{</span></li>
<li><a name="a98"></a>            <span class="src-var">$user </span>= <span class="src-id">self </span><span class="src-sym">:: </span><span class="src-id">getObject</span><span class="src-sym">(</span><span class="src-var">$session</span><span class="src-sym">-&gt;</span><span class="src-id">get</span><span class="src-sym">(</span><span class="src-id"><a href="../WiFiDogAuthServer/_wifidog_include_common_php.html#defineSESS_USER_ID_VAR">SESS_USER_ID_VAR</a></span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a99"></a>            <span class="src-comm">//$user = new User($session-&gt;get(SESS_USER_ID_VAR));</span></li>
<li><a name="a100"></a>        <span class="src-sym">}</span></li>
<li><a name="a101"></a>        catch <span class="src-sym">(</span><span class="src-id">Exception </span><span class="src-var">$e</span><span class="src-sym">)</span></li>
<li><a name="a102"></a>        <span class="src-sym">{</span></li>
<li><a name="a103"></a>            <span class="src-comm">/**If any problem occurs, the user should be considered logged out*/</span></li>
<li><a name="a104"></a>            <span class="src-var">$session</span><span class="src-sym">-&gt;</span><span class="src-id">set</span><span class="src-sym">(</span><span class="src-id"><a href="../WiFiDogAuthServer/_wifidog_include_common_php.html#defineSESS_USER_ID_VAR">SESS_USER_ID_VAR</a></span><span class="src-sym">, </span><span class="src-id">null</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a105"></a>        <span class="src-sym">}</span></li>
<li><a name="a106"></a>        <span class="src-key">return </span><span class="src-var">$user</span><span class="src-sym">;</span></li>
<li><a name="a107"></a>    <span class="src-sym">}</span></li>
<li><a name="a108"></a>&nbsp;</li>
<li><a name="a109"></a>    <span class="src-doc">/** Associates the user passed in parameter with the session.  This should NOT be called by anything except the Authenticators</span></li>
<li><a name="a110"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">User </span><span class="src-doc">a user object</span></li>
<li><a name="a111"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">boolean </span><span class="src-doc">true if everything went well setting the session...</span></li>
<li><a name="a112"></a><span class="src-doc">     */</span></li>
<li><a name="a113"></a>    <span class="src-key">public </span><span class="src-key">static </span><span class="src-key">function </span><a href="../WiFiDogAuthServer/User.html#methodsetCurrentUser">setCurrentUser</a><span class="src-sym">(</span><span class="src-id">User </span><span class="src-var">$user</span><span class="src-sym">)</span></li>
<li><a name="a114"></a>    <span class="src-sym">{</span></li>
<li><a name="a115"></a>        try</li>
<li><a name="a116"></a>        <span class="src-sym">{</span></li>
<li><a name="a117"></a>            <span class="src-var">$session </span>= <span class="src-key">new </span><span class="src-id"><a href="../WiFiDogAuthServer/Session.html">Session</a></span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a118"></a>            <span class="src-var">$session</span><span class="src-sym">-&gt;</span><span class="src-id">set</span><span class="src-sym">(</span><span class="src-id"><a href="../WiFiDogAuthServer/_wifidog_include_common_php.html#defineSESS_USER_ID_VAR">SESS_USER_ID_VAR</a></span><span class="src-sym">, </span><span class="src-var">$user</span><span class="src-sym">-&gt;</span><span class="src-id">getId</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a119"></a>            <span class="src-var">$session</span><span class="src-sym">-&gt;</span><span class="src-id">set</span><span class="src-sym">(</span><span class="src-id"><a href="../WiFiDogAuthServer/_wifidog_include_common_php.html#defineSESS_PASSWORD_HASH_VAR">SESS_PASSWORD_HASH_VAR</a></span><span class="src-sym">, </span><span class="src-var">$user</span><span class="src-sym">-&gt;</span><span class="src-id">getPasswordHash</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a120"></a>            <span class="src-key">return </span><span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a121"></a>        <span class="src-sym">}</span></li>
<li><a name="a122"></a>        catch <span class="src-sym">(</span><span class="src-id">Exception </span><span class="src-var">$e</span><span class="src-sym">)</span></li>
<li><a name="a123"></a>        <span class="src-sym">{</span></li>
<li><a name="a124"></a>            <span class="src-key">return </span><span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a125"></a>        <span class="src-sym">}</span></li>
<li><a name="a126"></a>    <span class="src-sym">}</span></li>
<li><a name="a127"></a>&nbsp;</li>
<li><a name="a128"></a>    <span class="src-doc">/** Instantiate a user object</span></li>
<li><a name="a129"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">$username </span><span class="src-doc">The username of the user</span></li>
<li><a name="a130"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">$account_origin </span><span class="src-doc">Network:  The account origin</span></li>
<li><a name="a131"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">a </span><span class="src-doc">User object, or null if there was an error</span></li>
<li><a name="a132"></a><span class="src-doc">     */</span></li>
<li><a name="a133"></a>    <span class="src-key">public </span><span class="src-key">static </span><span class="src-key">function </span><a href="../WiFiDogAuthServer/User.html#methodgetUserByUsernameAndOrigin">getUserByUsernameAndOrigin</a><span class="src-sym">(</span><span class="src-var">$username</span><span class="src-sym">, </span><span class="src-id">Network </span><span class="src-var">$account_origin</span><span class="src-sym">)</span></li>
<li><a name="a134"></a>    <span class="src-sym">{</span></li>
<li><a name="a135"></a>        <span class="src-key">global </span><span class="src-var">$db</span><span class="src-sym">;</span></li>
<li><a name="a136"></a>        <span class="src-var">$object </span>= <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a137"></a>&nbsp;</li>
<li><a name="a138"></a>        <span class="src-var">$username_str </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">EscapeString</span><span class="src-sym">(</span><span class="src-var">$username</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a139"></a>        <span class="src-var">$account_origin_str </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">EscapeString</span><span class="src-sym">(</span><span class="src-var">$account_origin</span><span class="src-sym">-&gt;</span><span class="src-id">getId</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a140"></a>        <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">ExecSqlUniqueRes</span><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-str"><span class="src-id">SELECT</span> <span class="src-id">user_id</span> <span class="src-id">FROM</span> <span class="src-id">users</span> <span class="src-id">WHERE</span> <span class="src-id">username</span> = '<span class="src-var">$username_str</span>' <span class="src-id">AND</span> <span class="src-id">account_origin</span> = '<span class="src-var">$account_origin_str</span>'</span><span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-var">$user_info</span><span class="src-sym">, </span><span class="src-id">false</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a141"></a>&nbsp;</li>
<li><a name="a142"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$user_info </span>!= <span class="src-id">null</span><span class="src-sym">)</span></li>
<li><a name="a143"></a>            <span class="src-var">$object </span>= <span class="src-key">new </span><span class="src-id">self</span><span class="src-sym">(</span><span class="src-var">$user_info</span><span class="src-sym">[</span><span class="src-str">'user_id'</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a144"></a>        <span class="src-key">return </span><span class="src-var">$object</span><span class="src-sym">;</span></li>
<li><a name="a145"></a>    <span class="src-sym">}</span></li>
<li><a name="a146"></a>&nbsp;</li>
<li><a name="a147"></a>    <span class="src-doc">/** Instantiate a user object</span></li>
<li><a name="a148"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">$email </span><span class="src-doc">The email of the user</span></li>
<li><a name="a149"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">$account_origin </span><span class="src-doc">Network:  The account origin</span></li>
<li><a name="a150"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">a </span><span class="src-doc">User object, or null if there was an error</span></li>
<li><a name="a151"></a><span class="src-doc">     */</span></li>
<li><a name="a152"></a>    <span class="src-key">public </span><span class="src-key">static </span><span class="src-key">function </span><a href="../WiFiDogAuthServer/User.html#methodgetUserByEmailAndOrigin">getUserByEmailAndOrigin</a><span class="src-sym">(</span><span class="src-var">$email</span><span class="src-sym">, </span><span class="src-id">Network </span><span class="src-var">$account_origin</span><span class="src-sym">)</span></li>
<li><a name="a153"></a>    <span class="src-sym">{</span></li>
<li><a name="a154"></a>        <span class="src-key">global </span><span class="src-var">$db</span><span class="src-sym">;</span></li>
<li><a name="a155"></a>        <span class="src-var">$object </span>= <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a156"></a>&nbsp;</li>
<li><a name="a157"></a>        <span class="src-var">$email_str </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">EscapeString</span><span class="src-sym">(</span><span class="src-var">$email</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a158"></a>        <span class="src-var">$account_origin_str </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">EscapeString</span><span class="src-sym">(</span><span class="src-var">$account_origin</span><span class="src-sym">-&gt;</span><span class="src-id">getId</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a159"></a>        <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">ExecSqlUniqueRes</span><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-str"><span class="src-id">SELECT</span> <span class="src-id">user_id</span> <span class="src-id">FROM</span> <span class="src-id">users</span> <span class="src-id">WHERE</span> <span class="src-id">email</span> = '<span class="src-var">$email_str</span>' <span class="src-id">AND</span> <span class="src-id">account_origin</span> = '<span class="src-var">$account_origin_str</span>'</span><span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-var">$user_info</span><span class="src-sym">, </span><span class="src-id">false</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a160"></a>&nbsp;</li>
<li><a name="a161"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$user_info </span>!= <span class="src-id">null</span><span class="src-sym">)</span></li>
<li><a name="a162"></a>            <span class="src-var">$object </span>= <span class="src-key">new </span><span class="src-id">self</span><span class="src-sym">(</span><span class="src-var">$user_info</span><span class="src-sym">[</span><span class="src-str">'user_id'</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a163"></a>        <span class="src-key">return </span><span class="src-var">$object</span><span class="src-sym">;</span></li>
<li><a name="a164"></a>    <span class="src-sym">}</span></li>
<li><a name="a165"></a>&nbsp;</li>
<li><a name="a166"></a>    <span class="src-doc">/** Returns the hash of the password suitable for storing or comparing in the database.  This hash is the same one as used in NoCat</span></li>
<li><a name="a167"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">The </span><span class="src-doc">32 character hash.</span></li>
<li><a name="a168"></a><span class="src-doc">     */</span></li>
<li><a name="a169"></a>    <span class="src-key">public </span><span class="src-key">static </span><span class="src-key">function </span><a href="../WiFiDogAuthServer/User.html#methodpasswordHash">passwordHash</a><span class="src-sym">(</span><span class="src-var">$password</span><span class="src-sym">)</span></li>
<li><a name="a170"></a>    <span class="src-sym">{</span></li>
<li><a name="a171"></a>        /**</li>
<li><a name="a172"></a>         * utf8_decode is used for backward compatibility with old passwords</li>
<li><a name="a173"></a>         * containing special characters.</li>
<li><a name="a174"></a>         * Conversion from UTF-8 to ISO-8859-1 is done to match the MD5 hash</li>
<li><a name="a175"></a>         */</li>
<li><a name="a176"></a>        <span class="src-key">return </span><a href="http://www.php.net/base64_encode">base64_encode</a><span class="src-sym">(</span><a href="http://www.php.net/pack">pack</a><span class="src-sym">(</span><span class="src-str">&quot;H*&quot;</span><span class="src-sym">, </span><a href="http://www.php.net/md5">md5</a><span class="src-sym">(</span><a href="http://www.php.net/utf8_decode">utf8_decode</a><span class="src-sym">(</span><span class="src-var">$password</span><span class="src-sym">))))</span><span class="src-sym">;</span></li>
<li><a name="a177"></a>    <span class="src-sym">}</span></li>
<li><a name="a178"></a>&nbsp;</li>
<li><a name="a179"></a>    <span class="src-doc">/** Create a new User in the database</span></li>
<li><a name="a180"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">$id </span><span class="src-doc">The id to be given to the new user</span></li>
<li><a name="a181"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">the </span><span class="src-doc">newly created User object, or null if there was an error</span></li>
<li><a name="a182"></a><span class="src-doc">     */</span></li>
<li><a name="a183"></a>    <span class="src-key">static </span><span class="src-key">function </span><a href="../WiFiDogAuthServer/User.html#methodcreateUser">createUser</a><span class="src-sym">(</span><span class="src-var">$id</span><span class="src-sym">, </span><span class="src-var">$username</span><span class="src-sym">, </span><span class="src-id">Network </span><span class="src-var">$account_origin</span><span class="src-sym">, </span><span class="src-var">$email</span><span class="src-sym">, </span><span class="src-var">$password</span><span class="src-sym">)</span></li>
<li><a name="a184"></a>    <span class="src-sym">{</span></li>
<li><a name="a185"></a>        <span class="src-key">global </span><span class="src-var">$db</span><span class="src-sym">;</span></li>
<li><a name="a186"></a>&nbsp;</li>
<li><a name="a187"></a>        <span class="src-var">$object </span>= <span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a188"></a>        <span class="src-var">$id_str </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">EscapeString</span><span class="src-sym">(</span><span class="src-var">$id</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a189"></a>        <span class="src-var">$username_str </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">EscapeString</span><span class="src-sym">(</span><span class="src-var">$username</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a190"></a>        <span class="src-var">$account_origin_str </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">EscapeString</span><span class="src-sym">(</span><span class="src-var">$account_origin</span><span class="src-sym">-&gt;</span><span class="src-id">getId</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a191"></a>        <span class="src-var">$email_str </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">EscapeString</span><span class="src-sym">(</span><span class="src-var">$email</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a192"></a>&nbsp;</li>
<li><a name="a193"></a>        <span class="src-var">$password_hash </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">EscapeString</span><span class="src-sym">(</span><span class="src-id"><a href="../WiFiDogAuthServer/User.html">User</a> </span><span class="src-sym">:: </span><a href="../WiFiDogAuthServer/User.html#methodpasswordHash">passwordHash</a><span class="src-sym">(</span><span class="src-var">$password</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a194"></a>        <span class="src-var">$status </span>= <span class="src-id"><a href="../WiFiDogAuthServer/_wifidog_include_common_php.html#defineACCOUNT_STATUS_VALIDATION">ACCOUNT_STATUS_VALIDATION</a></span><span class="src-sym">;</span></li>
<li><a name="a195"></a>        <span class="src-var">$token </span>= <span class="src-id"><a href="../WiFiDogAuthServer/User.html">User</a> </span><span class="src-sym">:: </span><a href="../WiFiDogAuthServer/User.html#methodgenerateToken">generateToken</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a196"></a>&nbsp;</li>
<li><a name="a197"></a>        <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">ExecSqlUpdate</span><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-str"><span class="src-id">INSERT</span> <span class="src-id">INTO</span> <span class="src-id">users</span> (<span class="src-id">user_id</span>,<span class="src-id">username</span>, <span class="src-id">account_origin</span>,<span class="src-id">email</span>,<span class="src-id">pass</span>,<span class="src-id">account_status</span>,<span class="src-id">validation_token</span>,<span class="src-id">reg_date</span>) <span class="src-id">VALUES</span> ('<span class="src-var">$id_str</span>','<span class="src-var">$username_str</span>','<span class="src-var">$account_origin_str</span>','<span class="src-var">$email_str</span>','<span class="src-var">$password_hash</span>','<span class="src-var">$status</span>','<span class="src-var">$token</span>',<span class="src-id">NOW</span>())</span><span class="src-str">&quot;</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a198"></a>&nbsp;</li>
<li><a name="a199"></a>        <span class="src-var">$object </span>= <span class="src-key">new </span><span class="src-id">self</span><span class="src-sym">(</span><span class="src-var">$id</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a200"></a>        <span class="src-key">return </span><span class="src-var">$object</span><span class="src-sym">;</span></li>
<li><a name="a201"></a>    <span class="src-sym">}</span></li>
<li><a name="a202"></a>&nbsp;</li>
<li><a name="a203"></a>    <span class="src-key">public </span><span class="src-key">static </span><span class="src-key">function </span><a href="../WiFiDogAuthServer/User.html#methodpurgeUnvalidatedUsers">purgeUnvalidatedUsers</a><span class="src-sym">(</span><span class="src-var">$days_since_creation</span><span class="src-sym">)</span></li>
<li><a name="a204"></a>    <span class="src-sym">{</span></li>
<li><a name="a205"></a>        <span class="src-key">global </span><span class="src-var">$db</span><span class="src-sym">;</span></li>
<li><a name="a206"></a>        <span class="src-var">$days_since_creation </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">EscapeString</span><span class="src-sym">(</span><span class="src-var">$days_since_creation</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a207"></a>&nbsp;</li>
<li><a name="a208"></a>        <span class="src-comm">//$db-&gt;ExecSqlUpdate(&quot;INSERT INTO users (user_id,username, account_origin,email,pass,account_status,validation_token,reg_date) VALUES ('$id_str','$username_str','$account_origin_str','$email_str','$password_hash','$status','$token',NOW())&quot;);</span></li>
<li><a name="a209"></a>    <span class="src-sym">}</span></li>
<li><a name="a210"></a>&nbsp;</li>
<li><a name="a211"></a>    <span class="src-doc">/** </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">$object_id </span><span class="src-doc">The id of the user */</span></li>
<li><a name="a212"></a>    <span class="src-key">function </span><a href="../WiFiDogAuthServer/User.html#method__construct">__construct</a><span class="src-sym">(</span><span class="src-var">$object_id</span><span class="src-sym">)</span></li>
<li><a name="a213"></a>    <span class="src-sym">{</span></li>
<li><a name="a214"></a>        <span class="src-key">global </span><span class="src-var">$db</span><span class="src-sym">;</span></li>
<li><a name="a215"></a>        <span class="src-var">$object_id_str </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">EscapeString</span><span class="src-sym">(</span><span class="src-var">$object_id</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a216"></a>        <span class="src-var">$sql </span>= <span class="src-str">&quot;</span><span class="src-str"><span class="src-id">SELECT</span> * <span class="src-id">FROM</span> <span class="src-id">users</span> <span class="src-id">WHERE</span> <span class="src-id">user_id</span>='{<span class="src-var">$object_id_str</span><span class="src-sym">}</span>'</span><span class="src-str">&quot;</span><span class="src-sym">;</span></li>
<li><a name="a217"></a>        <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">ExecSqlUniqueRes</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">, </span><span class="src-var">$row</span><span class="src-sym">, </span><span class="src-id">false</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a218"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$row </span>== <span class="src-id">null</span><span class="src-sym">)</span></li>
<li><a name="a219"></a>        <span class="src-sym">{</span></li>
<li><a name="a220"></a>            throw <span class="src-key">new </span><span class="src-id">Exception</span><span class="src-sym">(</span><a href="http://www.php.net/sprintf">sprintf</a><span class="src-sym">(</span><a href="../WiFiDogAuthServer/_wifidog_classes_Locale_php.html#function_">_</a><span class="src-sym">(</span><span class="src-str">&quot;User id: %s could not be found in the database&quot;</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-var">$object_id_str</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a221"></a>        <span class="src-sym">}</span></li>
<li><a name="a222"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#var$mRow">mRow</a> = <span class="src-var">$row</span><span class="src-sym">;</span></li>
<li><a name="a223"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#var$id">id</a> = <span class="src-var">$row</span><span class="src-sym">[</span><span class="src-str">'user_id'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a224"></a>    <span class="src-sym">} </span><span class="src-comm">//End class</span></li>
<li><a name="a225"></a>&nbsp;</li>
<li><a name="a225"></a>    </li>
<li><a name="a226"></a>    <span class="src-key">function </span><a href="../WiFiDogAuthServer/User.html#methodgetId">getId</a><span class="src-sym">(</span><span class="src-sym">)</span></li>
<li><a name="a227"></a>    <span class="src-sym">{</span></li>
<li><a name="a228"></a>        <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#var$id">id</a><span class="src-sym">;</span></li>
<li><a name="a229"></a>    <span class="src-sym">}</span></li>
<li><a name="a230"></a>&nbsp;</li>
<li><a name="a231"></a>    <span class="src-doc">/** Gets the Network to which the user belongs</span></li>
<li><a name="a232"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">Network </span><span class="src-doc">object (never returns null)</span></li>
<li><a name="a233"></a><span class="src-doc">     */</span></li>
<li><a name="a234"></a>    <span class="src-key">public </span><span class="src-key">function </span><a href="../WiFiDogAuthServer/User.html#methodgetNetwork">getNetwork</a><span class="src-sym">(</span><span class="src-sym">)</span></li>
<li><a name="a235"></a>    <span class="src-sym">{</span></li>
<li><a name="a236"></a>        <span class="src-key">return </span><span class="src-id"><a href="../WiFiDogAuthServer/Network.html">Network</a> </span><span class="src-sym">:: </span><a href="../WiFiDogAuthServer/Network.html#methodgetObject">getObject</a><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#var$mRow">mRow</a><span class="src-sym">[</span><span class="src-str">'account_origin'</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a237"></a>    <span class="src-sym">}</span></li>
<li><a name="a238"></a>&nbsp;</li>
<li><a name="a239"></a>    <span class="src-doc">/** Get a user display suitable for a user list.  Will include link to the user profile. */</span></li>
<li><a name="a239"></a>&nbsp;</li>
<li><a name="a240"></a>    <span class="src-key">function </span><a href="../WiFiDogAuthServer/User.html#methodgetUserListUI">getUserListUI</a><span class="src-sym">(</span><span class="src-sym">)</span></li>
<li><a name="a241"></a>    <span class="src-sym">{</span></li>
<li><a name="a242"></a>        <span class="src-var">$html </span>= <span class="src-str">''</span><span class="src-sym">;</span></li>
<li><a name="a243"></a>        <span class="src-var">$html </span>.= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">getUserName</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a244"></a>        <span class="src-key">return </span><span class="src-var">$html</span><span class="src-sym">;</span></li>
<li><a name="a245"></a>    <span class="src-sym">}</span></li>
<li><a name="a246"></a>&nbsp;</li>
<li><a name="a247"></a>    <span class="src-key">function </span><a href="../WiFiDogAuthServer/User.html#methodgetUsername">getUsername</a><span class="src-sym">(</span><span class="src-sym">)</span></li>
<li><a name="a248"></a>    <span class="src-sym">{</span></li>
<li><a name="a249"></a>        <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#var$mRow">mRow</a><span class="src-sym">[</span><span class="src-str">'username'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a250"></a>    <span class="src-sym">}</span></li>
<li><a name="a251"></a>&nbsp;</li>
<li><a name="a252"></a>    <span class="src-key">public </span><span class="src-key">function </span><a href="../WiFiDogAuthServer/User.html#methodgetEmail">getEmail</a><span class="src-sym">(</span><span class="src-sym">)</span></li>
<li><a name="a253"></a>    <span class="src-sym">{</span></li>
<li><a name="a254"></a>        <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#var$mRow">mRow</a><span class="src-sym">[</span><span class="src-str">'email'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a255"></a>    <span class="src-sym">}</span></li>
<li><a name="a256"></a>&nbsp;</li>
<li><a name="a257"></a>    <span class="src-key">public </span><span class="src-key">function </span><a href="../WiFiDogAuthServer/User.html#methodgetRealName">getRealName</a><span class="src-sym">(</span><span class="src-sym">)</span></li>
<li><a name="a258"></a>    <span class="src-sym">{</span></li>
<li><a name="a259"></a>        <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#var$mRow">mRow</a><span class="src-sym">[</span><span class="src-str">'real_name'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a260"></a>    <span class="src-sym">}</span></li>
<li><a name="a261"></a>&nbsp;</li>
<li><a name="a262"></a>    <span class="src-key">public </span><span class="src-key">function </span><a href="../WiFiDogAuthServer/User.html#methodsetRealName">setRealName</a><span class="src-sym">(</span><span class="src-sym">)</span></li>
<li><a name="a263"></a>    <span class="src-sym">{</span></li>
<li><a name="a264"></a>    <span class="src-sym">}</span></li>
<li><a name="a265"></a>&nbsp;</li>
<li><a name="a266"></a>    <span class="src-key">public </span><span class="src-key">function </span><a href="../WiFiDogAuthServer/User.html#methodgetWebsiteURL">getWebsiteURL</a><span class="src-sym">(</span><span class="src-sym">)</span></li>
<li><a name="a267"></a>    <span class="src-sym">{</span></li>
<li><a name="a268"></a>        <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#var$mRow">mRow</a><span class="src-sym">[</span><span class="src-str">'website'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a269"></a>    <span class="src-sym">}</span></li>
<li><a name="a270"></a>&nbsp;</li>
<li><a name="a271"></a>    <span class="src-key">public </span><span class="src-key">function </span><a href="../WiFiDogAuthServer/User.html#methodsetWebsiteURL">setWebsiteURL</a><span class="src-sym">(</span><span class="src-sym">)</span></li>
<li><a name="a272"></a>    <span class="src-sym">{</span></li>
<li><a name="a273"></a>    <span class="src-sym">}</span></li>
<li><a name="a274"></a>&nbsp;</li>
<li><a name="a275"></a>    <span class="src-doc">/**What locale (language) does the user prefer?</span></li>
<li><a name="a276"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@todo</span><span class="src-doc"> Save in the database */</span></li>
<li><a name="a277"></a>    <span class="src-key">public </span><span class="src-key">function </span><a href="../WiFiDogAuthServer/User.html#methodgetPreferedLocale">getPreferedLocale</a><span class="src-sym">(</span><span class="src-sym">)</span></li>
<li><a name="a278"></a>    <span class="src-sym">{</span></li>
<li><a name="a279"></a>        <span class="src-key">global </span><span class="src-var">$session</span><span class="src-sym">;</span></li>
<li><a name="a280"></a>        <span class="src-comm">//return $this-&gt;mRow['prefered_locale'];</span></li>
<li><a name="a281"></a>        <span class="src-var">$locale </span>= <span class="src-var">$session</span><span class="src-sym">-&gt;</span><span class="src-id">get</span><span class="src-sym">(</span><span class="src-str">'SESS_LANGUAGE_VAR'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a282"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-key">empty </span><span class="src-sym">(</span><span class="src-var">$locale</span><span class="src-sym">))</span></li>
<li><a name="a283"></a>        <span class="src-sym">{</span></li>
<li><a name="a284"></a>            <span class="src-var">$locale </span>= <span class="src-id"><a href="../WiFiDogAuthServer/_wifidog_config_php.html#defineDEFAULT_LANG">DEFAULT_LANG</a></span><span class="src-sym">;</span></li>
<li><a name="a285"></a>        <span class="src-sym">}</span></li>
<li><a name="a286"></a>        <span class="src-key">return </span><span class="src-var">$locale</span><span class="src-sym">;</span></li>
<li><a name="a287"></a>    <span class="src-sym">}</span></li>
<li><a name="a288"></a>&nbsp;</li>
<li><a name="a289"></a>    <span class="src-doc">/** get the hashed password stored in the database */</span></li>
<li><a name="a289"></a>&nbsp;</li>
<li><a name="a290"></a>    <span class="src-key">public </span><span class="src-key">function </span><a href="../WiFiDogAuthServer/User.html#methodgetPasswordHash">getPasswordHash</a><span class="src-sym">(</span><span class="src-sym">)</span></li>
<li><a name="a291"></a>    <span class="src-sym">{</span></li>
<li><a name="a292"></a>        <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#var$mRow">mRow</a><span class="src-sym">[</span><span class="src-str">'pass'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a293"></a>    <span class="src-sym">}</span></li>
<li><a name="a294"></a>&nbsp;</li>
<li><a name="a295"></a>    <span class="src-doc">/** Get the account status.</span></li>
<li><a name="a296"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">Possible </span><span class="src-doc">values are listed in common.php</span></li>
<li><a name="a297"></a><span class="src-doc">    */</span></li>
<li><a name="a298"></a>    <span class="src-key">function </span><a href="../WiFiDogAuthServer/User.html#methodgetAccountStatus">getAccountStatus</a><span class="src-sym">(</span><span class="src-sym">)</span></li>
<li><a name="a299"></a>    <span class="src-sym">{</span></li>
<li><a name="a300"></a>        <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#var$mRow">mRow</a><span class="src-sym">[</span><span class="src-str">'account_status'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a301"></a>    <span class="src-sym">}</span></li>
<li><a name="a302"></a>&nbsp;</li>
<li><a name="a303"></a>    <span class="src-key">function </span><a href="../WiFiDogAuthServer/User.html#methodsetAccountStatus">setAccountStatus</a><span class="src-sym">(</span><span class="src-var">$status</span><span class="src-sym">)</span></li>
<li><a name="a304"></a>    <span class="src-sym">{</span></li>
<li><a name="a305"></a>        <span class="src-key">global </span><span class="src-var">$db</span><span class="src-sym">;</span></li>
<li><a name="a306"></a>&nbsp;</li>
<li><a name="a307"></a>        <span class="src-var">$status_str </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">EscapeString</span><span class="src-sym">(</span><span class="src-var">$status</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a308"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">(</span><span class="src-var">$update </span>= <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">ExecSqlUpdate</span><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-str"><span class="src-id">UPDATE</span> <span class="src-id">users</span> <span class="src-id">SET</span> <span class="src-id">account_status</span>='{<span class="src-var">$status_str</span><span class="src-sym">}</span>' <span class="src-id">WHERE</span> <span class="src-id">user_id</span>='{<span class="src-var">$this</span></span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#var$id">id</a><span class="src-sym">}</span>'</span><span class="src-str"><span class="src-str">"</span><span class="src-sym">)))</span></span></li>
<li><a name="a309"></a></span><span class="src-str">        <span class="src-sym">{</span></span></li>
<li><a name="a310"></a></span><span class="src-str">            throw <span class="src-key">new</span> <span class="src-id">Exception</span><span class="src-sym">(</span><span class="src-id">_</span><span class="src-sym">(</span><span class="src-str">&quot;Could not update status.&quot;</span><span class="src-sym">))</span><span class="src-sym">;</span></span></li>
<li><a name="a311"></a></span><span class="src-str">        <span class="src-sym">}</span></span></li>
<li><a name="a312"></a></span><span class="src-str">        <span class="src-var">$this</span></span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#var$mRow">mRow</a><span class="src-sym">[</span><span class="src-str">'account_status'</span><span class="src-sym">] </span>= <span class="src-var">$status</span><span class="src-sym">;</span></li>
<li><a name="a313"></a>    </span><span class="src-str"><span class="src-sym">}</span></span></li>
<li><a name="a314"></a>&nbsp;</li>
<li><a name="a315"></a></span><span class="src-str">    /** Is the user valid?  Valid means that the account is validated or hasn't exhausted it's validation period.</span></li>
<li><a name="a316"></a></span><span class="src-str">     $errmsg: Returs the reason why the account is or isn't valid */</span></li>
<li><a name="a317"></a></span><span class="src-str">    <span class="src-key">function</span> <span class="src-id">isUserValid</span><span class="src-sym">(</span><span class="src-sym">&</span> <span class="src-var">$errmsg</span> = <span class="src-id">null</span><span class="src-sym">)</span></span></li>
<li><a name="a318"></a></span><span class="src-str">    <span class="src-sym">{</span></span></li>
<li><a name="a319"></a></span><span class="src-str">        <span class="src-key">global</span> <span class="src-var">$db</span><span class="src-sym">;</span></span></li>
<li><a name="a320"></a></span><span class="src-str">        <span class="src-var">$retval</span> = <span class="src-id">false</span><span class="src-sym">;</span></span></li>
<li><a name="a321"></a></span><span class="src-str">        <span class="src-var">$account_status</span> = <span class="src-var">$this</span></span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#methodgetAccountStatus">getAccountStatus</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a322"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$account_status </span>== <span class="src-id">ACCOUNT_STATUS_ALLOWED</span><span class="src-sym">)</span></li>
<li><a name="a323"></a>        </span><span class="src-str"><span class="src-sym">{</span></span></li>
<li><a name="a324"></a></span><span class="src-str">            <span class="src-var">$retval</span> = <span class="src-id">true</span><span class="src-sym">;</span></span></li>
<li><a name="a325"></a></span><span class="src-str">        <span class="src-sym">}</span></span></li>
<li><a name="a326"></a></span><span class="src-str">        <span class="src-key">else</span></span></li>
<li><a name="a327"></a></span><span class="src-str">            <span class="src-key">if</span> <span class="src-sym">(</span><span class="src-var">$account_status</span> == <span class="src-id">ACCOUNT_STATUS_VALIDATION</span><span class="src-sym">)</span></span></li>
<li><a name="a328"></a></span><span class="src-str">            <span class="src-sym">{</span></span></li>
<li><a name="a329"></a></span><span class="src-str">                <span class="src-var">$sql</span> = <span class="src-str">"</span><span class="src-id">SELECT</span> <span class="src-id">CASE</span> <span class="src-id">WHEN</span> ((<span class="src-id">NOW</span>() - <span class="src-id">reg_date</span>) &gt; <span class="src-id">networks</span>.<span class="src-id">validation_grace_time</span>) <span class="src-id">THEN</span> <span class="src-id">true</span> <span class="src-id">ELSE</span> <span class="src-id">false</span> <span class="src-id">END</span> <span class="src-id">AS</span> <span class="src-id">validation_grace_time_expired</span>, <span class="src-id">networks</span>.<span class="src-id">validation_grace_time</span> <span class="src-id">FROM</span> <span class="src-id">users</span>  <span class="src-id">JOIN</span> <span class="src-id">networks</span> <span class="src-id">ON</span> (<span class="src-id">users</span>.<span class="src-id">account_origin</span> = <span class="src-id">networks</span>.<span class="src-id">network_id</span>) <span class="src-id">WHERE</span> (<span class="src-id">user_id</span>='</span>{<span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#var$id">id</a><span class="src-sym">}</span>')</span><span class="src-str"><span class="src-str">"</span><span class="src-sym">;</span></span></li>
<li><a name="a330"></a></span><span class="src-str">                <span class="src-var">$db</span></span><span class="src-sym">-&gt;</span><span class="src-id">ExecSqlUniqueRes</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">, </span><span class="src-var">$user_info</span><span class="src-sym">, </span><span class="src-id">false</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a331"></a>&nbsp;</li>
<li><a name="a332"></a>                <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$user_info</span><span class="src-sym">[</span><span class="src-str">'validation_grace_time_expired'</span><span class="src-sym">] </span>== <span class="src-str">'t'</span><span class="src-sym">)</span></li>
<li><a name="a333"></a>                </span><span class="src-str"><span class="src-sym">{</span></span></li>
<li><a name="a334"></a></span><span class="src-str">                    <span class="src-var">$errmsg</span> = <span class="src-id">sprintf</span><span class="src-sym">(</span><span class="src-id">_</span><span class="src-sym">(</span><span class="src-str">&quot;Sorry, your %s minutes grace period to retrieve your email and validate your account has now expired. You will have to connect to the internet and validate your account from another location or create a new account. For help, please %s click here %s.&quot;</span><span class="src-sym">)</span><span class="src-sym">,</span> <span class="src-var">$user_info</span><span class="src-sym">[</span><span class="src-str">'validation_grace_time_expired'</span><span class="src-sym">]</span><span class="src-sym">,</span> <span class="src-str">'&lt;a href=&quot;'</span>.<span class="src-id">BASEPATH</span>.<span class="src-str">'faq.php'</span>.<span class="src-str">'&quot;&gt;'</span><span class="src-sym">,</span> <span class="src-str">'&lt;/a&gt;'</span><span class="src-sym">)</span><span class="src-sym">;</span></span></li>
<li><a name="a335"></a></span><span class="src-str">                    <span class="src-var">$retval</span> = <span class="src-id">false</span><span class="src-sym">;</span></span></li>
<li><a name="a336"></a></span><span class="src-str">                <span class="src-sym">}</span></span></li>
<li><a name="a337"></a></span><span class="src-str">                <span class="src-key">else</span></span></li>
<li><a name="a338"></a></span><span class="src-str">                <span class="src-sym">{</span></span></li>
<li><a name="a339"></a></span><span class="src-str">                    <span class="src-var">$errmsg</span> = <span class="src-id">_</span><span class="src-sym">(</span><span class="src-str">&quot;Your account is currently valid.&quot;</span><span class="src-sym">)</span><span class="src-sym">;</span></span></li>
<li><a name="a340"></a></span><span class="src-str">                    <span class="src-var">$retval</span> = <span class="src-id">true</span><span class="src-sym">;</span></span></li>
<li><a name="a341"></a></span><span class="src-str">                <span class="src-sym">}</span></span></li>
<li><a name="a342"></a></span><span class="src-str">            <span class="src-sym">}</span></span></li>
<li><a name="a343"></a></span><span class="src-str">            <span class="src-key">else</span></span></li>
<li><a name="a344"></a></span><span class="src-str">            <span class="src-sym">{</span></span></li>
<li><a name="a345"></a></span><span class="src-str">                <span class="src-var">$errmsg</span> = <span class="src-id">_</span><span class="src-sym">(</span><span class="src-str">&quot;Sorry, your account is not valid: &quot;</span><span class="src-sym">)</span>.<span class="src-var">$account_status_to_text</span><span class="src-sym">[</span><span class="src-var">$account_status</span><span class="src-sym">]</span><span class="src-sym">;</span></span></li>
<li><a name="a346"></a></span><span class="src-str">                <span class="src-var">$retval</span> = <span class="src-id">false</span><span class="src-sym">;</span></span></li>
<li><a name="a347"></a></span><span class="src-str">            <span class="src-sym">}</span></span></li>
<li><a name="a348"></a></span><span class="src-str">        <span class="src-key">return</span> <span class="src-var">$retval</span><span class="src-sym">;</span></span></li>
<li><a name="a349"></a></span><span class="src-str">    <span class="src-sym">}</span></span></li>
<li><a name="a350"></a>&nbsp;</li>
<li><a name="a351"></a></span><span class="src-str">    <span class="src-key">public</span> <span class="src-key">function</span> <span class="src-id">isSuperAdmin</span><span class="src-sym">(</span><span class="src-sym">)</span></span></li>
<li><a name="a352"></a></span><span class="src-str">    <span class="src-sym">{</span></span></li>
<li><a name="a353"></a></span><span class="src-str">        <span class="src-key">global</span> <span class="src-var">$db</span><span class="src-sym">;</span></span></li>
<li><a name="a354"></a></span><span class="src-str">        <span class="src-comm">//$this-&gt;session-&gt;dump();</span></span></li>
<li><a name="a355"></a></span><span class="src-str"><span class="src-comm"></span></span></li>
<li><a name="a356"></a></span><span class="src-str">        <span class="src-var">$db</span></span><span class="src-sym">-&gt;</span><span class="src-id">ExecSqlUniqueRes</span><span class="src-sym">(</span><span class="src-str"></span><span class="src-str">"</span><span class="src-id">SELECT</span> * <span class="src-id">FROM</span> <span class="src-id">users</span> <span class="src-id">NATURAL</span> <span class="src-id">JOIN</span> <span class="src-id">administrators</span> <span class="src-id">WHERE</span> (<span class="src-id">users</span>.<span class="src-id">user_id</span>='<span class="src-var">$this</span></span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#var$id">id</a>')</span><span class="src-str"><span class="src-str">"</span><span class="src-sym">,</span> <span class="src-var">$user_info</span><span class="src-sym">,</span> <span class="src-id">false</span><span class="src-sym">)</span><span class="src-sym">;</span></span></li>
<li><a name="a357"></a></span><span class="src-str">        <span class="src-key">if</span> <span class="src-sym">(</span><span class="src-sym">!</span><span class="src-key">empty</span> <span class="src-sym">(</span><span class="src-var">$user_info</span><span class="src-sym">))</span></span></li>
<li><a name="a358"></a></span><span class="src-str">        <span class="src-sym">{</span></span></li>
<li><a name="a359"></a></span><span class="src-str">            <span class="src-key">return</span> <span class="src-id">true</span><span class="src-sym">;</span></span></li>
<li><a name="a360"></a></span><span class="src-str">        <span class="src-sym">}</span></span></li>
<li><a name="a361"></a></span><span class="src-str">        <span class="src-key">else</span></span></li>
<li><a name="a362"></a></span><span class="src-str">        <span class="src-sym">{</span></span></li>
<li><a name="a363"></a></span><span class="src-str">            <span class="src-key">return</span> <span class="src-id">false</span><span class="src-sym">;</span></span></li>
<li><a name="a364"></a></span><span class="src-str">        <span class="src-sym">}</span></span></li>
<li><a name="a365"></a>&nbsp;</li>
<li><a name="a366"></a></span><span class="src-str">    <span class="src-sym">}</span></span></li>
<li><a name="a367"></a>&nbsp;</li>
<li><a name="a368"></a></span><span class="src-str">    /**</span></li>
<li><a name="a369"></a></span><span class="src-str">     * Tells if the current user is owner of at least one hotspot.</span></li>
<li><a name="a370"></a></span><span class="src-str">     */</span></li>
<li><a name="a371"></a></span><span class="src-str">    <span class="src-key">public</span> <span class="src-key">function</span> <span class="src-id">isOwner</span><span class="src-sym">(</span><span class="src-sym">)</span></span></li>
<li><a name="a372"></a></span><span class="src-str">    <span class="src-sym">{</span></span></li>
<li><a name="a373"></a></span><span class="src-str">        <span class="src-key">global</span> <span class="src-var">$db</span><span class="src-sym">;</span></span></li>
<li><a name="a374"></a></span><span class="src-str">        <span class="src-var">$db</span></span><span class="src-sym">-&gt;</span><span class="src-id">ExecSqlUniqueRes</span><span class="src-sym">(</span><span class="src-str"></span><span class="src-str">"</span><span class="src-id">SELECT</span> * <span class="src-id">FROM</span> <span class="src-id">node_stakeholders</span> <span class="src-id">WHERE</span> <span class="src-id">is_owner</span> = <span class="src-id">true</span> <span class="src-id">AND</span> <span class="src-id">user_id</span>='</span>{<span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#methodgetId">getId</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-str"></span><span class="src-sym">}</span>'<span class="src-str">"</span><span class="src-sym">,</span> <span class="src-var">$row</span><span class="src-sym">,</span> <span class="src-id">false</span><span class="src-sym">)</span><span class="src-sym">;</span></span></li>
<li><a name="a375"></a></span><span class="src-str">        <span class="src-key">if</span> <span class="src-sym">(</span><span class="src-var">$row</span> != <span class="src-id">null</span><span class="src-sym">)</span></span></li>
<li><a name="a376"></a></span><span class="src-str">            <span class="src-key">return</span> <span class="src-id">true</span><span class="src-sym">;</span></span></li>
<li><a name="a377"></a></span><span class="src-str">        <span class="src-key">return</span> <span class="src-id">false</span><span class="src-sym">;</span></span></li>
<li><a name="a378"></a>&nbsp;</li>
<li><a name="a379"></a></span><span class="src-str">    <span class="src-sym">}</span></span></li>
<li><a name="a380"></a>&nbsp;</li>
<li><a name="a381"></a></span><span class="src-str">    <span class="src-key">public</span> <span class="src-key">function</span> <span class="src-id">isNobody</span><span class="src-sym">(</span><span class="src-sym">)</span></span></li>
<li><a name="a382"></a></span><span class="src-str">    <span class="src-sym">{</span></span></li>
<li><a name="a383"></a></span><span class="src-str">        <span class="src-key">global</span> <span class="src-var">$db</span><span class="src-sym">;</span></span></li>
<li><a name="a384"></a></span><span class="src-str">        <span class="src-var">$db</span></span><span class="src-sym">-&gt;</span><span class="src-id">ExecSqlUniqueRes</span><span class="src-sym">(</span><span class="src-str"></span><span class="src-str">"</span><span class="src-id">SELECT</span> <span class="src-id">DISTINCT</span> <span class="src-id">user_id</span> <span class="src-id">FROM</span> (<span class="src-id">SELECT</span> <span class="src-id">user_id</span> <span class="src-id">FROM</span> <span class="src-id">network_stakeholders</span> <span class="src-id">WHERE</span> <span class="src-id">user_id</span>='</span>{<span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#methodgetId">getId</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-str"></span><span class="src-sym">}</span>' <span class="src-id">UNION</span> <span class="src-id">SELECT</span> <span class="src-id">user_id</span> <span class="src-id">FROM</span> <span class="src-id">node_stakeholders</span> <span class="src-id">WHERE</span> <span class="src-id">user_id</span>='</span>{<span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#methodgetId">getId</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-str"></span><span class="src-sym">}</span>' <span class="src-id">UNION</span> <span class="src-id">SELECT</span> <span class="src-id">user_id</span> <span class="src-id">FROM</span> <span class="src-id">administrators</span> <span class="src-id">WHERE</span> <span class="src-id">user_id</span>='</span>{<span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#methodgetId">getId</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-str"></span><span class="src-sym">}</span>') <span class="src-id">as</span> <span class="src-id">tmp</span><span class="src-str">"</span><span class="src-sym">,</span> <span class="src-var">$row</span><span class="src-sym">,</span> <span class="src-id">false</span><span class="src-sym">)</span><span class="src-sym">;</span></span></li>
<li><a name="a385"></a></span><span class="src-str">        <span class="src-key">if</span> <span class="src-sym">(</span><span class="src-var">$row</span> == <span class="src-id">null</span><span class="src-sym">)</span></span></li>
<li><a name="a386"></a></span><span class="src-str">            <span class="src-key">return</span> <span class="src-id">true</span><span class="src-sym">;</span></span></li>
<li><a name="a387"></a></span><span class="src-str">        <span class="src-key">return</span> <span class="src-id">false</span><span class="src-sym">;</span></span></li>
<li><a name="a388"></a></span><span class="src-str">    <span class="src-sym">}</span></span></li>
<li><a name="a389"></a>&nbsp;</li>
<li><a name="a390"></a></span><span class="src-str">    <span class="src-key">function</span> <span class="src-id">getValidationToken</span><span class="src-sym">(</span><span class="src-sym">)</span></span></li>
<li><a name="a391"></a></span><span class="src-str">    <span class="src-sym">{</span></span></li>
<li><a name="a392"></a></span><span class="src-str">        <span class="src-key">return</span> <span class="src-var">$this</span></span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#var$mRow">mRow</a><span class="src-sym">[</span><span class="src-str">'validation_token'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a393"></a>    </span><span class="src-str"><span class="src-sym">}</span></span></li>
<li><a name="a394"></a>&nbsp;</li>
<li><a name="a395"></a></span><span class="src-str">    /** Generate a token in the connection table so the user can actually use the internet</span></li>
<li><a name="a396"></a></span><span class="src-str">    @return true on success, false on failure</span></li>
<li><a name="a397"></a></span><span class="src-str">    */</span></li>
<li><a name="a398"></a></span><span class="src-str">    <span class="src-key">function</span> <span class="src-id">generateConnectionToken</span><span class="src-sym">(</span><span class="src-sym">)</span></span></li>
<li><a name="a399"></a></span><span class="src-str">    <span class="src-sym">{</span></span></li>
<li><a name="a400"></a></span><span class="src-str">        <span class="src-key">if</span> <span class="src-sym">(</span><span class="src-var">$this</span></span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#methodisUserValid">isUserValid</a><span class="src-sym">(</span><span class="src-sym">))</span></li>
<li><a name="a401"></a>        </span><span class="src-str"><span class="src-sym">{</span></span></li>
<li><a name="a402"></a></span><span class="src-str">            <span class="src-key">global</span> <span class="src-var">$db</span><span class="src-sym">;</span></span></li>
<li><a name="a403"></a></span><span class="src-str">            <span class="src-key">global</span> <span class="src-var">$session</span><span class="src-sym">;</span></span></li>
<li><a name="a404"></a>&nbsp;</li>
<li><a name="a405"></a></span><span class="src-str">            <span class="src-var">$token</span> = <span class="src-id">self</span> <span class="src-sym">::</span> <span class="src-id">generateToken</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></span></li>
<li><a name="a406"></a></span><span class="src-str">            <span class="src-key">if</span> <span class="src-sym">(</span><span class="src-var">$_SERVER</span><span class="src-sym">[</span><span class="src-str">'REMOTE_ADDR'</span><span class="src-sym">]</span><span class="src-sym">)</span></span></li>
<li><a name="a407"></a></span><span class="src-str">            <span class="src-sym">{</span></span></li>
<li><a name="a408"></a></span><span class="src-str">                <span class="src-var">$node_ip</span> = <span class="src-var">$db</span></span><span class="src-sym">-&gt;</span><span class="src-id">EscapeString</span><span class="src-sym">(</span><span class="src-var">$_SERVER</span><span class="src-sym">[</span><span class="src-str">'REMOTE_ADDR'</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a409"></a>            </span><span class="src-str"><span class="src-sym">}</span></span></li>
<li><a name="a410"></a>&nbsp;</li>
<li><a name="a411"></a></span><span class="src-str">            <span class="src-key">if</span> <span class="src-sym">(</span><span class="src-var">$session</span> &amp;&amp; <span class="src-var">$node_ip</span> &amp;&amp; <span class="src-var">$session</span></span><span class="src-sym">-&gt;</span><span class="src-id">get</span><span class="src-sym">(</span><span class="src-id">SESS_GW_ID_VAR</span><span class="src-sym">))</span></li>
<li><a name="a412"></a>            </span><span class="src-str"><span class="src-sym">{</span></span></li>
<li><a name="a413"></a></span><span class="src-str">                <span class="src-var">$node_id</span> = <span class="src-var">$db</span></span><span class="src-sym">-&gt;</span><span class="src-id">EscapeString</span><span class="src-sym">(</span><span class="src-var">$session</span><span class="src-sym">-&gt;</span><span class="src-id">get</span><span class="src-sym">(</span><span class="src-id">SESS_GW_ID_VAR</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a414"></a>                <span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">ExecSqlUpdate</span><span class="src-sym">(</span><span class="src-str">&quot;INSERT INTO connections (user_id, token, token_status, timestamp_in, node_id, node_ip, last_updated) VALUES ('&quot;</span>.<span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#methodgetId">getId</a><span class="src-sym">(</span><span class="src-sym">)</span>.</span><span class="src-str"><span class="src-str">"</span>', '<span class="src-var">$token</span>', '<span class="src-str">"</span>.<span class="src-id">TOKEN_UNUSED</span>.<span class="src-str">"</span>', <span class="src-id">NOW</span>(), '<span class="src-var">$node_id</span>', '<span class="src-var">$node_ip</span>', <span class="src-id">NOW</span>())<span class="src-str">"</span><span class="src-sym">,</span> <span class="src-id">false</span><span class="src-sym">)</span><span class="src-sym">;</span></span></li>
<li><a name="a415"></a></span><span class="src-str">                <span class="src-var">$retval</span> = <span class="src-var">$token</span><span class="src-sym">;</span></span></li>
<li><a name="a416"></a></span><span class="src-str">            <span class="src-sym">}</span></span></li>
<li><a name="a417"></a></span><span class="src-str">            <span class="src-key">else</span></span></li>
<li><a name="a418"></a></span><span class="src-str">                <span class="src-var">$retval</span> = <span class="src-id">false</span><span class="src-sym">;</span></span></li>
<li><a name="a419"></a></span><span class="src-str">        <span class="src-sym">}</span></span></li>
<li><a name="a420"></a></span><span class="src-str">        <span class="src-key">else</span></span></li>
<li><a name="a421"></a></span><span class="src-str">        <span class="src-sym">{</span></span></li>
<li><a name="a422"></a></span><span class="src-str">            <span class="src-var">$retval</span> = <span class="src-id">false</span><span class="src-sym">;</span></span></li>
<li><a name="a423"></a></span><span class="src-str">        <span class="src-sym">}</span></span></li>
<li><a name="a424"></a></span><span class="src-str">        <span class="src-key">return</span> <span class="src-var">$retval</span><span class="src-sym">;</span></span></li>
<li><a name="a425"></a></span><span class="src-str">    <span class="src-sym">}</span></span></li>
<li><a name="a426"></a>&nbsp;</li>
<li><a name="a427"></a></span><span class="src-str">    <span class="src-key">function</span> <span class="src-id">setPassword</span><span class="src-sym">(</span><span class="src-var">$password</span><span class="src-sym">)</span></span></li>
<li><a name="a428"></a></span><span class="src-str">    <span class="src-sym">{</span></span></li>
<li><a name="a429"></a></span><span class="src-str">        <span class="src-key">global</span> <span class="src-var">$db</span><span class="src-sym">;</span></span></li>
<li><a name="a430"></a>&nbsp;</li>
<li><a name="a431"></a></span><span class="src-str">        <span class="src-var">$new_password_hash</span> = <span class="src-id">User</span> <span class="src-sym">::</span> <span class="src-id">passwordHash</span><span class="src-sym">(</span><span class="src-var">$password</span><span class="src-sym">)</span><span class="src-sym">;</span></span></li>
<li><a name="a432"></a></span><span class="src-str">        <span class="src-key">if</span> <span class="src-sym">(</span><span class="src-sym">!</span><span class="src-sym">(</span><span class="src-var">$update</span> = <span class="src-var">$db</span></span><span class="src-sym">-&gt;</span><span class="src-id">ExecSqlUpdate</span><span class="src-sym">(</span><span class="src-str"></span><span class="src-str">"</span><span class="src-id">UPDATE</span> <span class="src-id">users</span> <span class="src-id">SET</span> <span class="src-id">pass</span>='<span class="src-var">$new_password_hash</span>' <span class="src-id">WHERE</span> <span class="src-id">user_id</span>='</span>{<span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#var$id">id</a><span class="src-sym">}</span>'</span><span class="src-str"><span class="src-str">"</span><span class="src-sym">)))</span></span></li>
<li><a name="a433"></a></span><span class="src-str">        <span class="src-sym">{</span></span></li>
<li><a name="a434"></a></span><span class="src-str">            throw <span class="src-key">new</span> <span class="src-id">Exception</span><span class="src-sym">(</span><span class="src-id">_</span><span class="src-sym">(</span><span class="src-str">&quot;Could not change user's password.&quot;</span><span class="src-sym">))</span><span class="src-sym">;</span></span></li>
<li><a name="a435"></a></span><span class="src-str">        <span class="src-sym">}</span></span></li>
<li><a name="a436"></a></span><span class="src-str">        <span class="src-var">$this</span></span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#var$mRow">mRow</a><span class="src-sym">[</span><span class="src-str">'pass'</span><span class="src-sym">] </span>= <span class="src-var">$password</span><span class="src-sym">;</span></li>
<li><a name="a437"></a>    </span><span class="src-str"><span class="src-sym">}</span></span></li>
<li><a name="a438"></a>&nbsp;</li>
<li><a name="a439"></a></span><span class="src-str">    <span class="src-key">function</span> <span class="src-id">getAccountOrigin</span><span class="src-sym">(</span><span class="src-sym">)</span></span></li>
<li><a name="a440"></a></span><span class="src-str">    <span class="src-sym">{</span></span></li>
<li><a name="a441"></a></span><span class="src-str">        <span class="src-key">return</span> <span class="src-var">$this</span></span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#var$mRow">mRow</a><span class="src-sym">[</span><span class="src-str">'account_origin'</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a442"></a>    </span><span class="src-str"><span class="src-sym">}</span></span></li>
<li><a name="a443"></a>&nbsp;</li>
<li><a name="a444"></a></span><span class="src-str">    /** Return all the users</span></li>
<li><a name="a445"></a></span><span class="src-str">     */</span></li>
<li><a name="a446"></a></span><span class="src-str">    <span class="src-key">static</span> <span class="src-key">function</span> <span class="src-id">getAllUsers</span><span class="src-sym">(</span><span class="src-sym">)</span></span></li>
<li><a name="a447"></a></span><span class="src-str">    <span class="src-sym">{</span></span></li>
<li><a name="a448"></a></span><span class="src-str">        <span class="src-key">global</span> <span class="src-var">$db</span><span class="src-sym">;</span></span></li>
<li><a name="a449"></a>&nbsp;</li>
<li><a name="a450"></a></span><span class="src-str">        <span class="src-var">$db</span></span><span class="src-sym">-&gt;</span><span class="src-id">ExecSql</span><span class="src-sym">(</span><span class="src-str">&quot;SELECT * FROM users&quot;</span><span class="src-sym">, </span><span class="src-var">$objects</span><span class="src-sym">, </span><span class="src-id">false</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a451"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$objects </span>== <span class="src-id">null</span><span class="src-sym">)</span></li>
<li><a name="a452"></a>        </span><span class="src-str"><span class="src-sym">{</span></span></li>
<li><a name="a453"></a></span><span class="src-str">            throw <span class="src-key">new</span> <span class="src-id">Exception</span><span class="src-sym">(</span><span class="src-id">_</span><span class="src-sym">(</span><span class="src-str">&quot;No users could not be found in the database&quot;</span><span class="src-sym">))</span><span class="src-sym">;</span></span></li>
<li><a name="a454"></a></span><span class="src-str">        <span class="src-sym">}</span></span></li>
<li><a name="a455"></a></span><span class="src-str">        <span class="src-key">return</span> <span class="src-var">$objects</span><span class="src-sym">;</span></span></li>
<li><a name="a456"></a></span><span class="src-str">    <span class="src-sym">}</span></span></li>
<li><a name="a457"></a>&nbsp;</li>
<li><a name="a458"></a></span><span class="src-str">    <span class="src-key">function</span> <span class="src-id">sendLostUsername</span><span class="src-sym">(</span><span class="src-sym">)</span></span></li>
<li><a name="a459"></a></span><span class="src-str">    <span class="src-sym">{</span></span></li>
<li><a name="a460"></a></span><span class="src-str">        <span class="src-var">$network</span> = <span class="src-var">$this</span></span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#methodgetNetwork">getNetwork</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a461"></a>        <span class="src-var">$mail </span>= <span class="src-key">new </span><span class="src-id">Mail</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a462"></a>        <span class="src-var">$mail</span><span class="src-sym">-&gt;</span><span class="src-id">setSenderName</span><span class="src-sym">(</span><span class="src-id">_</span><span class="src-sym">(</span><span class="src-str">&quot;Registration system&quot;</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a463"></a>        <span class="src-var">$mail</span><span class="src-sym">-&gt;</span><span class="src-id">setSenderEmail</span><span class="src-sym">(</span><span class="src-var">$network</span><span class="src-sym">-&gt;</span><span class="src-id">getValidationEmailFromAddress</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a464"></a>        <span class="src-var">$mail</span><span class="src-sym">-&gt;</span><span class="src-id">setRecipientEmail</span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#methodgetEmail">getEmail</a><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a465"></a>        <span class="src-var">$mail</span><span class="src-sym">-&gt;</span><span class="src-id">setMessageSubject</span><span class="src-sym">(</span><span class="src-var">$network</span><span class="src-sym">-&gt;</span><span class="src-id">getName</span><span class="src-sym">(</span><span class="src-sym">)</span>.<span class="src-id">_</span><span class="src-sym">(</span><span class="src-str">&quot; lost username request&quot;</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a466"></a>        <span class="src-var">$mail</span><span class="src-sym">-&gt;</span><span class="src-id">setMessageBody</span><span class="src-sym">(</span><span class="src-id">_</span><span class="src-sym">(</span><span class="src-str">&quot;Hello,\nYou have requested that the authentication server send you your username:\nUsername: &quot;</span><span class="src-sym">)</span>.<span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#methodgetUsername">getUsername</a><span class="src-sym">(</span><span class="src-sym">)</span>.<span class="src-id">_</span><span class="src-sym">(</span><span class="src-str">&quot;\n\nHave a nice day,\nThe Team&quot;</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a467"></a>        <span class="src-var">$mail</span><span class="src-sym">-&gt;</span><span class="src-id">send</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a468"></a>    </span><span class="src-str"><span class="src-sym">}</span></span></li>
<li><a name="a469"></a>&nbsp;</li>
<li><a name="a470"></a></span><span class="src-str">    <span class="src-key">function</span> <span class="src-id">sendValidationEmail</span><span class="src-sym">(</span><span class="src-sym">)</span></span></li>
<li><a name="a471"></a></span><span class="src-str">    <span class="src-sym">{</span></span></li>
<li><a name="a472"></a></span><span class="src-str">        <span class="src-key">if</span> <span class="src-sym">(</span><span class="src-var">$this</span></span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#methodgetAccountStatus">getAccountStatus</a><span class="src-sym">(</span><span class="src-sym">) </span>!= <span class="src-id">ACCOUNT_STATUS_VALIDATION</span><span class="src-sym">)</span></li>
<li><a name="a473"></a>        </span><span class="src-str"><span class="src-sym">{</span></span></li>
<li><a name="a474"></a></span><span class="src-str">            throw <span class="src-key">new</span> <span class="src-id">Exception</span><span class="src-sym">(</span><span class="src-id">_</span><span class="src-sym">(</span><span class="src-str">&quot;The user is not in validation period.&quot;</span><span class="src-sym">))</span><span class="src-sym">;</span></span></li>
<li><a name="a475"></a></span><span class="src-str">        <span class="src-sym">}</span></span></li>
<li><a name="a476"></a></span><span class="src-str">        <span class="src-key">else</span></span></li>
<li><a name="a477"></a></span><span class="src-str">        <span class="src-sym">{</span></span></li>
<li><a name="a478"></a></span><span class="src-str">            <span class="src-key">if</span> <span class="src-sym">(</span><span class="src-var">$this</span></span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#methodgetValidationToken">getValidationToken</a><span class="src-sym">(</span><span class="src-sym">) </span>== <span class="src-str">&quot;&quot;</span><span class="src-sym">)</span></li>
<li><a name="a479"></a>            </span><span class="src-str"><span class="src-sym">{</span></span></li>
<li><a name="a480"></a></span><span class="src-str">                throw <span class="src-key">new</span> <span class="src-id">Exception</span><span class="src-sym">(</span><span class="src-id">_</span><span class="src-sym">(</span><span class="src-str">&quot;The validation token is empty.&quot;</span><span class="src-sym">))</span><span class="src-sym">;</span></span></li>
<li><a name="a481"></a></span><span class="src-str">            <span class="src-sym">}</span></span></li>
<li><a name="a482"></a></span><span class="src-str">            <span class="src-key">else</span></span></li>
<li><a name="a483"></a></span><span class="src-str">            <span class="src-sym">{</span></span></li>
<li><a name="a484"></a></span><span class="src-str">                <span class="src-var">$network</span> = <span class="src-var">$this</span></span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#methodgetNetwork">getNetwork</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a485"></a>&nbsp;</li>
<li><a name="a486"></a>                <span class="src-var">$mail </span>= <span class="src-key">new </span><span class="src-id">Mail</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a487"></a>                <span class="src-var">$mail</span><span class="src-sym">-&gt;</span><span class="src-id">setSenderName</span><span class="src-sym">(</span><span class="src-id">_</span><span class="src-sym">(</span><span class="src-str">&quot;Registration system&quot;</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a488"></a>                <span class="src-var">$mail</span><span class="src-sym">-&gt;</span><span class="src-id">setSenderEmail</span><span class="src-sym">(</span><span class="src-var">$network</span><span class="src-sym">-&gt;</span><span class="src-id">getValidationEmailFromAddress</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a489"></a>                <span class="src-var">$mail</span><span class="src-sym">-&gt;</span><span class="src-id">setRecipientEmail</span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#methodgetEmail">getEmail</a><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a490"></a>                <span class="src-var">$mail</span><span class="src-sym">-&gt;</span><span class="src-id">setMessageSubject</span><span class="src-sym">(</span><span class="src-var">$network</span><span class="src-sym">-&gt;</span><span class="src-id">getName</span><span class="src-sym">(</span><span class="src-sym">)</span>.<span class="src-id">_</span><span class="src-sym">(</span><span class="src-str">&quot; new user validation&quot;</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a491"></a>                <span class="src-var">$url </span>= <span class="src-str">&quot;http://&quot;</span>.<span class="src-var">$_SERVER</span><span class="src-sym">[</span><span class="src-str">&quot;SERVER_NAME&quot;</span><span class="src-sym">]</span>.<span class="src-str">&quot;/validate.php?user_id=&quot;</span>.<span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#methodgetId">getId</a><span class="src-sym">(</span><span class="src-sym">)</span>.<span class="src-str">&quot;&amp;token=&quot;</span>.<span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#methodgetValidationToken">getValidationToken</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a492"></a>                <span class="src-var">$mail</span><span class="src-sym">-&gt;</span><span class="src-id">setMessageBody</span><span class="src-sym">(</span><span class="src-id">_</span><span class="src-sym">(</span><span class="src-str">&quot;Hello,\nPlease follow the link below to validate your account.\n&quot;</span><span class="src-sym">)</span>.<span class="src-var">$url</span>.<span class="src-id">_</span><span class="src-sym">(</span><span class="src-str">&quot;\n\nThank you,\nThe Team.&quot;</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a493"></a>                <span class="src-var">$mail</span><span class="src-sym">-&gt;</span><span class="src-id">send</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a494"></a>            </span><span class="src-str"><span class="src-sym">}</span></span></li>
<li><a name="a495"></a></span><span class="src-str">        <span class="src-sym">}</span></span></li>
<li><a name="a496"></a></span><span class="src-str">    <span class="src-sym">}</span></span></li>
<li><a name="a497"></a>&nbsp;</li>
<li><a name="a498"></a></span><span class="src-str">    <span class="src-key">function</span> <span class="src-id">sendLostPasswordEmail</span><span class="src-sym">(</span><span class="src-sym">)</span></span></li>
<li><a name="a499"></a></span><span class="src-str">    <span class="src-sym">{</span></span></li>
<li><a name="a500"></a></span><span class="src-str">        <span class="src-var">$network</span> = <span class="src-var">$this</span></span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#methodgetNetwork">getNetwork</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a501"></a>        <span class="src-var">$new_password </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#methodrandomPass">randomPass</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a502"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#methodsetPassword">setPassword</a><span class="src-sym">(</span><span class="src-var">$new_password</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a503"></a>&nbsp;</li>
<li><a name="a504"></a>        <span class="src-var">$mail </span>= <span class="src-key">new </span><span class="src-id">Mail</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a505"></a>        <span class="src-var">$mail</span><span class="src-sym">-&gt;</span><span class="src-id">setSenderName</span><span class="src-sym">(</span><span class="src-id">_</span><span class="src-sym">(</span><span class="src-str">&quot;Registration system&quot;</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a506"></a>        <span class="src-var">$mail</span><span class="src-sym">-&gt;</span><span class="src-id">setSenderEmail</span><span class="src-sym">(</span><span class="src-var">$network</span><span class="src-sym">-&gt;</span><span class="src-id">getValidationEmailFromAddress</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a507"></a>        <span class="src-var">$mail</span><span class="src-sym">-&gt;</span><span class="src-id">setRecipientEmail</span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#methodgetEmail">getEmail</a><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a508"></a>        <span class="src-var">$mail</span><span class="src-sym">-&gt;</span><span class="src-id">setMessageSubject</span><span class="src-sym">(</span><span class="src-var">$network</span><span class="src-sym">-&gt;</span><span class="src-id">getName</span><span class="src-sym">(</span><span class="src-sym">)</span>.<span class="src-id">_</span><span class="src-sym">(</span><span class="src-str">&quot; new password request&quot;</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a509"></a>        <span class="src-var">$mail</span><span class="src-sym">-&gt;</span><span class="src-id">setMessageBody</span><span class="src-sym">(</span><span class="src-id">_</span><span class="src-sym">(</span><span class="src-str">&quot;Hello,\nYou have requested that the authentication server send you a new password:\nUsername: &quot;</span><span class="src-sym">)</span>.<span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#methodgetUsername">getUsername</a><span class="src-sym">(</span><span class="src-sym">)</span>.<span class="src-id">_</span><span class="src-sym">(</span><span class="src-str">&quot;\nPassword: &quot;</span><span class="src-sym">)</span>.<span class="src-var">$new_password</span>.<span class="src-id">_</span><span class="src-sym">(</span><span class="src-str">&quot;\n\nHave a nice day,\nThe Team&quot;</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a510"></a>        <span class="src-var">$mail</span><span class="src-sym">-&gt;</span><span class="src-id">send</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a511"></a>    </span><span class="src-str"><span class="src-sym">}</span></span></li>
<li><a name="a512"></a>&nbsp;</li>
<li><a name="a513"></a></span><span class="src-str">    <span class="src-key">static</span> <span class="src-key">function</span> <span class="src-id">userExists</span><span class="src-sym">(</span><span class="src-var">$id</span><span class="src-sym">)</span></span></li>
<li><a name="a514"></a></span><span class="src-str">    <span class="src-sym">{</span></span></li>
<li><a name="a515"></a></span><span class="src-str">        <span class="src-key">global</span> <span class="src-var">$db</span><span class="src-sym">;</span></span></li>
<li><a name="a516"></a></span><span class="src-str">        <span class="src-var">$id_str</span> = <span class="src-var">$db</span></span><span class="src-sym">-&gt;</span><span class="src-id">EscapeString</span><span class="src-sym">(</span><span class="src-var">$id</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a517"></a>        <span class="src-var">$sql </span>= </span><span class="src-str"><span class="src-str">"</span><span class="src-id">SELECT</span> * <span class="src-id">FROM</span> <span class="src-id">users</span> <span class="src-id">WHERE</span> <span class="src-id">user_id</span>='</span>{<span class="src-var">$id_str</span><span class="src-str"></span><span class="src-sym">}</span>'<span class="src-str">"</span><span class="src-sym">;</span></span></li>
<li><a name="a518"></a></span><span class="src-str">        <span class="src-var">$db</span></span><span class="src-sym">-&gt;</span><span class="src-id">ExecSqlUniqueRes</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">, </span><span class="src-var">$row</span><span class="src-sym">, </span><span class="src-id">false</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a519"></a>        <span class="src-key">return </span><span class="src-var">$row</span><span class="src-sym">;</span></li>
<li><a name="a520"></a>    </span><span class="src-str"><span class="src-sym">}</span></span></li>
<li><a name="a521"></a>&nbsp;</li>
<li><a name="a522"></a></span><span class="src-str">    <span class="src-key">public</span> <span class="src-key">static</span> <span class="src-key">function</span> <span class="src-id">emailExists</span><span class="src-sym">(</span><span class="src-var">$id</span><span class="src-sym">)</span></span></li>
<li><a name="a523"></a></span><span class="src-str">    <span class="src-sym">{</span></span></li>
<li><a name="a524"></a></span><span class="src-str">        <span class="src-key">global</span> <span class="src-var">$db</span><span class="src-sym">;</span></span></li>
<li><a name="a525"></a></span><span class="src-str">        <span class="src-var">$id_str</span> = <span class="src-var">$db</span></span><span class="src-sym">-&gt;</span><span class="src-id">EscapeString</span><span class="src-sym">(</span><span class="src-var">$id</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a526"></a>        <span class="src-var">$sql </span>= </span><span class="src-str"><span class="src-str">"</span><span class="src-id">SELECT</span> * <span class="src-id">FROM</span> <span class="src-id">users</span> <span class="src-id">WHERE</span> <span class="src-id">email</span>='</span>{<span class="src-var">$id_str</span><span class="src-str"></span><span class="src-sym">}</span>'<span class="src-str">"</span><span class="src-sym">;</span></span></li>
<li><a name="a527"></a></span><span class="src-str">        <span class="src-var">$db</span></span><span class="src-sym">-&gt;</span><span class="src-id">ExecSqlUniqueRes</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">, </span><span class="src-var">$row</span><span class="src-sym">, </span><span class="src-id">false</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a528"></a>        <span class="src-key">return </span><span class="src-var">$row</span><span class="src-sym">;</span></li>
<li><a name="a529"></a>    </span><span class="src-str"><span class="src-sym">}</span></span></li>
<li><a name="a530"></a>&nbsp;</li>
<li><a name="a531"></a></span><span class="src-str">    <span class="src-key">public</span> <span class="src-key">static</span> <span class="src-key">function</span> <span class="src-id">randomPass</span><span class="src-sym">(</span><span class="src-sym">)</span></span></li>
<li><a name="a532"></a></span><span class="src-str">    <span class="src-sym">{</span></span></li>
<li><a name="a533"></a></span><span class="src-str">        <span class="src-var">$rand_pass</span> = <span class="src-str">''</span><span class="src-sym">;</span> <span class="src-comm">// makes sure the $pass var is empty.</span></span></li>
<li><a name="a534"></a></span><span class="src-str"><span class="src-comm"></span>        <span class="src-key">for</span> <span class="src-sym">(</span><span class="src-var">$j</span> = <span class="src-num">0</span><span class="src-sym">;</span> <span class="src-var">$j</span> < <span class="src-num">3</span><span class="src-sym">;</span> <span class="src-var">$j</span> ++<span class="src-sym">)</span></span></li>
<li><a name="a535"></a></span><span class="src-str">        <span class="src-sym">{</span></span></li>
<li><a name="a536"></a></span><span class="src-str">            <span class="src-var">$startnend</span> = <span class="src-key">array</span> <span class="src-sym">(</span><span class="src-str">'b'</span><span class="src-sym">,</span> <span class="src-str">'c'</span><span class="src-sym">,</span> <span class="src-str">'d'</span><span class="src-sym">,</span> <span class="src-str">'f'</span><span class="src-sym">,</span> <span class="src-str">'g'</span><span class="src-sym">,</span> <span class="src-str">'h'</span><span class="src-sym">,</span> <span class="src-str">'j'</span><span class="src-sym">,</span> <span class="src-str">'k'</span><span class="src-sym">,</span> <span class="src-str">'l'</span><span class="src-sym">,</span> <span class="src-str">'m'</span><span class="src-sym">,</span> <span class="src-str">'n'</span><span class="src-sym">,</span> <span class="src-str">'p'</span><span class="src-sym">,</span> <span class="src-str">'q'</span><span class="src-sym">,</span> <span class="src-str">'r'</span><span class="src-sym">,</span> <span class="src-str">'s'</span><span class="src-sym">,</span> <span class="src-str">'t'</span><span class="src-sym">,</span> <span class="src-str">'v'</span><span class="src-sym">,</span> <span class="src-str">'w'</span><span class="src-sym">,</span> <span class="src-str">'x'</span><span class="src-sym">,</span> <span class="src-str">'y'</span><span class="src-sym">,</span> <span class="src-str">'z'</span><span class="src-sym">,</span><span class="src-sym">)</span><span class="src-sym">;</span></span></li>
<li><a name="a537"></a></span><span class="src-str">            <span class="src-var">$id</span> = <span class="src-key">array</span> <span class="src-sym">(</span><span class="src-str">'a'</span><span class="src-sym">,</span> <span class="src-str">'e'</span><span class="src-sym">,</span> <span class="src-str">'i'</span><span class="src-sym">,</span> <span class="src-str">'o'</span><span class="src-sym">,</span> <span class="src-str">'u'</span><span class="src-sym">,</span> <span class="src-str">'y'</span><span class="src-sym">,</span><span class="src-sym">)</span><span class="src-sym">;</span></span></li>
<li><a name="a538"></a></span><span class="src-str">            <span class="src-var">$count1</span> = <span class="src-id">count</span><span class="src-sym">(</span><span class="src-var">$startnend</span><span class="src-sym">)</span> - <span class="src-num">1</span><span class="src-sym">;</span></span></li>
<li><a name="a539"></a></span><span class="src-str">            <span class="src-var">$count2</span> = <span class="src-id">count</span><span class="src-sym">(</span><span class="src-var">$id</span><span class="src-sym">)</span> - <span class="src-num">1</span><span class="src-sym">;</span></span></li>
<li><a name="a540"></a>&nbsp;</li>
<li><a name="a541"></a></span><span class="src-str">            <span class="src-key">for</span> <span class="src-sym">(</span><span class="src-var">$i</span> = <span class="src-num">0</span><span class="src-sym">;</span> <span class="src-var">$i</span> < <span class="src-num">3</span><span class="src-sym">;</span> <span class="src-var">$i</span> ++<span class="src-sym">)</span></span></li>
<li><a name="a542"></a></span><span class="src-str">            <span class="src-sym">{</span></span></li>
<li><a name="a543"></a></span><span class="src-str">                <span class="src-key">if</span> <span class="src-sym">(</span><span class="src-var">$i</span> != <span class="src-num">1</span><span class="src-sym">)</span></span></li>
<li><a name="a544"></a></span><span class="src-str">                <span class="src-sym">{</span></span></li>
<li><a name="a545"></a></span><span class="src-str">                    <span class="src-var">$rand_pass</span> .= <span class="src-var">$startnend</span><span class="src-sym">[</span><span class="src-id">rand</span><span class="src-sym">(</span><span class="src-num">0</span><span class="src-sym">,</span> <span class="src-var">$count1</span><span class="src-sym">)</span><span class="src-sym">]</span><span class="src-sym">;</span></span></li>
<li><a name="a546"></a></span><span class="src-str">                <span class="src-sym">}</span></span></li>
<li><a name="a547"></a></span><span class="src-str">                <span class="src-key">else</span></span></li>
<li><a name="a548"></a></span><span class="src-str">                <span class="src-sym">{</span></span></li>
<li><a name="a549"></a></span><span class="src-str">                    <span class="src-var">$rand_pass</span> .= <span class="src-var">$id</span><span class="src-sym">[</span><span class="src-id">rand</span><span class="src-sym">(</span><span class="src-num">0</span><span class="src-sym">,</span> <span class="src-var">$count2</span><span class="src-sym">)</span><span class="src-sym">]</span><span class="src-sym">;</span></span></li>
<li><a name="a550"></a></span><span class="src-str">                <span class="src-sym">}</span></span></li>
<li><a name="a551"></a></span><span class="src-str">            <span class="src-sym">}</span></span></li>
<li><a name="a552"></a></span><span class="src-str">        <span class="src-sym">}</span></span></li>
<li><a name="a553"></a></span><span class="src-str">        <span class="src-key">return</span> <span class="src-var">$rand_pass</span><span class="src-sym">;</span></span></li>
<li><a name="a554"></a></span><span class="src-str">    <span class="src-sym">}</span></span></li>
<li><a name="a555"></a>&nbsp;</li>
<li><a name="a556"></a></span><span class="src-str">    <span class="src-key">public</span> <span class="src-key">static</span> <span class="src-key">function</span> <span class="src-id">generateToken</span><span class="src-sym">(</span><span class="src-sym">)</span></span></li>
<li><a name="a557"></a></span><span class="src-str">    <span class="src-sym">{</span></span></li>
<li><a name="a558"></a></span><span class="src-str">        <span class="src-key">return</span> <span class="src-id">md5</span><span class="src-sym">(</span><span class="src-id">uniqid</span><span class="src-sym">(</span><span class="src-id">rand</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">,</span> <span class="src-num">1</span><span class="src-sym">))</span><span class="src-sym">;</span></span></li>
<li><a name="a559"></a></span><span class="src-str">    <span class="src-sym">}</span></span></li>
<li><a name="a560"></a>&nbsp;</li>
<li><a name="a561"></a></span><span class="src-str">    /** Get an interface to add a user to a list</span></li>
<li><a name="a562"></a></span><span class="src-str">    * @param $user_prefix A identifier provided by the programmer to recognise it's generated html form</span></li>
<li><a name="a563"></a></span><span class="src-str">    * @return html markup</span></li>
<li><a name="a564"></a></span><span class="src-str">    */</span></li>
<li><a name="a565"></a></span><span class="src-str">    <span class="src-key">static</span> <span class="src-key">function</span> <span class="src-id">getSelectUserUI</span><span class="src-sym">(</span><span class="src-var">$user_prefix</span><span class="src-sym">)</span></span></li>
<li><a name="a566"></a></span><span class="src-str">    <span class="src-sym">{</span></span></li>
<li><a name="a567"></a></span><span class="src-str">        <span class="src-key">global</span> <span class="src-var">$db</span><span class="src-sym">;</span></span></li>
<li><a name="a568"></a></span><span class="src-str">        <span class="src-var">$html</span> = <span class="src-str">''</span><span class="src-sym">;</span></span></li>
<li><a name="a569"></a></span><span class="src-str">        <span class="src-var">$html</span> .= <span class="src-id">Network</span> <span class="src-sym">::</span> <span class="src-id">getSelectNetworkUI</span><span class="src-sym">(</span><span class="src-var">$user_prefix</span><span class="src-sym">)</span><span class="src-sym">;</span></span></li>
<li><a name="a570"></a></span><span class="src-str">        <span class="src-var">$html</span> .= <span class="src-str">&quot;&lt;br&gt;&quot;</span><span class="src-sym">;</span></span></li>
<li><a name="a571"></a></span><span class="src-str">        <span class="src-var">$name</span> = <span class="src-str">"</span><span class="src-id">select_user_</span></span>{<span class="src-var">$user_prefix</span><span class="src-str"></span><span class="src-sym">}</span><span class="src-id">_username</span><span class="src-str">"</span><span class="src-sym">;</span></span></li>
<li><a name="a572"></a></span><span class="src-str">        <span class="src-var">$html</span> .= <span class="src-id">_</span><span class="src-sym">(</span><span class="src-str">&quot;Username: &quot;</span><span class="src-sym">)</span>.<span class="src-str">&quot;\n&quot;</span><span class="src-sym">;</span></span></li>
<li><a name="a573"></a></span><span class="src-str">        <span class="src-var">$html</span> .= <span class="src-str">"</span>&lt;<span class="src-id">input</span> <span class="src-id">type</span>='<span class="src-id">text</span>' <span class="src-id">name</span>='<span class="src-var">$name</span>' <span class="src-id">value</span>=''&gt;\n<span class="src-str">"</span><span class="src-sym">;</span></span></li>
<li><a name="a574"></a></span><span class="src-str">        <span class="src-key">return</span> <span class="src-var">$html</span><span class="src-sym">;</span></span></li>
<li><a name="a575"></a></span><span class="src-str">    <span class="src-sym">}</span></span></li>
<li><a name="a576"></a>&nbsp;</li>
<li><a name="a577"></a></span><span class="src-str">    /** Get the selected user, IF one was selected and is valid</span></li>
<li><a name="a578"></a></span><span class="src-str">     * @param $user_prefix A identifier provided by the programmer to recognise it's generated form</span></li>
<li><a name="a579"></a></span><span class="src-str">     * @return the User object, or null if the user is invalid or none was selected</span></li>
<li><a name="a580"></a></span><span class="src-str">     */</span></li>
<li><a name="a581"></a></span><span class="src-str">    <span class="src-key">static</span> <span class="src-key">function</span> <span class="src-id">processSelectUserUI</span><span class="src-sym">(</span><span class="src-var">$user_prefix</span><span class="src-sym">)</span></span></li>
<li><a name="a582"></a></span><span class="src-str">    <span class="src-sym">{</span></span></li>
<li><a name="a583"></a></span><span class="src-str">        <span class="src-var">$object</span> = <span class="src-id">null</span><span class="src-sym">;</span></span></li>
<li><a name="a584"></a></span><span class="src-str">        try</span></li>
<li><a name="a585"></a></span><span class="src-str">        <span class="src-sym">{</span></span></li>
<li><a name="a586"></a></span><span class="src-str">            <span class="src-var">$network</span> = <span class="src-id">Network</span> <span class="src-sym">::</span> <span class="src-id">processSelectNetworkUI</span><span class="src-sym">(</span><span class="src-var">$user_prefix</span><span class="src-sym">)</span><span class="src-sym">;</span></span></li>
<li><a name="a587"></a></span><span class="src-str">            <span class="src-var">$name</span> = <span class="src-str">"</span><span class="src-id">select_user_</span></span>{<span class="src-var">$user_prefix</span><span class="src-str"></span><span class="src-sym">}</span><span class="src-id">_username</span><span class="src-str">"</span><span class="src-sym">;</span></span></li>
<li><a name="a588"></a></span><span class="src-str">            <span class="src-key">if</span> <span class="src-sym">(</span><span class="src-sym">!</span><span class="src-key">empty</span> <span class="src-sym">(</span><span class="src-var">$_REQUEST</span><span class="src-sym">[</span><span class="src-var">$name</span><span class="src-sym">]</span><span class="src-sym">))</span></span></li>
<li><a name="a589"></a></span><span class="src-str">            <span class="src-sym">{</span></span></li>
<li><a name="a590"></a></span><span class="src-str">                <span class="src-var">$username</span> = <span class="src-var">$_REQUEST</span><span class="src-sym">[</span><span class="src-var">$name</span><span class="src-sym">]</span><span class="src-sym">;</span></span></li>
<li><a name="a591"></a></span><span class="src-str">                <span class="src-key">return</span> <span class="src-id">self</span> <span class="src-sym">::</span> <span class="src-id">getUserByUsernameAndOrigin</span><span class="src-sym">(</span><span class="src-var">$username</span><span class="src-sym">,</span> <span class="src-var">$network</span><span class="src-sym">)</span><span class="src-sym">;</span></span></li>
<li><a name="a592"></a></span><span class="src-str">            <span class="src-sym">}</span></span></li>
<li><a name="a593"></a></span><span class="src-str">            <span class="src-key">else</span></span></li>
<li><a name="a594"></a></span><span class="src-str">                <span class="src-key">return</span> <span class="src-id">null</span><span class="src-sym">;</span></span></li>
<li><a name="a595"></a></span><span class="src-str">        <span class="src-sym">}</span></span></li>
<li><a name="a596"></a></span><span class="src-str">        catch <span class="src-sym">(</span><span class="src-id">Exception</span> <span class="src-var">$e</span><span class="src-sym">)</span></span></li>
<li><a name="a597"></a></span><span class="src-str">        <span class="src-sym">{</span></span></li>
<li><a name="a598"></a></span><span class="src-str">            <span class="src-key">return</span> <span class="src-id">null</span><span class="src-sym">;</span></span></li>
<li><a name="a599"></a></span><span class="src-str">        <span class="src-sym">}</span></span></li>
<li><a name="a600"></a></span><span class="src-str">    <span class="src-sym">}</span></span></li>
<li><a name="a601"></a>&nbsp;</li>
<li><a name="a602"></a></span><span class="src-str">    <span class="src-key">public</span> <span class="src-key">function</span> <span class="src-id">getAdminUI</span><span class="src-sym">(</span><span class="src-sym">)</span></span></li>
<li><a name="a603"></a></span><span class="src-str">    <span class="src-sym">{</span></span></li>
<li><a name="a604"></a></span><span class="src-str">        <span class="src-key">global</span> <span class="src-var">$db</span><span class="src-sym">;</span></span></li>
<li><a name="a605"></a></span><span class="src-str">        <span class="src-var">$html</span> = <span class="src-str">''</span><span class="src-sym">;</span></span></li>
<li><a name="a606"></a></span><span class="src-str">        <span class="src-var">$html</span> .= <span class="src-str">&quot;&lt;div class='admin_container'&gt;\n&quot;</span><span class="src-sym">;</span></span></li>
<li><a name="a607"></a></span><span class="src-str">        <span class="src-var">$html</span> .= <span class="src-str">&quot;&lt;div class='admin_class'&gt;User instance&lt;/div&gt;\n&quot;</span><span class="src-sym">;</span></span></li>
<li><a name="a608"></a>&nbsp;</li>
<li><a name="a609"></a></span><span class="src-str">        <span class="src-var">$html</span> .= <span class="src-str">&quot;&lt;div class='admin_section_container'&gt;\n&quot;</span><span class="src-sym">;</span></span></li>
<li><a name="a610"></a></span><span class="src-str">        <span class="src-var">$html</span> .= <span class="src-str">&quot;&lt;div class='admin_section_title'&gt;&quot;</span>.<span class="src-id">_</span><span class="src-sym">(</span><span class="src-str">&quot;Username&quot;</span><span class="src-sym">)</span>.<span class="src-str">&quot; : &lt;/div&gt;\n&quot;</span><span class="src-sym">;</span></span></li>
<li><a name="a611"></a></span><span class="src-str">        <span class="src-var">$html</span> .= <span class="src-str">&quot;&lt;div class='admin_section_data'&gt;\n&quot;</span><span class="src-sym">;</span></span></li>
<li><a name="a612"></a></span><span class="src-str">        <span class="src-comm">//$name = &quot;user_&quot;.$this-&gt;getId().&quot;_username&quot;;</span></span></li>
<li><a name="a613"></a></span><span class="src-str"><span class="src-comm"></span>        <span class="src-comm">//$html .= &quot;&lt;input type='text' name='$name' value='&quot;.htmlentities($this-&gt;getUsername()).&quot;' size=30 readonly&gt;\n&quot;;</span></span></li>
<li><a name="a614"></a></span><span class="src-str"><span class="src-comm"></span>        <span class="src-var">$html</span> .= <span class="src-var">$this</span></span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#methodgetUsername">getUsername</a><span class="src-sym">(</span><span class="src-sym">)</span>.<span class="src-str">&quot;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a615"></a>        <span class="src-var">$html </span>.= <span class="src-str">&quot;&lt;/div&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a616"></a>        <span class="src-var">$html </span>.= <span class="src-str">&quot;&lt;/div&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a617"></a>&nbsp;</li>
<li><a name="a618"></a>        <span class="src-comm">//TODO: implement this when Network abstraction is completed</span></li>
<li><a name="a619"></a>        <span class="src-comm">/*</span></li>
<li><a name="a620"></a><span class="src-comm">        $html .= &quot;&lt;div class='admin_section_container'&gt;\n&quot;;</span></li>
<li><a name="a621"></a><span class="src-comm">        $html .= &quot;&lt;div class='admin_section_title'&gt;&quot;._(&quot;Network&quot;).&quot; : &lt;/div&gt;\n&quot;;</span></li>
<li><a name="a622"></a><span class="src-comm">        $html .= &quot;&lt;div class='admin_section_data'&gt;\n&quot;;</span></li>
<li><a name="a623"></a><span class="src-comm">        $name = &quot;user_&quot;.$this-&gt;getId().&quot;_username&quot;;</span></li>
<li><a name="a624"></a><span class="src-comm">        // Show network name here</span></li>
<li><a name="a625"></a><span class="src-comm">        $html .= &quot;&lt;/div&gt;\n&quot;;</span></li>
<li><a name="a626"></a><span class="src-comm">        $html .= &quot;&lt;/div&gt;\n&quot;;*/</span></li>
<li><a name="a627"></a>&nbsp;</li>
<li><a name="a628"></a>        <span class="src-var">$html </span>.= <span class="src-str">&quot;&lt;div class='admin_section_container'&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a629"></a>        <span class="src-var">$html </span>.= <span class="src-str">&quot;&lt;div class='admin_section_title'&gt;&quot;</span>.<span class="src-id">_</span><span class="src-sym">(</span><span class="src-str">&quot;Real name&quot;</span><span class="src-sym">)</span>.<span class="src-str">&quot; : &lt;/div&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a630"></a>        <span class="src-var">$html </span>.= <span class="src-str">&quot;&lt;div class='admin_section_data'&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a631"></a>        <span class="src-var">$name </span>= <span class="src-str">&quot;user_&quot;</span>.<span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#methodgetId">getId</a><span class="src-sym">(</span><span class="src-sym">)</span>.<span class="src-str">&quot;_real_name&quot;</span><span class="src-sym">;</span></li>
<li><a name="a632"></a>        <span class="src-var">$html </span>.= </span><span class="src-str"><span class="src-str">"</span>&lt;<span class="src-id">input</span> <span class="src-id">type</span>='<span class="src-id">text</span>' <span class="src-id">name</span>='<span class="src-var">$name</span>' <span class="src-id">value</span>='<span class="src-str">"</span>.<span class="src-id">htmlentities</span><span class="src-sym">(</span><span class="src-var">$this</span></span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#methodgetRealName">getRealName</a><span class="src-sym">(</span><span class="src-sym">))</span>.<span class="src-str">&quot;' size=30 readonly&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a633"></a>        <span class="src-var">$html </span>.= <span class="src-str">&quot;&lt;/div&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a634"></a>        <span class="src-var">$html </span>.= <span class="src-str">&quot;&lt;/div&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a635"></a>&nbsp;</li>
<li><a name="a636"></a>        <span class="src-var">$html </span>.= <span class="src-str">&quot;&lt;div class='admin_section_container'&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a637"></a>        <span class="src-var">$html </span>.= <span class="src-str">&quot;&lt;div class='admin_section_title'&gt;&quot;</span>.<span class="src-id">_</span><span class="src-sym">(</span><span class="src-str">&quot;Website URL&quot;</span><span class="src-sym">)</span>.<span class="src-str">&quot; : &lt;/div&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a638"></a>        <span class="src-var">$html </span>.= <span class="src-str">&quot;&lt;div class='admin_section_data'&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a639"></a>        <span class="src-var">$name </span>= <span class="src-str">&quot;user_&quot;</span>.<span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#methodgetId">getId</a><span class="src-sym">(</span><span class="src-sym">)</span>.<span class="src-str">&quot;_website&quot;</span><span class="src-sym">;</span></li>
<li><a name="a640"></a>        <span class="src-var">$html </span>.= </span><span class="src-str"><span class="src-str">"</span>&lt;<span class="src-id">input</span> <span class="src-id">type</span>='<span class="src-id">text</span>' <span class="src-id">name</span>='<span class="src-var">$name</span>' <span class="src-id">value</span>='<span class="src-str">"</span>.<span class="src-id">htmlentities</span><span class="src-sym">(</span><span class="src-var">$this</span></span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#methodgetWebsiteURL">getWebsiteURL</a><span class="src-sym">(</span><span class="src-sym">))</span>.<span class="src-str">&quot;' size=30 readonly&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a641"></a>        <span class="src-var">$html </span>.= <span class="src-str">&quot;&lt;/div&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a642"></a>        <span class="src-var">$html </span>.= <span class="src-str">&quot;&lt;/div&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a643"></a>&nbsp;</li>
<li><a name="a644"></a>        <span class="src-var">$html </span>.= <span class="src-str">&quot;&lt;/div&gt;\n&quot;</span><span class="src-sym">;</span></li>
<li><a name="a645"></a>        <span class="src-key">return </span><span class="src-var">$html</span><span class="src-sym">;</span></li>
<li><a name="a646"></a>    </span><span class="src-str"><span class="src-sym">}</span></span></li>
<li><a name="a647"></a>&nbsp;</li>
<li><a name="a648"></a></span><span class="src-str">    <span class="src-key">public</span> <span class="src-key">function</span> <span class="src-id">processAdminUI</span><span class="src-sym">(</span><span class="src-sym">)</span></span></li>
<li><a name="a649"></a></span><span class="src-str">    <span class="src-sym">{</span></span></li>
<li><a name="a650"></a></span><span class="src-str">    <span class="src-sym">}</span></span></li>
<li><a name="a651"></a>&nbsp;</li>
<li><a name="a652"></a></span><span class="src-str">    <span class="src-key">public</span> <span class="src-key">function</span> <span class="src-id">delete</span><span class="src-sym">(</span><span class="src-sym">&</span> <span class="src-var">$errmsg</span><span class="src-sym">)</span></span></li>
<li><a name="a653"></a></span><span class="src-str">    <span class="src-sym">{</span></span></li>
<li><a name="a654"></a></span><span class="src-str">    <span class="src-sym">}</span></span></li>
<li><a name="a655"></a>&nbsp;</li>
<li><a name="a656"></a></span><span class="src-str">    <span class="src-key">public</span> <span class="src-key">function</span> <span class="src-id">getUserUI</span><span class="src-sym">(</span><span class="src-sym">)</span></span></li>
<li><a name="a657"></a></span><span class="src-str">    <span class="src-sym">{</span></span></li>
<li><a name="a658"></a></span><span class="src-str">    <span class="src-sym">}</span></span></li>
<li><a name="a659"></a>&nbsp;</li>
<li><a name="a660"></a></span><span class="src-str">    /** Add content to this user ( subscription ) */</span></li>
<li><a name="a661"></a></span><span class="src-str">    <span class="src-key">public</span> <span class="src-key">function</span> <span class="src-id">addContent</span><span class="src-sym">(</span><span class="src-id">Content</span> <span class="src-var">$content</span><span class="src-sym">)</span></span></li>
<li><a name="a662"></a></span><span class="src-str">    <span class="src-sym">{</span></span></li>
<li><a name="a663"></a></span><span class="src-str">        <span class="src-key">global</span> <span class="src-var">$db</span><span class="src-sym">;</span></span></li>
<li><a name="a664"></a></span><span class="src-str">        <span class="src-var">$content_id</span> = <span class="src-var">$db</span></span><span class="src-sym">-&gt;</span><span class="src-id">EscapeString</span><span class="src-sym">(</span><span class="src-var">$content</span><span class="src-sym">-&gt;</span><span class="src-id">getId</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a665"></a>        <span class="src-var">$sql </span>= </span><span class="src-str"><span class="src-str">"</span><span class="src-id">INSERT</span> <span class="src-id">INTO</span> <span class="src-id">user_has_content</span> (<span class="src-id">user_id</span>, <span class="src-id">content_id</span>) <span class="src-id">VALUES</span> ('<span class="src-var">$this</span></span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#var$id">id</a>','<span class="src-var">$content_id</span>')</span><span class="src-str"><span class="src-str">"</span><span class="src-sym">;</span></span></li>
<li><a name="a666"></a></span><span class="src-str">        <span class="src-var">$db</span></span><span class="src-sym">-&gt;</span><span class="src-id">ExecSqlUpdate</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">, </span><span class="src-id">false</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a667"></a>        <span class="src-key">return </span><span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a668"></a>    </span><span class="src-str"><span class="src-sym">}</span></span></li>
<li><a name="a669"></a>&nbsp;</li>
<li><a name="a670"></a></span><span class="src-str">    /** Remove content from this node */</span></li>
<li><a name="a671"></a></span><span class="src-str">    <span class="src-key">public</span> <span class="src-key">function</span> <span class="src-id">removeContent</span><span class="src-sym">(</span><span class="src-id">Content</span> <span class="src-var">$content</span><span class="src-sym">)</span></span></li>
<li><a name="a672"></a></span><span class="src-str">    <span class="src-sym">{</span></span></li>
<li><a name="a673"></a></span><span class="src-str">        <span class="src-key">global</span> <span class="src-var">$db</span><span class="src-sym">;</span></span></li>
<li><a name="a674"></a></span><span class="src-str">        <span class="src-var">$content_id</span> = <span class="src-var">$db</span></span><span class="src-sym">-&gt;</span><span class="src-id">EscapeString</span><span class="src-sym">(</span><span class="src-var">$content</span><span class="src-sym">-&gt;</span><span class="src-id">getId</span><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a675"></a>        <span class="src-var">$sql </span>= </span><span class="src-str"><span class="src-str">"</span><span class="src-id">DELETE</span> <span class="src-id">FROM</span> <span class="src-id">user_has_content</span> <span class="src-id">WHERE</span> <span class="src-id">user_id</span>='<span class="src-var">$this</span></span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#var$id">id</a>' <span class="src-id">AND content_id</span>='<span class="src-var">$content_id</span>'</span><span class="src-str"><span class="src-str">"</span><span class="src-sym">;</span></span></li>
<li><a name="a676"></a></span><span class="src-str">        <span class="src-var">$db</span></span><span class="src-sym">-&gt;</span><span class="src-id">ExecSqlUpdate</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">, </span><span class="src-id">false</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a677"></a>        <span class="src-key">return </span><span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a678"></a>    </span><span class="src-str"><span class="src-sym">}</span></span></li>
<li><a name="a679"></a>&nbsp;</li>
<li><a name="a680"></a></span><span class="src-str">    <span class="src-comm">/**Get an array of all Content linked to this node</span></span></li>
<li><a name="a681"></a></span><span class="src-str"><span class="src-comm">    * @return an array of Content or an empty arrray */</span></span></li>
<li><a name="a682"></a></span><span class="src-str">    <span class="src-key">function</span> <span class="src-id">getAllContent</span><span class="src-sym">(</span><span class="src-sym">)</span></span></li>
<li><a name="a683"></a></span><span class="src-str">    <span class="src-sym">{</span></span></li>
<li><a name="a684"></a></span><span class="src-str">        <span class="src-key">global</span> <span class="src-var">$db</span><span class="src-sym">;</span></span></li>
<li><a name="a685"></a></span><span class="src-str">        <span class="src-var">$retval</span> = <span class="src-key">array</span> <span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></span></li>
<li><a name="a686"></a></span><span class="src-str">        <span class="src-var">$sql</span> = <span class="src-str">"</span><span class="src-id">SELECT</span> * <span class="src-id">FROM</span> <span class="src-id">user_has_content</span> <span class="src-id">WHERE</span> <span class="src-id">user_id</span>='<span class="src-var">$this</span></span><span class="src-sym">-&gt;</span><a href="../WiFiDogAuthServer/User.html#var$id">id</a>' <span class="src-id">ORDER BY subscribe_timestamp</span><span class="src-str"></span><span class="src-str">"</span><span class="src-sym">;</span></span></li>
<li><a name="a687"></a></span><span class="src-str">        <span class="src-var">$db</span></span><span class="src-sym">-&gt;</span><span class="src-id">ExecSql</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">, </span><span class="src-var">$content_rows</span><span class="src-sym">, </span><span class="src-id">false</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a688"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$content_rows </span>!= <span class="src-id">null</span><span class="src-sym">)</span></li>
<li><a name="a689"></a>        </span><span class="src-str"><span class="src-sym">{</span></span></li>
<li><a name="a690"></a></span><span class="src-str">            <span class="src-key">foreach</span> <span class="src-sym">(</span><span class="src-var">$content_rows</span> <span class="src-key">as</span> <span class="src-var">$content_row</span><span class="src-sym">)</span></span></li>
<li><a name="a691"></a></span><span class="src-str">            <span class="src-sym">{</span></span></li>
<li><a name="a692"></a></span><span class="src-str">                <span class="src-var">$retval</span><span class="src-sym">[</span><span class="src-sym">]</span> = <span class="src-id">Content</span> <span class="src-sym">::</span> <span class="src-id">getObject</span><span class="src-sym">(</span><span class="src-var">$content_row</span><span class="src-sym">[</span><span class="src-str">'content_id'</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></span></li>
<li><a name="a693"></a></span><span class="src-str">            <span class="src-sym">}</span></span></li>
<li><a name="a694"></a></span><span class="src-str">        <span class="src-sym">}</span></span></li>
<li><a name="a695"></a></span><span class="src-str">        <span class="src-key">return</span> <span class="src-var">$retval</span><span class="src-sym">;</span></span></li>
<li><a name="a696"></a></span><span class="src-str">    <span class="src-sym">}</span></span></li>
<li><a name="a697"></a>&nbsp;</li>
<li><a name="a698"></a></span><span class="src-str"><span class="src-sym">}</span></span></li>
<li><a name="a699"></a>&nbsp;</li>
<li><a name="a700"></a></span><span class="src-str"><span class="src-comm">/*</span></span></li>
<li><a name="a701"></a></span><span class="src-str"><span class="src-comm"> * Local variables:</span></span></li>
<li><a name="a702"></a></span><span class="src-str"><span class="src-comm"> * tab-width: 4</span></span></li>
<li><a name="a703"></a></span><span class="src-str"><span class="src-comm"> * c-basic-offset: 4</span></span></li>
<li><a name="a704"></a></span><span class="src-str"><span class="src-comm"> * c-hanging-comment-ender-p: nil</span></span></li>
<li><a name="a705"></a></span><span class="src-str"><span class="src-comm"> * End:</span></span></li>
<li><a name="a706"></a></span><span class="src-str"><span class="src-comm"> */</span></span></li>
<li><a name="a707"></a>&nbsp;</li>
</ol></pre>
</div>
	<p class="notes" id="credit">
		Documentation generated on Mon, 26 Dec 2005 19:20:09 +0100 by <a href="http://www.phpdoc.org" target="_blank">phpDocumentor 1.3.0RC5</a>
	</p>
	</body>
</html>
