<fieldset class="pretty_fieldset">
<legend>{"Change my password"|_}</legend>
    <form name="form" method="post" onsubmit="return false" action="{$base_ssl_path}change_password.php">
	<input type="hidden" name="form_request" value="change_password">
    <table>
        {if $SelectNetworkUI}
        {$SelectNetworkUI}
        {/if}
    <tr>
        <td>{"Your username"|_}:</td>
        <td><input type="text" name="username" value="{$username}" size="20" id="form_username" onkeypress="return focusNext(this.form, 'oldpassword', event)"{if !$userIsSuperAdmin} readonly{/if}></td>
    </tr>
    <tr>
        <td>{"Your current password"|_}:</td>
        <td><input type="password" name="oldpassword" value="{$oldpassword}" size="20" id="form_oldpassword" onkeypress="return focusNext(this.form, 'newpassword', event)"></td>
    </tr>
    <tr>
        <td>{"Your new password"|_}:</td>
        <td><input type="password" name="newpassword" value="{$newpassword}" size="20" onkeypress="return focusNext(this.form, 'newpassword_again', event)"></td>
    </tr>
    <tr>
        <td>{"Your new password"|_} {"(again)"|_}:</td>
        <td><input type="password" name="newpassword_again" value="{$newpassword_again}" size="20" onkeypress="return focusNext(this.form, 'form_submit', event)"></td>
    </tr>
    <tr>
        <td></td>
        <td><input class="submit" type="submit" name="form_submit" value="{"Change my password"|_}" onclick="if (validateForm(this.form)) this.form.submit()"></td>
    </tr>
    </table>
    </form>
</fieldset>
    
<div id="help">
	{"Please enter your current username, your current password, and your new password (with confirmation)"|_}.
</div>

<div id="form_errormsg" class="errormsg">
	{if $error}
	{$error}
	{/if}
</div>

<script type="text/javascript">
	<!--
	{literal}
	var messages = {
	{/literal}
	  empty_form: "{"You must specify your username and password"|_}",
	  username_required: "{'Username is required.'|_}",
	  username_invalid: "{'Username contains invalid characters.'|_}",
	  password_empty: "{'A password of at least 6 characters is required.'|_}",
	  password_invalid: "{'Password contains invalid characters.'|_}",
	  password_short: "{'Password is too short, it must be 6 characters minimum'|_}",
	  password_twice: "{'You must type your password twice.'|_}",
	  password_match: "{'Passwords do not match.'|_}"
	{literal}
	};

	{/literal}
	{if $userIsSuperAdmin}
	document.getElementById("form_username").focus();
	{else}
	document.getElementById("form_oldpassword").focus();
	{/if}
	{literal}

	function validateForm(form) {
	  if (!isValidUsername(form.username)) {
		if (isEmpty(form.username))
		  document.getElementById("form_errormsg").innerHTML = messages.username_required;
		else
		  document.getElementById("form_errormsg").innerHTML = messages.username_invalid;

		focusElement(form.name, 'username');

		return false;
	  }

	  if (!isValidPassword(form.oldpassword)) {
		if (isEmpty(form.oldpassword))
		  document.getElementById("form_errormsg").innerHTML = messages.password_empty;
		else if (form.oldpassword.value.length<6)
		  document.getElementById("form_errormsg").innerHTML = messages.password_short;
		else
		  document.getElementById("form_errormsg").innerHTML = messages.password_invalid;

		focusElement(form.name, 'oldpassword');

		return false;
	  }

	  if (!isValidPassword(form.newpassword)) {
		if (isEmpty(form.newpassword))
		  document.getElementById("form_errormsg").innerHTML = messages.password_empty;
		else if (form.newpassword.value.length<6)
		  document.getElementById("form_errormsg").innerHTML = messages.password_short;
		else
		  document.getElementById("form_errormsg").innerHTML = messages.password_invalid;

		focusElement(form.name, 'newpassword');

		return false;
	  }

	  if (isEmpty(form.newpassword_again)) {
		document.getElementById("form_errormsg").innerHTML = messages.password_twice;
		focusElement(form.name, 'newpassword_again');
		return false;
	  }

	  if (form.newpassword.value != form.newpassword_again.value) {
		document.getElementById("form_errormsg").innerHTML = messages.password_match;
		focusElement(form.name, 'newpassword_again');
		return false;
	  }

	  return true;
	}

	{/literal}
	//-->
</script>
